<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#e07a5f">
  <meta name="description" content="Complete family planning and goal tracking system with gamification - Track tasks, earn XP, reach your Sheffield dreams!">
  <title>Turnbull-Shaw Family Hub - Level Up Your Life!</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600;9..144,700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    :root{
      --terracotta:#e07a5f;
      --terracotta-dark:#c65d42;
      --sage:#81b29a;
      --sage-light:#c8e6d4;
      --cream:#fafaf9;
      --cream-dark:#f5f5f4;
      --navy:#1e293b;
      --navy-light:#64748b;
      --gold:#f2cc8f;
      --gold-dark:#d9b36c;
      --rich:#4a90a4;
      --rich-light:#b8d4de;
      --shawnie:#d4729b;
      --shawnie-light:#f0c4d6;
      --madison:#f2a65a;
      --madison-light:#fcd9b6;
      --family:#81b29a;
      --both:#9b8bb4;
      --critical:#dc2626;
      --high:#f59e0b;
      --medium:#3b82f6;
      --low:#6b7280;
      --shadow-sm:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
      --shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl:0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --radius-sm:8px;
      --radius-md:12px;
      --radius-lg:16px;
      --radius-xl:24px;
      --transition-fast:0.15s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-normal:0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow:0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    body{
      font-family:'DM Sans',sans-serif;
      background:linear-gradient(135deg,#fafaf9 0%,#f5f5f4 100%);
      color:var(--navy);
      min-height:100vh;
      line-height:1.6;
      transition:background var(--transition-normal),color var(--transition-normal);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    h1,h2,h3,h4{font-family:'Fraunces',Georgia,serif;line-height:1.2;font-weight:700}
    .app{min-height:100vh;padding-bottom:80px}
    .header{
      background:linear-gradient(135deg,var(--terracotta) 0%,var(--shawnie) 50%,var(--gold) 100%);
      color:white;
      padding:24px 20px;
      position:relative;
      box-shadow:var(--shadow-xl);
    }
    .header::after{
      content:'';
      position:absolute;
      bottom:0;
      left:0;
      right:0;
      height:32px;
      background:linear-gradient(to bottom,transparent,#fafaf9);
    }
    .header-content{max-width:1200px;margin:0 auto;position:relative;z-index:1;padding-bottom:16px}
    .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .logo{display:flex;align-items:center;gap:12px}
    .logo-icon{
      width:48px;
      height:48px;
      background:rgba(255,255,255,0.95);
      backdrop-filter:blur(10px);
      border-radius:var(--radius-md);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.4rem;
      box-shadow:var(--shadow-md);
    }
    .logo-title{font-size:1.4rem;font-weight:700;text-shadow:0 2px 4px rgba(0,0,0,0.1)}
    .logo-sub{font-size:0.75rem;opacity:0.95;font-weight:500}
    .header-btns{display:flex;gap:8px}
    .icon-btn{
      width:38px;
      height:38px;
      border-radius:var(--radius-md);
      border:none;
      background:rgba(255,255,255,0.2);
      backdrop-filter:blur(10px);
      color:white;
      font-size:1rem;
      cursor:pointer;
      transition:all var(--transition-fast);
      box-shadow:var(--shadow-sm);
    }
    .icon-btn:hover{
      background:rgba(255,255,255,0.3);
      transform:translateY(-2px);
      box-shadow:var(--shadow-md);
    }
    .mini-stats{display:flex;gap:10px;flex-wrap:wrap}
    .mini-stat{
      background:rgba(255,255,255,0.95);
      backdrop-filter:blur(10px);
      border-radius:var(--radius-md);
      padding:8px 14px;
      display:flex;
      align-items:center;
      gap:8px;
      box-shadow:var(--shadow-sm);
      transition:all var(--transition-fast);
    }
    .mini-stat:hover{transform:translateY(-1px);box-shadow:var(--shadow-md)}
    .mini-stat-val{font-family:'Fraunces',serif;font-size:1.1rem;font-weight:700;color:var(--terracotta)}
    .mini-stat-val.negative{color:var(--critical)}
    .mini-stat-val.positive{color:var(--sage)}
    .mini-stat-lbl{font-size:0.6rem;color:var(--navy-light);text-transform:uppercase}
    .nav-wrap{position:sticky;top:0;z-index:100;padding:8px 16px;background:var(--cream)}
    .nav{max-width:1200px;margin:0 auto;background:white;border-radius:999px;padding:4px;display:flex;gap:2px;overflow-x:auto;box-shadow:var(--shadow-md)}
    .nav::-webkit-scrollbar{display:none}
    .nav-btn{flex:1;min-width:fit-content;padding:10px 16px;border:none;border-radius:999px;background:transparent;font-family:inherit;font-size:0.8rem;font-weight:600;color:var(--navy-light);cursor:pointer;transition:all 0.2s;white-space:nowrap}
    .nav-btn:hover{background:var(--cream);color:var(--navy)}
    .nav-btn.active{background:var(--terracotta);color:white}
    .main{max-width:1200px;margin:0 auto;padding:0 16px}
    .card{background:white;border-radius:var(--radius-xl);padding:20px;margin-bottom:16px;box-shadow:var(--shadow-sm);transition:transform var(--transition-fast),box-shadow var(--transition-fast),background-color var(--transition-normal)}
    .card:hover{transform:translateY(-2px);box-shadow:var(--shadow-md)}
    .card-title{font-size:1.1rem;display:flex;align-items:center;gap:8px;margin-bottom:16px}
    .card-icon{width:32px;height:32px;background:linear-gradient(135deg,var(--terracotta),var(--gold));border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:1rem}
    .overview-hero{background:linear-gradient(135deg,var(--terracotta) 0%,var(--shawnie) 50%,var(--sage) 100%);border-radius:var(--radius-xl);padding:24px;color:white;margin-bottom:16px;text-align:center}
    .overview-countdown{font-size:0.85rem;opacity:0.9;margin-bottom:8px}
    .overview-days{font-family:'Fraunces',serif;font-size:3.5rem;font-weight:700;line-height:1}
    .overview-label{font-size:0.9rem;margin-top:4px;opacity:0.9}
    .overview-date{font-size:0.8rem;margin-top:8px;opacity:0.8}
    .overview-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;margin-bottom:16px}
    .overview-card{background:white;border-radius:var(--radius-lg);padding:16px;text-align:center;box-shadow:var(--shadow-sm);border-left:4px solid var(--terracotta);transition:transform var(--transition-fast),box-shadow var(--transition-fast),background-color var(--transition-normal)}
    .overview-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-md)}
    .overview-card.income{border-left-color:var(--sage)}
    .overview-card.expense{border-left-color:var(--critical)}
    .overview-card.gap{border-left-color:var(--high)}
    .overview-card.goals{border-left-color:var(--medium)}
    .overview-card.savings{border-left-color:var(--gold)}
    .overview-card.pension{border-left-color:var(--shawnie)}
    .overview-card-icon{font-size:1.5rem;margin-bottom:6px}
    .overview-card-value{font-family:'Fraunces',serif;font-size:1.4rem;font-weight:700;color:var(--navy)}
    .overview-card-label{font-size:0.7rem;color:var(--navy-light);text-transform:uppercase}
    .progress-section{margin-bottom:16px}
    .progress-title{font-size:0.85rem;font-weight:600;margin-bottom:8px;display:flex;justify-content:space-between}
    .progress-bar{height:12px;background:var(--cream-dark);border-radius:6px;overflow:hidden}
    .progress-fill{height:100%;border-radius:6px;transition:width 0.3s}
    .progress-fill.goals{background:linear-gradient(90deg,var(--terracotta),var(--gold))}
    .progress-fill.savings{background:linear-gradient(90deg,var(--sage),var(--rich))}
    .timeline-item{display:flex;gap:12px;padding:12px;background:var(--cream);border-radius:var(--radius-md);margin-bottom:8px}
    .timeline-dot{width:12px;height:12px;border-radius:50%;margin-top:4px;flex-shrink:0}
    .timeline-dot.past{background:var(--sage)}
    .timeline-dot.current{background:var(--terracotta);box-shadow:0 0 0 4px rgba(224,122,95,0.3)}
    .timeline-dot.future{background:var(--cream-dark);border:2px solid var(--navy-light)}
    .timeline-content{flex:1}
    .timeline-title{font-weight:600;font-size:0.9rem}
    .timeline-date{font-size:0.75rem;color:var(--navy-light)}
    .timeline-amount{font-family:'Fraunces',serif;font-weight:700;color:var(--sage)}
    .btn{padding:8px 16px;border:none;border-radius:999px;font-family:inherit;font-size:0.85rem;font-weight:600;cursor:pointer;transition:all var(--transition-fast);display:inline-flex;align-items:center;gap:6px}
    .btn-primary{background:var(--terracotta);color:white}
    .btn-primary:hover{background:var(--terracotta-dark);transform:translateY(-1px);box-shadow:0 4px 12px rgba(224,122,95,0.3)}
    .btn-primary:active{transform:translateY(0);box-shadow:0 2px 6px rgba(224,122,95,0.2)}
    .btn-secondary{background:var(--cream);color:var(--navy)}
    .btn-secondary:hover{background:var(--cream-dark);transform:translateY(-1px)}
    .btn-sm{padding:6px 12px;font-size:0.75rem}
    .form-group{margin-bottom:12px}
    .form-label{display:block;font-size:0.8rem;font-weight:600;margin-bottom:4px;color:var(--navy)}
    .form-input{width:100%;padding:10px 12px;border:2px solid var(--cream-dark);border-radius:var(--radius-sm);font-family:inherit;font-size:0.9rem;transition:all var(--transition-fast)}
    .form-input:focus{outline:none;border-color:var(--terracotta);box-shadow:0 0 0 3px rgba(224,122,95,0.1)}
    .budget-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
    .budget-section{background:var(--cream);border-radius:var(--radius-lg);padding:16px}
    .budget-section-title{font-family:'Fraunces',serif;font-size:0.95rem;margin-bottom:12px;display:flex;align-items:center;gap:8px}
    .budget-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.5)}
    .budget-row:last-child{border-bottom:none}
    .budget-label{font-size:0.85rem}
    .budget-input{width:90px;padding:6px 10px;border:2px solid var(--cream-dark);border-radius:var(--radius-sm);font-size:0.85rem;text-align:right;background:white}
    .budget-input:focus{outline:none;border-color:var(--terracotta)}
    .budget-total{background:white;border-radius:var(--radius-md);padding:12px;margin-top:12px;display:flex;justify-content:space-between;align-items:center}
    .budget-total-label{font-weight:600}
    .budget-total-value{font-family:'Fraunces',serif;font-size:1.2rem;font-weight:700}
    .summary-row{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
    .summary-box{padding:14px;border-radius:var(--radius-md);text-align:center}
    .summary-box.income{background:linear-gradient(135deg,#d1fae5,#a7f3d0)}
    .summary-box.expense{background:linear-gradient(135deg,#fee2e2,#fecaca)}
    .summary-box.saving{background:linear-gradient(135deg,#fef3c7,#fde68a)}
    .summary-box.leftover{background:linear-gradient(135deg,#dbeafe,#bfdbfe)}
    .summary-box.negative{background:linear-gradient(135deg,#fee2e2,#fecaca)}
    .summary-label{font-size:0.6rem;text-transform:uppercase;font-weight:600;opacity:0.8}
    .summary-value{font-family:'Fraunces',serif;font-size:1.2rem;font-weight:700}
    .tag{display:inline-flex;padding:2px 8px;border-radius:999px;font-size:0.65rem;font-weight:600}
    .tag-rich{background:var(--rich-light);color:#1e4a5f}
    .tag-shawnie{background:var(--shawnie-light);color:#6b2d4a}
    .tag-both{background:#e0d8ec;color:#4a3d5c}
    .tag-family{background:var(--sage-light);color:#2d5a4a}
    .tag-madison{background:var(--madison-light);color:#7a4a1f}
    .tag-either{background:#f3f4f6;color:#4b5563}
    .tag-critical{background:#fee2e2;color:#991b1b}
    .tag-high{background:#fef3c7;color:#92400e}
    .tag-medium{background:#dbeafe;color:#1e40af}
    .tag-low{background:#f3f4f6;color:#4b5563}
    .week-nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}
    .day-tabs{display:flex;gap:4px;overflow-x:auto;flex:1;padding:4px 0}
    .day-tab{padding:8px 10px;border:2px solid var(--cream-dark);border-radius:var(--radius-md);background:white;cursor:pointer;text-align:center;min-width:52px;transition:all 0.2s}
    .day-tab:hover{border-color:var(--terracotta)}
    .day-tab.active{background:var(--terracotta);border-color:var(--terracotta);color:white}
    .day-tab.today{border-color:var(--gold);background:#fffbeb}
    .day-tab.active.today{background:var(--terracotta);border-color:var(--terracotta)}
    .day-name{font-size:0.65rem;font-weight:600}
    .day-num{font-size:0.95rem;font-weight:700}
    .time-section{margin-bottom:20px}
    .time-header{display:flex;align-items:center;gap:8px;margin-bottom:10px;padding-bottom:8px;border-bottom:2px solid var(--cream-dark)}
    .time-icon{font-size:1.1rem}
    .time-title{font-weight:700;font-size:0.9rem}
    .time-range{font-size:0.7rem;color:var(--navy-light);margin-left:auto}
    .task-item{display:flex;align-items:flex-start;gap:10px;padding:10px;background:var(--cream);border-radius:var(--radius-md);margin-bottom:6px;cursor:pointer;transition:all var(--transition-fast)}
    .task-item:hover{background:var(--cream-dark);transform:translateX(2px)}
    .task-item:active{transform:scale(0.98)}
    .task-item.completed{opacity:0.5}
    .task-item.completed .task-text{text-decoration:line-through}
    .task-check{width:20px;height:20px;border:2px solid var(--navy-light);border-radius:5px;display:flex;align-items:center;justify-content:center;flex-shrink:0;background:white;transition:all var(--transition-fast)}
    .task-check.checked{background:var(--sage);border-color:var(--sage);color:white;animation:checkBounce 0.4s ease}
    .task-content{flex:1}
    .task-text{font-size:0.85rem;font-weight:500}
    .task-meta{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}
    .meal-card{background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:var(--radius-md);padding:12px;margin-bottom:8px}
    .meal-header{display:flex;justify-content:space-between;align-items:center}
    .meal-type{font-weight:700;color:#92400e;font-size:0.85rem}
    .meal-cost{font-weight:700;color:#78350f;font-size:0.8rem}
    .meal-name{font-size:0.9rem;color:#78350f;margin-top:4px}
    .activity-card{background:linear-gradient(135deg,#eff6ff,#dbeafe);border-radius:var(--radius-md);padding:12px;margin-bottom:8px}
    .activity-name{font-weight:600;color:#1e40af;font-size:0.85rem}
    .activity-meta{font-size:0.75rem;color:#3b82f6;margin-top:2px}
    .goal-focus{background:linear-gradient(135deg,#fdf4ff,#f3e8ff);border-radius:var(--radius-md);padding:12px;margin-bottom:8px;border-left:3px solid #a855f7}
    .goal-focus-title{font-weight:700;color:#7c3aed;font-size:0.8rem;margin-bottom:4px}
    .goal-focus-text{font-size:0.85rem;color:#6b21a8}
    .goal-focus-time{font-size:0.7rem;color:#9333ea;margin-top:4px}
    .goal-card{background:white;border-radius:var(--radius-lg);margin-bottom:10px;border-left:4px solid var(--medium);overflow:hidden;box-shadow:var(--shadow-sm);transition:all var(--transition-fast)}
    .goal-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px)}
    .goal-card.critical{border-left-color:var(--critical)}
    .goal-card.high{border-left-color:var(--high)}
    .goal-card.medium{border-left-color:var(--medium)}
    .goal-card.low{border-left-color:var(--low)}
    .goal-header{padding:14px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:background-color var(--transition-fast)}
    .goal-header:hover{background:rgba(0,0,0,0.02)}
    .goal-icon{font-size:1.3rem}
    .goal-info{flex:1}
    .goal-title{font-weight:700;font-size:0.9rem}
    .goal-subtitle{font-size:0.75rem;color:var(--navy-light)}
    .goal-progress{text-align:right}
    .goal-pct{font-family:'Fraunces',serif;font-weight:700;font-size:1rem}
    .goal-count{font-size:0.7rem;color:var(--navy-light)}
    .goal-body{padding:0 14px 14px;display:none}
    .goal-body.open{display:block}
    .step-item{display:flex;gap:8px;padding:8px;background:var(--cream);border-radius:var(--radius-sm);margin-bottom:4px;cursor:pointer;font-size:0.85rem;transition:all var(--transition-fast)}
    .step-item:hover{background:var(--cream-dark);transform:translateX(3px)}
    .step-item.completed{opacity:0.5}
    .step-item.completed .step-text{text-decoration:line-through}
    .step-check{width:18px;height:18px;border:2px solid var(--navy-light);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;background:white;transition:all var(--transition-fast)}
    .step-check.checked{background:var(--sage);border-color:var(--sage);color:white;animation:checkBounce 0.4s ease}
    .step-text{flex:1}
    .step-date{font-size:0.7rem;color:var(--navy-light)}
    .benefit-item{display:flex;align-items:center;gap:10px;padding:10px;background:var(--cream);border-radius:var(--radius-md);margin-bottom:6px}
    .benefit-item.unclaimed{background:#fef3c7}
    .benefit-check{width:20px;height:20px;border:2px solid var(--navy-light);border-radius:5px;display:flex;align-items:center;justify-content:center;background:white;cursor:pointer}
    .benefit-check.checked{background:var(--sage);border-color:var(--sage);color:white}
    .benefit-name{flex:1;font-size:0.9rem}
    .benefit-saving{font-weight:700;color:var(--sage);font-size:0.85rem}
    .tip-box{background:#fef3c7;border-left:3px solid var(--gold-dark);border-radius:var(--radius-sm);padding:12px;margin:12px 0;font-size:0.85rem;color:#78350f}
    .milestone-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px}
    .milestone-card{background:white;border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-sm);border:2px solid var(--cream-dark);transition:all var(--transition-fast)}
    .milestone-card:hover{border-color:var(--terracotta);transform:translateY(-3px);box-shadow:var(--shadow-md)}
    .milestone-card.achieved{border-color:var(--sage)}
    .milestone-photo{width:100%;height:140px;background:var(--cream);display:flex;align-items:center;justify-content:center;font-size:3rem;opacity:0.3;position:relative;overflow:hidden}
    .milestone-photo.loading{background:linear-gradient(90deg,var(--cream) 0%,var(--cream-dark) 50%,var(--cream) 100%);background-size:200% 100%;animation:shimmer 1.5s infinite}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .milestone-photo img{width:100%;height:100%;object-fit:cover;opacity:1}
    .milestone-photo.has-photo{opacity:1}
    .milestone-upload{position:absolute;top:8px;right:8px;width:32px;height:32px;background:var(--terracotta);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:0.9rem;z-index:10}
    .milestone-upload input{display:none}
    .milestone-content{padding:12px}
    .milestone-title{font-weight:700;font-size:0.9rem;margin-bottom:6px}
    .note-card{background:#fffbeb;border-left:4px solid var(--gold);border-radius:var(--radius-md);padding:14px;margin-bottom:12px}
    .note-date{font-size:0.75rem;color:var(--navy-light);font-weight:600;margin-bottom:8px}
    .note-text{font-size:0.9rem;line-height:1.6;white-space:pre-wrap}
    .event-card{background:linear-gradient(135deg,#e0f2fe,#bae6fd);border-radius:var(--radius-md);padding:12px;margin-bottom:8px;border-left:3px solid #0284c7}
    .event-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px}
    .event-time{font-weight:700;color:#075985;font-size:0.8rem}
    .event-delete{background:transparent;border:none;color:#dc2626;cursor:pointer;font-size:1.2rem;padding:0;width:24px;height:24px;display:flex;align-items:center;justify-content:center;line-height:1}
    .event-title{font-weight:600;color:#0c4a6e;font-size:0.9rem;margin-bottom:4px}
    .event-desc{font-size:0.8rem;color:#0369a1;margin-bottom:4px}
    .event-meta{font-size:0.75rem;color:#0284c7}
    .week-overview-card{margin-bottom:12px}
    .week-overview-day{margin-bottom:16px;padding-bottom:16px;border-bottom:2px solid var(--cream)}
    .week-overview-day:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
    .week-overview-date{font-weight:700;font-size:0.95rem;margin-bottom:8px;color:var(--navy)}
    .week-overview-items{display:flex;flex-direction:column;gap:6px}
    .week-overview-item{font-size:0.85rem;padding:8px 12px;background:var(--cream);border-radius:var(--radius-sm);display:flex;align-items:center;gap:8px}
    .week-overview-item.event{background:linear-gradient(135deg,#e0f2fe,#bae6fd)}
    .week-overview-item.goal{background:linear-gradient(135deg,#fdf4ff,#f3e8ff)}
    .week-overview-icon{font-size:1rem}
    .celebration{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999;pointer-events:none}
    .celebration-box{background:linear-gradient(135deg,var(--gold),var(--terracotta));color:white;padding:16px 32px;border-radius:999px;font-family:'Fraunces',serif;font-size:1.2rem;font-weight:700;box-shadow:var(--shadow-md);animation:pop 0.5s ease}
    @keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    .fab{position:fixed;bottom:20px;right:20px;width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--terracotta),var(--shawnie));color:white;border:none;font-size:1.2rem;cursor:pointer;box-shadow:var(--shadow-md);z-index:900;transition:all var(--transition-fast)}
    .fab:hover{transform:scale(1.1);box-shadow:var(--shadow-lg)}
    .fab:active{transform:scale(0.95)}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);z-index:1000;align-items:center;justify-content:center;padding:16px;animation:fadeIn var(--transition-normal)}
    .modal.show{display:flex}
    .modal-content{background:rgba(255,255,255,0.98);border-radius:var(--radius-xl);width:100%;max-width:480px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-lg);animation:slideUp var(--transition-normal);border:1px solid rgba(255,255,255,0.3)}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes slideUp{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes checkBounce{0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}
    @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.05);opacity:0.8}100%{transform:scale(1);opacity:1}}
    .modal-header{padding:20px;border-bottom:2px solid var(--cream);display:flex;justify-content:space-between;align-items:center}
    .modal-close{background:transparent;border:none;font-size:2rem;cursor:pointer;color:var(--navy-light);line-height:1}
    .modal-body{padding:20px}
    .modal-textarea{width:100%;padding:12px;border:2px solid var(--cream-dark);border-radius:var(--radius-md);font-family:inherit;font-size:0.9rem;min-height:120px;resize:vertical}
    .modal-textarea:focus{outline:none;border-color:var(--terracotta)}
    .modal-footer{padding:16px 20px;border-top:2px solid var(--cream);display:flex;justify-content:flex-end;gap:8px}
    @media(max-width:640px){
      .summary-row{grid-template-columns:repeat(2,1fr)}
      .overview-grid{grid-template-columns:repeat(2,1fr)}
      .day-tab{min-width:60px;padding:10px 12px}
      .milestone-grid{grid-template-columns:repeat(auto-fill,minmax(150px,1fr))}
      .compact-task{font-size:0.85rem;padding:6px 8px}
      .task-time{font-size:0.85rem;min-width:55px}
      .time-badge{font-size:0.65rem;padding:3px 8px}
      .card-title{font-size:1rem}
      .nav{font-size:0.75rem}
      .nav-btn{padding:8px 12px;font-size:0.75rem}
      .quick-stats{grid-template-columns:repeat(2,1fr)}
      .month-calendar{gap:2px}
      .month-day{font-size:0.7rem}
      .xp-bar{height:20px}
      .xp-fill{font-size:0.7rem;padding:0 8px}
      .level-badge,.streak-badge{font-size:0.8rem;padding:6px 12px}
    }
    body.dark{--cream:#1f2937;--cream-dark:#374151;--navy:#f9fafb;--navy-light:#d1d5db;background:#111827;color:#f9fafb}
    body.dark .card,body.dark .nav{background:#1f2937;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
    body.dark .modal-content{background:rgba(31,41,55,0.98);box-shadow:0 20px 60px rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.1)}
    body.dark .budget-section{background:#374151}
    body.dark .form-input,body.dark .budget-input,body.dark .modal-textarea{background:#374151;border-color:#4b5563;color:#f9fafb}
    body.dark .task-item,body.dark .step-item,body.dark .benefit-item{background:#374151}
    body.dark .meal-card{background:linear-gradient(135deg,#92400e,#78350f)}
    body.dark .activity-card{background:linear-gradient(135deg,#1e40af,#1e3a8a)}
    body.dark .note-card{background:#78350f}
    body.dark .event-card{background:linear-gradient(135deg,#0c4a6e,#075985)}
    body.dark .day-tab{background:#374151;border-color:#4b5563}
    body.dark .day-tab.active{background:var(--terracotta);border-color:var(--terracotta)}
    body.dark .overview-card,body.dark .milestone-card{background:#374151;border-color:#4b5563}
    .photo-date{position:absolute;bottom:8px;left:8px;background:rgba(0,0,0,0.8);color:white;padding:4px 8px;border-radius:6px;font-size:0.7rem;font-weight:600}
    .achievement-badge{position:absolute;top:8px;left:8px;background:var(--sage);color:white;padding:6px 12px;border-radius:12px;font-size:0.7rem;font-weight:700;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
    .milestone-notes{font-size:0.8rem;color:var(--navy-light);font-style:italic;margin:8px 0;line-height:1.4;padding:8px;background:var(--cream);border-radius:6px}
    body.dark .milestone-notes{background:#4b5563;color:#d1d5db}
    .chart-container{position:relative;height:280px;margin-top:16px}
    .madison-hero{background:linear-gradient(135deg,var(--madison),var(--madison-light));border-radius:var(--radius-xl);padding:24px;color:white;margin-bottom:16px;text-align:center}
    .madison-age{font-family:'Fraunces',serif;font-size:2.5rem;font-weight:700}
    .madison-stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-bottom:16px}
    .madison-stat-card{background:white;border-radius:var(--radius-lg);padding:16px;text-align:center;box-shadow:var(--shadow-sm);border-left:4px solid var(--madison)}
    .madison-stat-icon{font-size:1.8rem;margin-bottom:8px}
    .madison-stat-value{font-family:'Fraunces',serif;font-size:1.3rem;font-weight:700;color:var(--navy)}
    .madison-stat-label{font-size:0.7rem;color:var(--navy-light);text-transform:uppercase;margin-top:4px}
    .madison-stat-date{font-size:0.65rem;color:var(--navy-light);margin-top:2px}
    .growth-entry{display:flex;gap:12px;padding:12px;background:var(--cream);border-radius:var(--radius-md);margin-bottom:8px;align-items:center}
    .growth-date-col{min-width:80px;font-size:0.75rem;font-weight:600;color:var(--navy-light)}
    .growth-data-col{flex:1;display:flex;gap:16px}
    .growth-metric{display:flex;flex-direction:column}
    .growth-metric-label{font-size:0.65rem;color:var(--navy-light);text-transform:uppercase}
    .growth-metric-value{font-size:0.9rem;font-weight:700;color:var(--navy)}
    .vacc-item{display:flex;align-items:center;gap:12px;padding:12px;background:var(--cream);border-radius:var(--radius-md);margin-bottom:8px}
    .vacc-item.completed{background:var(--sage-light)}
    .vacc-check{width:24px;height:24px;border:2px solid var(--navy-light);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;background:white;flex-shrink:0}
    .vacc-check.checked{background:var(--sage);border-color:var(--sage);color:white}
    .vacc-info{flex:1}
    .vacc-name{font-weight:600;font-size:0.9rem}
    .vacc-age{font-size:0.75rem;color:var(--navy-light)}
    .vacc-date{font-size:0.75rem;color:var(--navy-light);min-width:100px;text-align:right}
    .dev-category{background:var(--cream);border-radius:var(--radius-lg);padding:16px;margin-bottom:12px}
    .dev-category-title{font-weight:700;font-size:0.95rem;margin-bottom:12px;display:flex;align-items:center;gap:8px;color:var(--navy)}
    .dev-milestone{display:flex;align-items:flex-start;gap:10px;padding:8px;background:white;border-radius:var(--radius-sm);margin-bottom:6px;cursor:pointer}
    .dev-milestone.achieved{opacity:0.6}
    .dev-check{width:20px;height:20px;border:2px solid var(--navy-light);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;background:white}
    .dev-check.checked{background:var(--madison);border-color:var(--madison);color:white}
    .dev-text{flex:1;font-size:0.85rem}
    .dev-age{font-size:0.7rem;color:var(--navy-light);margin-left:auto}
    .health-note{background:var(--madison-light);border-left:4px solid var(--madison);border-radius:var(--radius-md);padding:14px;margin-bottom:12px}
    .health-note-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
    .health-note-date{font-weight:600;font-size:0.8rem;color:#7a4a1f}
    .health-note-type{font-size:0.7rem;color:#7a4a1f;text-transform:uppercase;background:rgba(255,255,255,0.5);padding:2px 8px;border-radius:12px}
    .health-note-text{font-size:0.85rem;color:#5a3a1f;line-height:1.5}
    body.dark .madison-stat-card{background:#374151}
    body.dark .growth-entry{background:#374151}
    body.dark .vacc-item{background:#374151}
    body.dark .dev-category{background:#374151}
    body.dark .dev-milestone{background:#1f2937}
    
    .xp-bar{background:var(--cream-dark);height:24px;border-radius:12px;overflow:hidden;position:relative;margin:8px 0}
    .xp-fill{height:100%;background:linear-gradient(90deg,#10b981,#059669);transition:width 0.5s ease;display:flex;align-items:center;padding:0 12px;color:white;font-size:0.75rem;font-weight:700}
    .level-badge{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#f59e0b,#d97706);color:white;border-radius:999px;font-weight:700;font-size:0.9rem;box-shadow:0 4px 12px rgba(245,158,11,0.3)}
    .streak-badge{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:linear-gradient(135deg,#ef4444,#dc2626);color:white;border-radius:999px;font-weight:700;font-size:0.9rem;box-shadow:0 4px 12px rgba(239,68,68,0.3)}
    .achievement-toast{position:fixed;top:80px;right:20px;background:linear-gradient(135deg,#8b5cf6,#7c3aed);color:white;padding:16px 24px;border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);z-index:1001;animation:slideInRight 0.4s ease,slideOutRight 0.4s ease 2.6s}
    @keyframes slideInRight{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
    @keyframes slideOutRight{from{transform:translateX(0);opacity:1}to{transform:translateX(400px);opacity:0}}
    .progress-ring{transform:rotate(-90deg)}
    .progress-ring-circle{transition:stroke-dashoffset 0.5s ease;fill:none;stroke-linecap:round}
    .time-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;background:var(--terracotta);color:white;border-radius:6px;font-size:0.7rem;font-weight:700;white-space:nowrap}
    .task-time{min-width:70px;font-family:'Fraunces',serif;font-weight:700;font-size:0.95rem;color:var(--terracotta);flex-shrink:0}
    .quick-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px;margin:12px 0}
    .quick-stat{text-align:center;padding:12px 8px;background:var(--cream);border-radius:var(--radius-md)}
    .quick-stat-value{font-family:'Fraunces',serif;font-size:1.4rem;font-weight:700;color:var(--terracotta)}
    .quick-stat-label{font-size:0.65rem;color:var(--navy-light);text-transform:uppercase;margin-top:2px}
    .month-calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-top:12px}
    .month-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;background:var(--cream);border-radius:8px;font-size:0.75rem;font-weight:600;position:relative;cursor:pointer;transition:all 0.2s}
    .month-day.completed{background:linear-gradient(135deg,#10b981,#059669);color:white}
    .month-day.today{border:2px solid var(--terracotta);font-weight:700}
    .month-day.partial{background:linear-gradient(135deg,#fbbf24,#f59e0b);color:white}
    .month-day:hover{transform:scale(1.1)}
    .compact-task{
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 14px;
      background:white;
      border-radius:var(--radius-lg);
      margin-bottom:8px;
      cursor:pointer;
      transition:all var(--transition-fast);
      border:1px solid rgba(0,0,0,0.05);
      box-shadow:var(--shadow-sm);
    }
    .compact-task:hover{
      background:rgba(224,122,95,0.05);
      transform:translateX(4px);
      box-shadow:var(--shadow-md);
      border-color:rgba(224,122,95,0.2);
    }
    .compact-task.completed{
      opacity:0.5;
      background:var(--cream);
    }
    
    @media print{
      *{-webkit-print-color-adjust:exact;print-color-adjust:exact}
      body{background:white;color:black;font-size:11pt}
      .header,.nav-wrap,.fab,.icon-btn,.modal,.btn{display:none!important}
      .app{padding-bottom:0}
      .card{page-break-inside:avoid;box-shadow:none;border:1px solid #ddd;margin-bottom:1rem}
      .card-title{color:var(--terracotta);border-bottom:2px solid var(--terracotta);padding-bottom:0.5rem;margin-bottom:1rem}
      .overview-hero{background:linear-gradient(135deg,var(--terracotta),var(--gold));-webkit-print-color-adjust:exact;print-color-adjust:exact;page-break-inside:avoid}
      .budget-grid,.overview-grid,.madison-stat-grid{page-break-inside:avoid}
      .goal-card,.benefit-item,.note-card{page-break-inside:avoid}
      .chart-container{display:none}
      h1,h2,h3{page-break-after:avoid}
      .nav-btn.active::after{content:" (Current)"}
      @page{margin:1.5cm;size:A4}
    }
  </style></head>
<body>
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script type="text/babel">
const{useState,useEffect,useMemo,useCallback}=React;
const Check=()=><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>;
const ChevronDown=()=><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>;

const weeklyMeals={
  0:{breakfast:{name:"Lazy Sunday pancakes",cost:1.20,prep:"25min",cook:"Rich"},lunch:{name:"Roast prep nibbles",cost:2.00,prep:"15min",cook:"Rich"},dinner:{name:"Sunday roast chicken",cost:8.00,prep:"2hr",cook:"Rich"}},
  1:{breakfast:{name:"Porridge with honey",cost:0.40,prep:"10min",cook:"Rich"},lunch:{name:"Leftover roast sandwiches",cost:0.50,prep:"5min",cook:"Either"},dinner:{name:"Spaghetti Bolognese",cost:4.00,prep:"45min",cook:"Rich"}},
  2:{breakfast:{name:"Scrambled eggs on toast",cost:0.80,prep:"10min",cook:"Rich"},lunch:{name:"Soup & crusty bread",cost:1.50,prep:"20min",cook:"Rich"},dinner:{name:"Chicken stir fry",cost:4.50,prep:"30min",cook:"Rich"}},
  3:{breakfast:{name:"Yogurt, granola & fruit",cost:0.70,prep:"5min",cook:"Either"},lunch:{name:"Cheese toasties",cost:1.20,prep:"15min",cook:"Either"},dinner:{name:"Shepherd's pie",cost:4.00,prep:"1hr",cook:"Rich"}},
  4:{breakfast:{name:"Beans on toast",cost:0.50,prep:"10min",cook:"Either"},lunch:{name:"Jacket potato & beans",cost:1.00,prep:"1hr",cook:"Rich"},dinner:{name:"Fish fingers & chips",cost:3.50,prep:"30min",cook:"Rich"}},
  5:{breakfast:{name:"French toast",cost:0.60,prep:"15min",cook:"Rich"},lunch:{name:"BLT sandwiches",cost:2.00,prep:"10min",cook:"Either"},dinner:{name:"Homemade pizza",cost:3.50,prep:"45min",cook:"Rich"}},
  6:{breakfast:{name:"Full English (budget)",cost:2.00,prep:"25min",cook:"Rich"},lunch:{name:"Pasta salad",cost:1.50,prep:"15min",cook:"Rich"},dinner:{name:"Curry & rice",cost:4.00,prep:"45min",cook:"Rich"}}
};

const weeklyActivities={
  0:[{name:"Board game afternoon",icon:"üé≤",person:"Family",cost:0,duration:"2hr"},{name:"Anime movie night",icon:"üì∫",person:"Both",cost:0,duration:"2hr"}],
  1:[{name:"Library visit",icon:"üìö",person:"Family",cost:0,duration:"1hr"},{name:"Lego building",icon:"üß±",person:"Family",cost:0,duration:"1hr"}],
  2:[{name:"Seaham beach walk",icon:"üèñÔ∏è",person:"Family",cost:0,duration:"2hr"},{name:"History documentary",icon:"üèõÔ∏è",person:"Rich",cost:0,duration:"1hr"}],
  3:[{name:"Soft play / park",icon:"üõù",person:"Madison",cost:0,duration:"2hr"},{name:"Cafe trip",icon:"‚òï",person:"Family",cost:8,duration:"1hr"}],
  4:[{name:"Museum trip (free)",icon:"üèõÔ∏è",person:"Family",cost:0,duration:"2hr"},{name:"Gaming session",icon:"üéÆ",person:"Both",cost:0,duration:"2hr"}],
  5:[{name:"Local park adventure",icon:"üå≥",person:"Family",cost:0,duration:"2hr"},{name:"Pizza making together",icon:"üçï",person:"Family",cost:0,duration:"1hr"}],
  6:[{name:"Lie-in rotation",icon:"üò¥",person:"Both",cost:0,duration:"2hr"},{name:"Nature walk / hike",icon:"ü•æ",person:"Family",cost:0,duration:"2hr"}]
};

const dailyTasks={
  fixed:[
    {task:"Make beds",person:"Both",time:"morning",icon:"üõèÔ∏è"},
    {task:"Breakfast dishes",person:"Rich",time:"morning",icon:"üçΩÔ∏è"},
    {task:"Kitchen wipe",person:"Rich",time:"morning",icon:"üßΩ"},
    {task:"Madison morning routine",person:"Shawnie",time:"morning",icon:"üë∂"},
    {task:"Laundry load",person:"Rich",time:"morning",icon:"üëï"},
    {task:"Lunch dishes",person:"Either",time:"afternoon",icon:"üçΩÔ∏è"},
    {task:"Living room tidy",person:"Either",time:"afternoon",icon:"üõãÔ∏è"},
    {task:"Madison quiet time",person:"Both",time:"afternoon",icon:"üò¥"},
    {task:"Cook dinner",person:"Rich",time:"evening",icon:"üç≥"},
    {task:"Dinner dishes",person:"Rich",time:"evening",icon:"üçΩÔ∏è"},
    {task:"Bath Madison",person:"Rich",time:"evening",icon:"üõÅ"},
    {task:"Bedtime routine",person:"Both",time:"evening",icon:"üìñ"},
    {task:"Evening tidy (10min)",person:"Both",time:"evening",icon:"‚ú®"},
    {task:"Check finances",person:"Shawnie",time:"evening",icon:"üí∞"}
  ],
  weekly:{
    0:[{task:"Hoover whole house",person:"Rich",icon:"üßπ"},{task:"Meal plan for week",person:"Shawnie",icon:"üìù"}],
    1:[{task:"Clean bathroom",person:"Rich",icon:"üöø"},{task:"Mop kitchen floor",person:"Rich",icon:"üßπ"}],
    2:[{task:"Change bed sheets",person:"Both",icon:"üõèÔ∏è"},{task:"Dust surfaces",person:"Either",icon:"‚ú®"}],
    3:[{task:"Deep clean kitchen",person:"Rich",icon:"‚ú®"},{task:"Budget review",person:"Shawnie",icon:"üìä"}],
    4:[{task:"Hoover whole house",person:"Rich",icon:"üßπ"},{task:"Clean mirrors/windows",person:"Either",icon:"ü™ü"}],
    5:[{task:"Tidy/declutter session",person:"Both",icon:"üì¶"},{task:"Food shopping",person:"Both",icon:"üõí"}],
    6:[{task:"Laundry catch-up",person:"Rich",icon:"üëï"},{task:"Week prep",person:"Both",icon:"üìã"}]
  }
};

const defaultGoals=[
  {id:1,icon:"‚ö°",title:"Become Qualified Electrician",subtitle:"Rich's career - 3 year path",person:"Rich",priority:"critical",
    steps:[
      {id:1,text:"Visit apprenticeships.gov.uk - search Sheffield",done:false,date:"Dec 2025",time:"30min"},
      {id:2,text:"Contact Sheffield College: 0114 260 2600",done:false,date:"Dec 2025",time:"20min"},
      {id:3,text:"Join Facebook: Sheffield Electricians group",done:false,date:"Dec 2025",time:"15min"},
      {id:4,text:"Check Skills Bootcamp intakes",done:false,date:"Jan 2026",time:"30min"},
      {id:5,text:"Apply to 3+ apprenticeship programs",done:false,date:"Jan 2026",time:"2hr"},
      {id:6,text:"Check Advanced Learner Loan eligibility",done:false,date:"Jan 2026",time:"30min"},
      {id:7,text:"Secure apprenticeship position",done:false,date:"Mar 2026",time:""},
      {id:8,text:"Begin Level 2 Electrical Installation",done:false,date:"Sep 2026",time:""},
      {id:9,text:"Complete Level 2",done:false,date:"Sep 2027",time:""},
      {id:10,text:"Complete Level 3",done:false,date:"Sep 2028",time:""},
      {id:11,text:"Pass 18th Edition (BS 7671)",done:false,date:"2028",time:""},
      {id:12,text:"Pass AM2 Assessment",done:false,date:"2028",time:""},
      {id:13,text:"Obtain JIB Gold Card",done:false,date:"2028",time:""},
      {id:14,text:"Secure qualified position ¬£40k+",done:false,date:"Dec 2028",time:""}
    ]},
  {id:2,icon:"üíº",title:"Shawnie Career Progression",subtitle:"Band 6 ‚Üí Band 7 ‚Üí Band 8a",person:"Shawnie",priority:"critical",
    steps:[
      {id:1,text:"Research Sheffield PIP assessor vacancies",done:false,date:"Apr 2026",time:"1hr"},
      {id:2,text:"Apply for Tax-Free Childcare account",done:false,date:"Apr 2026",time:"30min"},
      {id:3,text:"Book Madison childcare place",done:false,date:"May 2026",time:"2hr"},
      {id:4,text:"Confirm return to work with employer",done:false,date:"May 2026",time:"30min"},
      {id:5,text:"Return to work (Band 6 - ¬£40k)",done:false,date:"Jul 2026",time:""},
      {id:6,text:"Research Band 7 requirements",done:false,date:"Sep 2026",time:"1hr"},
      {id:7,text:"Identify training/CPD opportunities",done:false,date:"2026",time:"2hr"},
      {id:8,text:"Apply for Band 7 Senior position (~¬£46-52k)",done:false,date:"Jul 2027",time:""},
      {id:9,text:"Complete Band 7 transition",done:false,date:"2027",time:""},
      {id:10,text:"Research Band 8a Team Lead roles",done:false,date:"2028",time:"1hr"},
      {id:11,text:"Apply for Band 8a position (~¬£53-60k)",done:false,date:"2029",time:""},
      {id:12,text:"Achieve Band 8a (~¬£55k+)",done:false,date:"2030",time:""}
    ]},
  {id:3,icon:"üöö",title:"Move to Sheffield",subtitle:"Relocate by late 2026",person:"Family",priority:"critical",
    steps:[
      {id:1,text:"Research areas: Crookes, Walkley, Hillsborough",done:false,date:"Dec 2025",time:"1hr"},
      {id:2,text:"Set rental budget (¬£650-900/mo)",done:false,date:"Jan 2026",time:"30min"},
      {id:3,text:"Day trip to explore Sheffield",done:false,date:"Mar 2026",time:"Full day"},
      {id:4,text:"View 10+ rental properties",done:false,date:"Jun-Aug 2026",time:""},
      {id:5,text:"Secure rental property",done:false,date:"Aug 2026",time:""},
      {id:6,text:"Update addresses (DVLA, bank, GP)",done:false,date:"Oct 2026",time:"2hr"},
      {id:7,text:"Moving day!",done:false,date:"Nov 2026",time:""}
    ]},
  {id:4,icon:"üè°",title:"Buy First Home",subtitle:"Sheffield homeowners by 2030",person:"Family",priority:"high",
    steps:[
      {id:1,text:"Check credit scores (ClearScore)",done:false,date:"2026",time:"20min"},
      {id:2,text:"Get on electoral roll at new address",done:false,date:"Nov 2026",time:"10min"},
      {id:3,text:"Open Lifetime ISAs (both) - 25% bonus",done:false,date:"2027",time:"1hr"},
      {id:4,text:"Research First Homes scheme",done:false,date:"2029",time:"1hr"},
      {id:5,text:"Build deposit to ¬£25,000",done:false,date:"2029",time:""},
      {id:6,text:"Get mortgage agreement in principle",done:false,date:"2029",time:"2hr"},
      {id:7,text:"Start house hunting",done:false,date:"2029",time:""},
      {id:8,text:"Complete purchase - HOMEOWNERS!",done:false,date:"2030",time:""}
    ]},
  {id:5,icon:"üí∞",title:"Financial Survival & Growth",subtitle:"Bridge the gap, then build wealth",person:"Family",priority:"critical",
    steps:[
      {id:1,text:"Apply for social broadband (save ¬£20/mo)",done:false,date:"Dec 2025",time:"30min"},
      {id:2,text:"Survive to July 2026",done:false,date:"Jul 2026",time:""},
      {id:3,text:"Build ¬£500 mini emergency fund",done:false,date:"Dec 2026",time:""},
      {id:4,text:"Build ¬£3,000 emergency fund",done:false,date:"Dec 2027",time:""},
      {id:5,text:"Build ¬£10,000 emergency fund",done:false,date:"2028",time:""},
      {id:6,text:"Save ¬£1,000+/month for deposit",done:false,date:"2028",time:""},
      {id:7,text:"Reach ¬£95k+ combined income",done:false,date:"2029",time:""}
    ]},
  {id:6,icon:"üéì",title:"Madison's Journey",subtitle:"Nursery ‚Üí School milestones",person:"Madison",priority:"high",
    steps:[
      {id:1,text:"2-year health check",done:false,date:"Feb 2026",time:"1hr"},
      {id:2,text:"Apply for 15hrs free childcare (age 2)",done:false,date:"Feb 2026",time:"30min"},
      {id:3,text:"Start nursery",done:false,date:"Sep 2026",time:""},
      {id:4,text:"Apply for 30hrs free childcare (age 3)",done:false,date:"Feb 2027",time:"30min"},
      {id:5,text:"Research Sheffield primary schools",done:false,date:"2027",time:"2hr"},
      {id:6,text:"Apply for Reception place",done:false,date:"Jan 2028",time:"1hr"},
      {id:7,text:"Madison starts school!",done:false,date:"Sep 2028",time:""}
    ]},
  {id:7,icon:"üíï",title:"Family Time & Wellbeing",subtitle:"Quality time together",person:"Family",priority:"medium",
    steps:[
      {id:1,text:"Weekly board game night",done:false,date:"Ongoing",time:"2hr/week"},
      {id:2,text:"Monthly family day out",done:false,date:"Ongoing",time:""},
      {id:3,text:"Weekly date night (after Madison sleeps)",done:false,date:"Ongoing",time:"2hr/week"},
      {id:4,text:"Visit Harrogate friends quarterly",done:false,date:"Ongoing",time:""},
      {id:5,text:"Visit Sheffield friends quarterly",done:false,date:"Ongoing",time:""},
      {id:6,text:"Regular family visits",done:false,date:"Ongoing",time:""}
    ]},
  {id:8,icon:"üë¥",title:"Pensions & Protection",subtitle:"Long-term security",person:"Family",priority:"medium",
    steps:[
      {id:1,text:"Find Shawnie's existing pension",done:false,date:"Dec 2025",time:"1hr"},
      {id:2,text:"Check apprenticeship pension options",done:false,date:"Sep 2026",time:"30min"},
      {id:3,text:"Get life insurance quotes",done:false,date:"2027",time:"1hr"},
      {id:4,text:"Shawnie maximize employer pension",done:false,date:"2026",time:""},
      {id:5,text:"Open Junior ISA for Madison",done:false,date:"2027",time:"30min"},
      {id:6,text:"Get income protection insurance",done:false,date:"2028",time:"1hr"}
    ]}
];

const defaultBenefits=[
  {id:'uc',name:'Universal Credit',claimed:true,saving:null},
  {id:'cb',name:'Child Benefit (¬£25.60/wk)',claimed:true,saving:111},
  {id:'ctReduction',name:'Council Tax Reduction',claimed:true,saving:null},
  {id:'warmHome',name:'Warm Home Discount (¬£150/yr)',claimed:true,saving:150},
  {id:'healthyStart',name:'Healthy Start Vouchers (¬£8.50/wk)',claimed:true,saving:442},
  {id:'socialBroadband',name:'Social Broadband (save ¬£20/mo)',claimed:false,saving:240},
  {id:'waterSocial',name:'Water Social Tariff',claimed:true,saving:200},
  {id:'freeDental',name:'Free NHS Dental (HC2)',claimed:true,saving:70},
  {id:'freeEyeTest',name:'Free Eye Tests',claimed:true,saving:25}
];

const defaultBudget={
  income:{shawnieNet:0,richNet:0,childBenefit:108,universalCredit:1800,pip:0,other:200},
  expenses:{
    rent:700,councilTax:0,electric:120,gas:80,water:35,broadband:30,
    phoneRich:15,phoneShawnie:15,carFinance:200,carInsurance:80,petrol:100,
    groceries:400,childcare:0,subscriptions:40,insurance:30,other:50
  },
  savings:{emergency:0,houseDeposit:0,lisaRich:0,lisaShawnie:0,madisonJISA:0,pension:0}
};

const defaultMilestones=[
  {id:'first-smile',title:'First Smile',date:'2025-09',icon:'üòä',achieved:true,photo:null,notes:''},
  {id:'first-laugh',title:'First Laugh',date:'2025-11',icon:'üòÑ',achieved:false,photo:null,notes:''},
  {id:'rolling-over',title:'Rolling Over',date:'2025-12',icon:'üîÑ',achieved:true,photo:null,notes:''},
  {id:'first-unassisted-sit',title:'First Unassisted Sit',date:'2026-01',icon:'ü™ë',achieved:false,photo:null,notes:''},
  {id:'first-crawl',title:'First Crawl',date:'2026-04',icon:'üë∂',achieved:false,photo:null,notes:''},
  {id:'first-words',title:'First Words',date:'2026-07',icon:'üí¨',achieved:false,photo:null,notes:''},
  {id:'first-steps',title:'First Steps',date:'2026-07',icon:'üë£',achieved:false,photo:null,notes:''},
  {id:'first-birthday',title:'First Birthday',date:'2026-07-09',icon:'üéÇ',achieved:false,photo:null,notes:''},
  {id:'first-christmas',title:'First Christmas',date:'2025-12',icon:'üéÑ',achieved:false,photo:null,notes:''},
  {id:'first-swim',title:'First Swim',date:'2026-08',icon:'üèä',achieved:false,photo:null,notes:''},
  {id:'first-tooth',title:'First Tooth',date:'2026-01',icon:'ü¶∑',achieved:false,photo:null,notes:''},
  {id:'first-holiday',title:'First Family Holiday',date:'2026',icon:'üèñÔ∏è',achieved:false,photo:null,notes:''},
  {id:'first-day-nursery',title:'First Day Nursery',date:'2027',icon:'üè´',achieved:false,photo:null,notes:''},
  {id:'potty-trained',title:'Potty Trained',date:'2027',icon:'üöΩ',achieved:false,photo:null,notes:''},
  {id:'first-bike',title:'First Bike Ride',date:'2028',icon:'üö≤',achieved:false,photo:null,notes:''},
  {id:'first-school-day',title:'First Day School',date:'2029',icon:'üéí',achieved:false,photo:null,notes:''}
];

const familyAndFriends={
  sheffield:[
    {id:'kyle-dunja',names:'Kyle & Dunja',type:'friends',icon:'üë´',relation:'Friends',lastSeen:'',notes:''},
    {id:'kat',names:'Kat',type:'friend',icon:'üë§',relation:'Friend',lastSeen:'',notes:''}
  ],
  harrogate:[
    {id:'luke',names:'Luke',type:'friend',icon:'üë§',relation:'Friend',lastSeen:'',notes:''},
    {id:'rheiza',names:'Rheiza',type:'friend',icon:'üë§',relation:'Friend',lastSeen:'',notes:''}
  ],
  durham:[
    {id:'kay-family',names:'Kay, Richard & Zachary',type:'friends',icon:'üë®‚Äçüë©‚Äçüë¶',relation:'Friends & Son',lastSeen:'',notes:''}
  ],
  peterlee:[
    {id:'debbie-mick',names:'Debbie & Mick',type:'family',icon:'üë¥üëµ',relation:'Shawnie\'s Parents',lastSeen:'',notes:''}
  ],
  richFamily:[
    {id:'emily-isaac',names:'Emily & Isaac',type:'family',icon:'üë©‚Äçüë¶',relation:'Rich\'s Sister & Nephew',lastSeen:'',notes:''},
    {id:'becky-sully',names:'Becky & Sully',type:'family',icon:'üëµüë¥',relation:'Rich\'s Mom & Partner',lastSeen:'',notes:''}
  ],
  shawnieFamily:[
    {id:'jemma-family',names:'Jemma, James, Amelia & Oliver',type:'family',icon:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',relation:'Shawnie\'s Sister, Brother-in-law & Kids',lastSeen:'',notes:''},
    {id:'flora',names:'Flora',type:'family',icon:'üëµ',relation:'Shawnie\'s Grandma',lastSeen:'',notes:''},
    {id:'albert',names:'Albert',type:'family',icon:'üë¥',relation:'Shawnie\'s Grandad',lastSeen:'',notes:''},
    {id:'carole-jim',names:'Carole & Jim',type:'family',icon:'üëµüë¥',relation:'Shawnie\'s Grandma & Great-Grandad',lastSeen:'',notes:''}
  ]
};

const tailoredDailyTasks={
  family:[
    {task:'Wake & change Madison',person:'Both',exactTime:'7:00',icon:'üë∂',priority:'critical',xp:10},
    {task:'Madison breakfast',person:'Both',exactTime:'8:00',icon:'üçº',priority:'critical',xp:10},
    {task:'Tummy time',person:'Either',exactTime:'9:00',icon:'ü§∏',priority:'high',xp:8},
    {task:'Morning nap',person:'Either',exactTime:'10:00',icon:'üò¥',priority:'high',xp:5},
    {task:'Madison lunch',person:'Both',exactTime:'12:00',icon:'üçº',priority:'critical',xp:10},
    {task:'Play & activities',person:'Either',exactTime:'13:00',icon:'üéÆ',priority:'high',xp:8},
    {task:'Afternoon nap',person:'Either',exactTime:'14:30',icon:'üò¥',priority:'high',xp:5},
    {task:'Madison dinner',person:'Both',exactTime:'17:00',icon:'üçº',priority:'critical',xp:10},
    {task:'Bath time',person:'Rich',exactTime:'18:30',icon:'üõÅ',priority:'critical',xp:10},
    {task:'Bedtime routine',person:'Both',exactTime:'19:00',icon:'üìñ',priority:'critical',xp:15}
  ],
  house:[
    {task:'Make beds',person:'Both',exactTime:'8:30',icon:'üõèÔ∏è',priority:'medium',xp:5},
    {task:'Kitchen clean',person:'Rich',exactTime:'9:30',icon:'üßΩ',priority:'medium',xp:5},
    {task:'Laundry',person:'Rich',exactTime:'10:30',icon:'üëï',priority:'low',xp:5},
    {task:'Living room tidy',person:'Either',exactTime:'15:00',icon:'üõãÔ∏è',priority:'low',xp:3},
    {task:'Dinner prep',person:'Rich',exactTime:'16:30',icon:'üç≥',priority:'high',xp:10},
    {task:'Evening tidy',person:'Both',exactTime:'20:00',icon:'‚ú®',priority:'low',xp:5}
  ],
  meals:[
    {task:'Family breakfast',person:'Rich',exactTime:'9:00',icon:'üç≥',priority:'high',xp:8},
    {task:'Family lunch',person:'Either',exactTime:'13:00',icon:'ü•™',priority:'high',xp:8},
    {task:'Family dinner',person:'Rich',exactTime:'18:00',icon:'üçΩÔ∏è',priority:'high',xp:10}
  ],
  goals:[
    {task:'Apprenticeship work',person:'Rich',exactTime:'10:00',icon:'‚ö°',priority:'critical',xp:25,goalId:1,frequency:'daily'},
    {task:'Sheffield research',person:'Both',exactTime:'20:30',icon:'üèòÔ∏è',priority:'high',xp:15,goalId:3,frequency:'weekly'},
    {task:'Check finances',person:'Shawnie',exactTime:'21:00',icon:'üí∞',priority:'high',xp:10,goalId:5,frequency:'daily'},
    {task:'Update Madison log',person:'Both',exactTime:'21:30',icon:'üë∂',priority:'medium',xp:10,goalId:6,frequency:'daily'}
  ],
  selfCare:[
    {task:'Rich relax time',person:'Rich',exactTime:'21:00',icon:'üéÆ',priority:'low',xp:5},
    {task:'Shawnie relax time',person:'Shawnie',exactTime:'21:00',icon:'‚òï',priority:'low',xp:5},
    {task:'Couple time',person:'Both',exactTime:'22:00',icon:'‚ù§Ô∏è',priority:'medium',xp:10}
  ]
};

const weeklySpecialTasks={
  0:[
    {task:'Hoover whole house',person:'Rich',icon:'üßπ',category:'cleaning'},
    {task:'Meal plan for week',person:'Both',icon:'üìù',category:'planning'},
    {task:'Sunday roast prep',person:'Rich',icon:'üçó',category:'cooking'}
  ],
  1:[
    {task:'Clean bathroom',person:'Rich',icon:'üöø',category:'cleaning'},
    {task:'Apprenticeship applications',person:'Rich',icon:'‚ö°',category:'goals'}
  ],
  2:[
    {task:'Change bed sheets',person:'Both',icon:'üõèÔ∏è',category:'cleaning'}
  ],
  3:[
    {task:'Deep clean kitchen',person:'Rich',icon:'‚ú®',category:'cleaning'},
    {task:'Budget review meeting',person:'Both',icon:'üìä',category:'goals'}
  ],
  4:[
    {task:'Hoover whole house',person:'Rich',icon:'üßπ',category:'cleaning'}
  ],
  5:[
    {task:'Food shopping',person:'Both',icon:'üõí',category:'essential'},
    {task:'Tidy/declutter session',person:'Both',icon:'üì¶',category:'cleaning'}
  ],
  6:[]
};

const defaultMadisonData={
  birthDate:'2025-07-09',
  growth:[
    {id:1,date:'2025-07-09',height:50,weight:3.4,headCirc:35,notes:'Birth measurements'},
    {id:2,date:'2025-08-09',height:56,weight:4.8,headCirc:38,notes:'1-month check'},
    {id:3,date:'2025-10-09',height:61,weight:6.2,headCirc:41,notes:'3-month check'},
    {id:4,date:'2025-12-09',height:65,weight:7.0,headCirc:43,notes:'5-month check'}
  ],
  vaccinations:[
    {id:'8wk-1',name:'6-in-1 vaccine (1st dose)',ageWeeks:8,completed:true,date:'2025-09-03'},
    {id:'8wk-2',name:'Rotavirus (1st dose)',ageWeeks:8,completed:true,date:'2025-09-03'},
    {id:'8wk-3',name:'MenB (1st dose)',ageWeeks:8,completed:true,date:'2025-09-03'},
    {id:'12wk-1',name:'6-in-1 vaccine (2nd dose)',ageWeeks:12,completed:true,date:'2025-10-01'},
    {id:'12wk-2',name:'Pneumococcal (PCV)',ageWeeks:12,completed:true,date:'2025-10-01'},
    {id:'12wk-3',name:'Rotavirus (2nd dose)',ageWeeks:12,completed:true,date:'2025-10-01'},
    {id:'16wk-1',name:'6-in-1 vaccine (3rd dose)',ageWeeks:16,completed:false,date:''},
    {id:'16wk-2',name:'MenB (2nd dose)',ageWeeks:16,completed:false,date:''},
    {id:'1yr-1',name:'Hib/MenC (1st dose)',ageMonths:12,completed:false,date:''},
    {id:'1yr-2',name:'MMR (1st dose)',ageMonths:12,completed:false,date:''},
    {id:'1yr-3',name:'Pneumococcal (2nd dose)',ageMonths:12,completed:false,date:''},
    {id:'1yr-4',name:'MenB (3rd dose)',ageMonths:12,completed:false,date:''},
    {id:'2yr',name:'Flu vaccine (annual)',ageYears:2,completed:false,date:''},
    {id:'3yr-1',name:'MMR (2nd dose)',ageYears:3,completed:false,date:''},
    {id:'3yr-2',name:'4-in-1 pre-school booster',ageYears:3,completed:false,date:''}
  ],
  developmental:{
    motor:[
      {id:'m1',skill:'Holds head steady',achieved:true,ageMonths:3,date:'2025-10-09'},
      {id:'m2',skill:'Rolls over both ways',achieved:true,ageMonths:5,date:'2025-12-09'},
      {id:'m3',skill:'Sits without support',achieved:false,ageMonths:6,date:''},
      {id:'m4',skill:'Crawls',achieved:false,ageMonths:9,date:''},
      {id:'m5',skill:'Pulls to standing',achieved:false,ageMonths:10,date:''},
      {id:'m6',skill:'Walks independently',achieved:false,ageMonths:12,date:''},
      {id:'m7',skill:'Runs',achieved:false,ageMonths:18,date:''},
      {id:'m8',skill:'Kicks ball',achieved:false,ageMonths:24,date:''},
      {id:'m9',skill:'Jumps with both feet',achieved:false,ageMonths:30,date:''}
    ],
    language:[
      {id:'l1',skill:'Responds to name',achieved:false,ageMonths:9,date:''},
      {id:'l2',skill:'Says "mama" or "dada"',achieved:false,ageMonths:11,date:''},
      {id:'l3',skill:'Says 3-5 words',achieved:false,ageMonths:15,date:''},
      {id:'l4',skill:'Points to named objects',achieved:false,ageMonths:18,date:''},
      {id:'l5',skill:'Uses 2-word phrases',achieved:false,ageMonths:24,date:''},
      {id:'l6',skill:'Speaks in sentences',achieved:false,ageMonths:36,date:''}
    ],
    social:[
      {id:'s1',skill:'Smiles at people',achieved:true,ageMonths:2,date:'2025-09-09'},
      {id:'s2',skill:'Plays peek-a-boo',achieved:false,ageMonths:9,date:''},
      {id:'s3',skill:'Waves bye-bye',achieved:false,ageMonths:10,date:''},
      {id:'s4',skill:'Shows affection to familiar people',achieved:false,ageMonths:12,date:''},
      {id:'s5',skill:'Plays alongside other children',achieved:false,ageMonths:24,date:''},
      {id:'s6',skill:'Takes turns in games',achieved:false,ageMonths:36,date:''}
    ],
    cognitive:[
      {id:'c1',skill:'Looks at things when you point',achieved:false,ageMonths:12,date:''},
      {id:'c2',skill:'Finds hidden objects',achieved:false,ageMonths:15,date:''},
      {id:'c3',skill:'Knows names of familiar people',achieved:false,ageMonths:18,date:''},
      {id:'c4',skill:'Sorts shapes and colors',achieved:false,ageMonths:24,date:''},
      {id:'c5',skill:'Counts to 10',achieved:false,ageMonths:48,date:''}
    ]
  },
  health:[
    {id:1,date:'2025-07-09',type:'Birth',notes:'Born healthy, 3.4kg, 50cm',weight:3.4,height:50},
    {id:2,date:'2025-07-23',type:'Check-up',notes:'2-week check - all good',weight:3.8,height:52},
    {id:3,date:'2025-10-09',type:'Check-up',notes:'3-month development check - meeting milestones',weight:6.2,height:61},
    {id:4,date:'2025-12-09',type:'Check-up',notes:'5-month check - rolling over, very alert',weight:7.0,height:65}
  ]
};

const createDefaultData=()=>({
  goals:defaultGoals,
  benefits:defaultBenefits,
  budget:defaultBudget,
  completedTasks:{},
  lastReset:new Date().toDateString(),
  milestones:defaultMilestones,
  notes:[],
  events:{},
  madison:defaultMadisonData,
  familyFriends:familyAndFriends,
  socialLog:[],
  gamification:{
    xp:0,
    level:1,
    streak:0,
    longestStreak:0,
    totalTasksCompleted:0,
    achievements:[],
    dailyXP:{},
    monthlyCompletion:{}
  }
});

const createDefaultConfig=()=>({
  familyName:'Turnbull-Shaw',
  location:'Seaham',
  targetLocation:'Sheffield',
  startDate:'2025-12-04',
  shawnieReturnDate:'2026-07-01',
  shawnieBirthDate:'1992-01-11',
  richBirthDate:'1990-12-16',
  richPension:72766.58,
  shawniePension:0,
  emergencyFund:0,
  houseDeposit:0
});

const App=()=>{
  const[tab,setTab]=useState('overview');
  const[data,setData]=useState(createDefaultData);
  const[config,setConfig]=useState(createDefaultConfig);
  const[darkMode,setDarkMode]=useState(()=>localStorage.getItem('darkMode')==='true');
  const[selectedDate,setSelectedDate]=useState(new Date());
  const[expandedGoals,setExpandedGoals]=useState({});
  const[showCelebration,setShowCelebration]=useState(false);
  const[celebrationText,setCelebrationText]=useState('');
  const[showAchievement,setShowAchievement]=useState(false);
  const[achievementText,setAchievementText]=useState('');
  const[showNoteModal,setShowNoteModal]=useState(false);
  const[showEventModal,setShowEventModal]=useState(false);
  const[noteText,setNoteText]=useState('');
  const[eventForm,setEventForm]=useState({time:'',title:'',desc:'',who:''});
  const[searchTerm,setSearchTerm]=useState('');
  const[searchResults,setSearchResults]=useState({goals:[],notes:[],benefits:[]});
  const[showGrowthModal,setShowGrowthModal]=useState(false);
  const[showHealthModal,setShowHealthModal]=useState(false);
  const[growthForm,setGrowthForm]=useState({height:'',weight:'',headCirc:'',notes:''});
  const[healthForm,setHealthForm]=useState({type:'Check-up',notes:'',weight:'',height:''});
  const[madisonTab,setMadisonTab]=useState('overview');

  useEffect(()=>{
    try{
      const savedData=JSON.parse(localStorage.getItem('familyHubV12Data')||'null');
      const savedConfig=JSON.parse(localStorage.getItem('familyHubV12Config')||'null');
      if(savedData)setData({...createDefaultData(),...savedData});
      if(savedConfig)setConfig({...createDefaultConfig(),...savedConfig});
    }catch(e){
      console.error('Failed to load saved data:',e);
      alert('Error loading saved data. Starting fresh.');
    }
  },[]);

  // Auto-save with debouncing for performance
  useEffect(()=>{
    const timer=setTimeout(()=>{
      try{
        localStorage.setItem('familyHubV12Data',JSON.stringify(data));
      }catch(e){
        console.error('Failed to save data:',e);
        if(e.name==='QuotaExceededError')alert('Storage full! Clear old photos in Settings.');
      }
    },500);
    return()=>clearTimeout(timer);
  },[data]);
  
  useEffect(()=>{
    try{
      localStorage.setItem('familyHubV12Config',JSON.stringify(config));
    }catch(e){
      console.error('Failed to save config:',e);
    }
  },[config]);

  useEffect(()=>{
    const today=new Date().toDateString();
    if(data.lastReset!==today){
      const newCompleted={...data.completedTasks};
      Object.keys(newCompleted).forEach(key=>{if(key.startsWith('daily-'))delete newCompleted[key]});
      setData(prev=>({...prev,completedTasks:newCompleted,lastReset:today}));
    }
  },[]);
  
  useEffect(()=>{
    const handleKeyDown=(e)=>{
      // Ctrl+K or Cmd+K to focus search
      if((e.ctrlKey||e.metaKey)&&e.key==='k'){
        e.preventDefault();
        const searchInput=document.querySelector('input[placeholder*="Search"]');
        if(searchInput)searchInput.focus();
        return;
      }
      
      // / key to focus search (like GitHub)
      if(e.key==='/'&&!['INPUT','TEXTAREA'].includes(e.target.tagName)){
        e.preventDefault();
        const searchInput=document.querySelector('input[placeholder*="Search"]');
        if(searchInput)searchInput.focus();
        return;
      }
      
      if(e.key==='Escape'){
        if(showNoteModal)setShowNoteModal(false);
        if(showEventModal)setShowEventModal(false);
      }
      if(e.key==='ArrowLeft'&&tab==='calendar'){
        const d=new Date(selectedDate);
        d.setDate(d.getDate()-1);
        setSelectedDate(d);
      }
      if(e.key==='ArrowRight'&&tab==='calendar'){
        const d=new Date(selectedDate);
        d.setDate(d.getDate()+1);
        setSelectedDate(d);
      }
    };
    window.addEventListener('keydown',handleKeyDown);
    return()=>window.removeEventListener('keydown',handleKeyDown);
},[showNoteModal,showEventModal,tab,selectedDate]);
  
  useEffect(()=>{
    localStorage.setItem('darkMode',darkMode);
    document.body.classList.toggle('dark',darkMode);
  },[darkMode]);
  
  useEffect(()=>{
    const checkStreak=()=>{
      const today=new Date().toDateString();
      const dateKey=new Date().toISOString().split('T')[0];
      
      const allTaskCategories=['family','house','meals','goals','selfCare'];
      let totalTodayTasks=0;
      allTaskCategories.forEach(cat=>{
        if(tailoredDailyTasks[cat]){
          totalTodayTasks+=tailoredDailyTasks[cat].length;
        }
      });
      
      const completedTodayTasks=Object.keys(data.completedTasks).filter(key=>
        key.includes(dateKey)&&data.completedTasks[key]
      ).length;
      
      const completionRate=totalTodayTasks>0?completedTodayTasks/totalTodayTasks:0;
      
      if(completionRate>=0.8&&data.lastReset===today){
        const newStreak=(data.gamification?.streak||0)+1;
        const longestStreak=Math.max(newStreak,data.gamification?.longestStreak||0);
        
        setData(prev=>({
          ...prev,
          gamification:{
            ...prev.gamification,
            streak:newStreak,
            longestStreak:longestStreak
          }
        }));
        
        if(newStreak===7){
          setAchievementText('üî• WEEK WARRIOR! 7 Day Streak!');
          setShowAchievement(true);
          setTimeout(()=>setShowAchievement(false),3000);
        }
      }
    };
    
    const timer=setTimeout(checkStreak,1000);
    return()=>clearTimeout(timer);
  },[data.completedTasks,data.lastReset,data.gamification]);
  
const celebrate=(text='üéâ Done!')=>{setCelebrationText(text);setShowCelebration(true);setTimeout(()=>setShowCelebration(false),1500)};
  
  const calculateXP=(taskKey,taskXP=5)=>{
    const newXP=(data.gamification?.xp||0)+taskXP;
    const newLevel=Math.floor(newXP/100)+1;
    const oldLevel=data.gamification?.level||1;
    
    setData(prev=>({
      ...prev,
      gamification:{
        ...prev.gamification,
        xp:newXP,
        level:newLevel,
        totalTasksCompleted:(prev.gamification?.totalTasksCompleted||0)+1,
        dailyXP:{
          ...prev.gamification?.dailyXP,
          [new Date().toISOString().split('T')[0]]:(prev.gamification?.dailyXP?.[new Date().toISOString().split('T')[0]]||0)+taskXP
        }
      }
    }));
    
    if(newLevel>oldLevel){
      setAchievementText(`üéâ LEVEL ${newLevel}!`);
      setShowAchievement(true);
      setTimeout(()=>setShowAchievement(false),3000);
    }
    
    celebrate(`+${taskXP} XP!`);
  };
  const toggleTask=useCallback((taskKey,taskXP=5)=>{
    const wasCompleted=data.completedTasks[taskKey];
    if(!wasCompleted){
      calculateXP(taskKey,taskXP);
    }
    setData(prev=>({...prev,completedTasks:{...prev.completedTasks,[taskKey]:!wasCompleted}}));
  },[data.completedTasks,calculateXP]);

const toggleGoalStep=useCallback((goalId,stepId)=>{
  const goal=data.goals.find(g=>g.id===goalId);
  const step=goal?.steps.find(s=>s.id===stepId);
  if(step&&!step.done)celebrate('üéØ Progress!');
  setData(prev=>({...prev,goals:prev.goals.map(g=>g.id===goalId?{...g,steps:g.steps.map(s=>s.id===stepId?{...s,done:!s.done}:s)}:g)}));
},[data.goals]);

const toggleBenefit=useCallback((id)=>{
  setData(prev=>({...prev,benefits:prev.benefits.map(b=>b.id===id?{...b,claimed:!b.claimed}:b)}));
},[]);

const updateBudget=useCallback((cat,field,val)=>{
  const numVal=Number(val);
  
  // Validation
  if(isNaN(numVal)){
    console.warn('Invalid number input');
    return;
  }
  if(numVal<0){
    alert('Amount cannot be negative');
    return;
  }
  if(numVal>100000){
    if(!confirm(`¬£${numVal.toLocaleString()} seems unusually high. Continue?`)){
      return;
    }
  }
  
  setData(prev=>({...prev,budget:{...prev.budget,[cat]:{...prev.budget[cat],[field]:numVal}}}));
},[]);

const toggleMilestone=useCallback((id)=>{
  const m=data.milestones.find(ms=>ms.id===id);
  if(m&&!m.achieved){
    let xpValue=50;
    if(id==='first-steps'||id==='first-words')xpValue=150;
    else if(id==='first-birthday')xpValue=500;
    else if(id==='first-crawl')xpValue=100;
    else if(id==='first-tooth')xpValue=75;
    calculateXP(`photo-milestone-${id}`,xpValue);
    celebrate(`üéâ ${xpValue} XP! Milestone!`);
  }
  setData(prev=>({...prev,milestones:prev.milestones.map(ms=>ms.id===id?{...ms,achieved:!ms.achieved}:ms)}));
},[data.milestones,calculateXP]);

const uploadMilestonePhoto=useCallback((id,file)=>{
  // Check file size FIRST
  if(file.size>5*1024*1024){
    alert('Image too large! Please use an image under 5MB.');
    return;
  }
  
  // Check file type
  if(!file.type.startsWith('image/')){
    alert('Please select an image file (JPG, PNG, etc.)');
    return;
  }
  
  const reader=new FileReader();
    reader.onload=(e)=>{
      const img=new Image();
      img.onload=()=>{
        const canvas=document.createElement('canvas');
        let width=img.width;
        let height=img.height;
        const maxSize=800;
        if(width>height&&width>maxSize){
          height*=maxSize/width;
          width=maxSize;
        }else if(height>maxSize){
          width*=maxSize/height;
          height=maxSize;
        }
        canvas.width=width;
        canvas.height=height;
        const ctx=canvas.getContext('2d');
        ctx.drawImage(img,0,0,width,height);
        const compressed=canvas.toDataURL('image/jpeg',0.7);
        if(compressed.length>500*1024){
          alert('Image still too large after compression. Try a smaller photo.');
          return;
        }
        setData(prev=>({...prev,milestones:prev.milestones.map(ms=>ms.id===id?{...ms,photo:compressed}:ms)}));
        checkStorageUsage();
      };
      img.src=e.target.result;
    };
    reader.readAsDataURL(file);
  },[]);

  const checkStorageUsage=()=>{
    try{
      let used=0;
      for(let key in localStorage){
        if(localStorage.hasOwnProperty(key)){
          used+=localStorage[key].length+key.length;
        }
      }
      const limit=5*1024*1024;
      if(used>limit*0.8){
        alert(`Storage ${Math.round((used/limit)*100)}% full - consider clearing old photos in Settings`);
      }
    }catch(e){console.error(e)}
  };

const addNote=useCallback(()=>{
  const trimmed=noteText.trim();
  
  if(!trimmed){
    alert('Please enter some text for your note');
    return;
  }
  
  if(trimmed.length>5000){
    alert('Note is too long (max 5000 characters)');
    return;
  }
  
  const note={id:Date.now(),date:new Date().toISOString(),text:trimmed};
  setData(prev=>({...prev,notes:[note,...prev.notes]}));
  setNoteText('');
  setShowNoteModal(false);
  celebrate('üìù Note Saved!');
},[noteText]);
  const deleteNote=(id)=>{
    setData(prev=>({...prev,notes:prev.notes.filter(n=>n.id!==id)}));
  };

const addEvent=useCallback(()=>{
  // Validation
  if(!eventForm.time){
    alert('Please select a time');
    return;
  }
  if(!eventForm.title.trim()){
    alert('Please enter an event title');
    return;
  }
  
  const dateKey=selectedDate.toISOString().split('T')[0];
  const event={
    id:Date.now(),
    time:eventForm.time,
    title:eventForm.title.trim(),
    desc:eventForm.desc.trim(),
    who:eventForm.who.trim()
  };
  setData(prev=>({...prev,events:{...prev.events,[dateKey]:[...(prev.events[dateKey]||[]),event]}}));
  setEventForm({time:'',title:'',desc:'',who:''});
  setShowEventModal(false);
  celebrate('üìÖ Event Added!');
},[eventForm,selectedDate]);

  const deleteEvent=(dateKey,eventId)=>{
    setData(prev=>({...prev,events:{...prev.events,[dateKey]:prev.events[dateKey].filter(e=>e.id!==eventId)}}));
  };
  const handleSearch=useCallback((term)=>{
  setSearchTerm(term);
  
  if(!term.trim()){
    setSearchResults({goals:[],notes:[],benefits:[]});
    return;
  }
  
  const lower=term.toLowerCase();
  
  // Search goals and steps
  const matchedGoals=data.goals.filter(g=>
    g.title.toLowerCase().includes(lower)||
    g.subtitle.toLowerCase().includes(lower)||
    g.steps.some(s=>s.text.toLowerCase().includes(lower))
  );
  
  // Search notes
  const matchedNotes=data.notes.filter(n=>
    n.text.toLowerCase().includes(lower)
  );
  
  // Search benefits
  const matchedBenefits=data.benefits.filter(b=>
    b.name.toLowerCase().includes(lower)
  );
  
  setSearchResults({
    goals:matchedGoals,
    notes:matchedNotes,
    benefits:matchedBenefits
  });
},[data.goals,data.notes,data.benefits]);

const highlightText=(text,term)=>{
  if(!term)return text;
  const regex=new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi');
  const parts=text.split(regex);
  return parts.map((part,i)=>
    regex.test(part)?<mark key={i} style={{background:'#fef3c7',padding:'0 2px',borderRadius:'2px'}}>{part}</mark>:part
  );
};

// Madison helper functions
const calculateAge=(birthDate)=>{
  const birth=new Date(birthDate);
  const now=new Date();
  const months=((now.getFullYear()-birth.getFullYear())*12)+(now.getMonth()-birth.getMonth());
  const years=Math.floor(months/12);
  const remainingMonths=months%12;
  return{years,months:remainingMonths,totalMonths:months};
};

const formatAge=(birthDate)=>{
  const{years,months}=calculateAge(birthDate);
  if(years===0)return`${months} month${months!==1?'s':''}`;
  if(months===0)return`${years} year${years!==1?'s':''}`;
  return`${years}y ${months}m`;
};

const addMadisonGrowth=useCallback((height,weight,headCirc,notes)=>{
  const newEntry={
    id:Date.now(),
    date:new Date().toISOString().split('T')[0],
    height:Number(height),
    weight:Number(weight),
    headCirc:Number(headCirc)||null,
    notes:notes.trim()
  };
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      growth:[...prev.madison.growth,newEntry]
    }
  }));
  celebrate('üìè Growth recorded!');
},[]);

const toggleVaccination=useCallback((id)=>{
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      vaccinations:prev.madison.vaccinations.map(v=>
        v.id===id?{...v,completed:!v.completed,date:v.completed?'':new Date().toISOString().split('T')[0]}:v
      )
    }
  }));
  celebrate('üíâ Updated!');
},[]);

const toggleDevMilestone=useCallback((category,id)=>{
  const milestone=data.madison.developmental[category]?.find(m=>m.id===id);
  if(milestone&&!milestone.achieved){
    const xpValue=category==='motor'?75:category==='language'?100:category==='social'?50:60;
    calculateXP(`milestone-${category}-${id}`,xpValue);
    celebrate(`üéâ ${xpValue} XP! Milestone!`);
  }
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      developmental:{
        ...prev.madison.developmental,
        [category]:prev.madison.developmental[category].map(m=>
          m.id===id?{...m,achieved:!m.achieved,date:m.achieved?'':new Date().toISOString().split('T')[0]}:m
        )
      }
    }
  }));
},[data.madison,calculateXP]);

const addHealthNote=useCallback((type,notes,weight,height)=>{
  const newNote={
    id:Date.now(),
    date:new Date().toISOString().split('T')[0],
    type,
    notes:notes.trim(),
    weight:weight?Number(weight):null,
    height:height?Number(height):null
  };
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      health:[...prev.madison.health,newNote]
    }
  }));
  celebrate('üè• Note saved!');
},[]);

  const totalIncome=useMemo(()=>Object.values(data.budget.income).reduce((a,b)=>a+b,0),[data.budget.income]);
  const totalExpenses=useMemo(()=>Object.values(data.budget.expenses).reduce((a,b)=>a+b,0),[data.budget.expenses]);
  const totalSavings=useMemo(()=>Object.values(data.budget.savings).reduce((a,b)=>a+b,0),[data.budget.savings]);
  const monthlyLeftover=useMemo(()=>totalIncome-totalExpenses-totalSavings,[totalIncome,totalExpenses,totalSavings]);

  const today=useMemo(()=>new Date(),[]);
  const returnDate=useMemo(()=>new Date(config.shawnieReturnDate),[config.shawnieReturnDate]);
  const daysUntilReturn=useMemo(()=>Math.max(0,Math.ceil((returnDate-today)/(1000*60*60*24))),[returnDate,today]);
  const monthsUntilReturn=useMemo(()=>Math.max(0,Math.ceil((returnDate-today)/(1000*60*60*24*30))),[returnDate,today]);
  const totalGapToBridge=useMemo(()=>monthlyLeftover<0?Math.abs(monthlyLeftover)*monthsUntilReturn:0,[monthlyLeftover,monthsUntilReturn]);

  const goalsProgress=useMemo(()=>{
    let total=0,done=0;
    data.goals.forEach(g=>{total+=g.steps.length;done+=g.steps.filter(s=>s.done).length});
    return{total,done,pct:total?Math.round((done/total)*100):0};
  },[data.goals]);

  const potentialSavings=data.benefits.filter(b=>!b.claimed&&b.saving).reduce((sum,b)=>sum+(b.saving||0),0);
  const totalSaved=config.emergencyFund+config.houseDeposit;

  const getWeekDates=()=>{
    const start=new Date(selectedDate);
    const day=start.getDay();
    const diff=day===0?-6:1-day; // Calculate offset to Monday
    return Array.from({length:7},(_,i)=>{
      const d=new Date(start);
      d.setDate(start.getDate()+diff+i);
      return d;
    });
  };

  const weekDates=getWeekDates();
  const dayOfWeek=selectedDate.getDay();
  const dayMeals=weeklyMeals[dayOfWeek]||{breakfast:{name:"TBD",cost:0,prep:"",cook:""},lunch:{name:"TBD",cost:0,prep:"",cook:""},dinner:{name:"TBD",cost:0,prep:"",cook:""}};
  const dayActivities=weeklyActivities[dayOfWeek]||[];
  const dayWeeklyTasks=dailyTasks.weekly[dayOfWeek]||[];
  const dailyMealCost=(dayMeals.breakfast.cost+dayMeals.lunch.cost+dayMeals.dinner.cost).toFixed(2);
  const dateKey=selectedDate.toISOString().split('T')[0];
  const isToday=(d)=>d.toDateString()===new Date().toDateString();
  const isSelected=(d)=>d.toDateString()===selectedDate.toDateString();
  const dayEvents=data.events[dateKey]||[];

  const currentGoalSteps = useMemo(() => {
  const now = new Date();
  const steps = [];

  data.goals.forEach(g => {
    g.steps
      .filter(s => !s.done)
      .slice(0, 2)
      .forEach(s => {
        if (
          s.date.includes('Dec 2025') ||
          s.date.includes('Jan 2026') ||
          s.date.includes('Ongoing') ||
          s.date.includes('2025')
        ) {
          steps.push({
            ...s,
            goalTitle: g.title,
            goalIcon: g.icon,
            person: g.person
          });
        }
      });
  });

  return steps.slice(0, 4);
}, [data.goals]);

  useEffect(()=>{
    if(tab==='budget'){
      const ctx=document.getElementById('budgetChart');
      if(ctx){
        const existingChart=Chart.getChart(ctx);
        if(existingChart){existingChart.destroy();}
        
        new Chart(ctx,{
          type:'doughnut',
          data:{
            labels:['Income','Expenses','Savings',monthlyLeftover>=0?'Leftover':'Shortfall'],
            datasets:[{
              data:[totalIncome,totalExpenses,totalSavings,Math.abs(monthlyLeftover)],
              backgroundColor:['#81b29a','#dc2626','#f2cc8f',monthlyLeftover>=0?'#3b82f6':'#f59e0b'],
              borderWidth:0
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{
                position:'bottom',
                labels:{
                  font:{family:'DM Sans',size:13},
                  padding:15,
                  color:darkMode?'#f9fafb':'#3d405b'
                }
              },
              tooltip:{
                callbacks:{
                  label:(context)=>{
                    const label=context.label||'';
                    const value=context.parsed||0;
                    return `${label}: ¬£${value}`;
                  }
                }
              }
            }
          }
        });
      }
      
      const savingsCtx=document.getElementById('savingsChart');
      if(savingsCtx){
        const existingChart=Chart.getChart(savingsCtx);
        if(existingChart){existingChart.destroy();}
        
        const months=['Dec 25','Jan 26','Feb 26','Mar 26','Apr 26','May 26','Jun 26','Jul 26','Aug 26','Sep 26','Oct 26','Nov 26','Dec 26'];
        const currentSavings=config.emergencyFund+config.houseDeposit;
        const currentIncome=totalIncome;
        const currentExpenses=totalExpenses;
        const monthlySavingsRate=totalSavings;
        
        const shawnieGrossReturn=40000;
        const shawnieNetReturn=2600;
        const childcareMonthly=640;
        const netGainFromReturn=shawnieNetReturn-childcareMonthly;
        
        const projected=months.map((_,i)=>{
          if(i===0)return currentSavings;
          if(i<7)return currentSavings+(monthlySavingsRate*(i));
          return currentSavings+(monthlySavingsRate*6)+((monthlySavingsRate+netGainFromReturn)*(i-6));
        });
        
        new Chart(savingsCtx,{
          type:'line',
          data:{
            labels:months,
            datasets:[{
              label:'Projected Savings',
              data:projected,
              borderColor:'#10b981',
              backgroundColor:'rgba(16,185,129,0.1)',
              fill:true,
              tension:0.4,
              pointRadius:5,
              pointHoverRadius:7,
              pointBackgroundColor:'#10b981',
              pointBorderColor:'#fff',
              pointBorderWidth:2
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{position:'bottom',labels:{font:{family:'DM Sans',size:13},color:darkMode?'#f9fafb':'#3d405b'}},
              tooltip:{
                callbacks:{
                  label:(context)=>`Savings: ¬£${Math.round(context.parsed.y).toLocaleString()}`
                }
              }
            },
            scales:{
              y:{
                beginAtZero:true,
                ticks:{
                  callback:(value)=>`¬£${(value/1000).toFixed(0)}k`,
                  color:darkMode?'#d1d5db':'#6b7280'
                },
                grid:{color:darkMode?'#374151':'#e5e7eb'}
              },
              x:{
                ticks:{color:darkMode?'#d1d5db':'#6b7280'},
                grid:{display:false}
              }
            }
          }
        });
      }
      
      const pensionCtx=document.getElementById('pensionChart');
      if(pensionCtx){
        const existingChart=Chart.getChart(pensionCtx);
        if(existingChart){existingChart.destroy();}
        
        const years=['2025','2030','2035','2040','2045','2050','2055'];
        const richPension=config.richPension||72766;
        const shawniePension=config.shawniePension||0;
        const growthRate=1.05;
        
        const richProjection=years.map((_,i)=>richPension*Math.pow(growthRate,i*5));
        const shawnieProjection=years.map((_,i)=>shawniePension*Math.pow(growthRate,i*5));
        
        new Chart(pensionCtx,{
          type:'line',
          data:{
            labels:years,
            datasets:[{
              label:'Rich',
              data:richProjection,
              borderColor:'#3b82f6',
              backgroundColor:'rgba(59,130,246,0.1)',
              fill:true,
              tension:0.4
            },{
              label:'Shawnie',
              data:shawnieProjection,
              borderColor:'#d4729b',
              backgroundColor:'rgba(212,114,155,0.1)',
              fill:true,
              tension:0.4
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{position:'bottom',labels:{font:{family:'DM Sans',size:13},color:darkMode?'#f9fafb':'#3d405b'}},
              tooltip:{
                callbacks:{
                  label:(context)=>`${context.dataset.label}: ¬£${Math.round(context.parsed.y/1000)}k`
                }
              }
            },
            scales:{
              y:{
                beginAtZero:true,
                ticks:{
                  callback:(value)=>`¬£${(value/1000).toFixed(0)}k`,
                  color:darkMode?'#d1d5db':'#6b7280'
                },
                grid:{color:darkMode?'#374151':'#e5e7eb'}
              },
              x:{
                ticks:{color:darkMode?'#d1d5db':'#6b7280'},
                grid:{display:false}
              }
            }
          }
        });
      }
    }
    
    if(tab==='madison'&&madisonTab==='growth'){
      const ctx=document.getElementById('growthChart');
      if(ctx&&data.madison?.growth){
        const existingChart=Chart.getChart(ctx);
        if(existingChart){existingChart.destroy();}
        
        const sortedGrowth=[...data.madison.growth].sort((a,b)=>new Date(a.date)-new Date(b.date));
        
        new Chart(ctx,{
          type:'line',
          data:{
            labels:sortedGrowth.map(g=>new Date(g.date).toLocaleDateString('en-GB',{month:'short',year:'2-digit'})),
            datasets:[
              {
                label:'Height (cm)',
                data:sortedGrowth.map(g=>g.height),
                borderColor:'#f2a65a',
                backgroundColor:'rgba(242,166,90,0.1)',
                tension:0.4,
                yAxisID:'y'
              },
              {
                label:'Weight (kg)',
                data:sortedGrowth.map(g=>g.weight),
                borderColor:'#81b29a',
                backgroundColor:'rgba(129,178,154,0.1)',
                tension:0.4,
                yAxisID:'y1'
              }
            ]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            interaction:{mode:'index',intersect:false},
            plugins:{
              legend:{position:'top'},
              tooltip:{
                callbacks:{
                  label:(context)=>`${context.dataset.label}: ${context.parsed.y}`
                }
              }
            },
            scales:{
              y:{
                type:'linear',
                display:true,
                position:'left',
                title:{display:true,text:'Height (cm)'},
                beginAtZero:false
              },
              y1:{
                type:'linear',
                display:true,
                position:'right',
                title:{display:true,text:'Weight (kg)'},
                beginAtZero:false,
                grid:{drawOnChartArea:false}
              }
            }
          }
        });
      }
    }
  },[tab,madisonTab,totalIncome,totalExpenses,totalSavings,monthlyLeftover,darkMode,data.madison]);

  const exportData=()=>{    const blob=new Blob([JSON.stringify({config,data,exportDate:new Date().toISOString()},null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;
    a.download=`family-hub-${new Date().toISOString().split('T')[0]}.json`;a.click();
  };

  const importData=(e)=>{
    const file=e.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=(ev)=>{try{const imp=JSON.parse(ev.target.result);if(imp.config)setConfig(imp.config);if(imp.data)setData(imp.data);alert('Imported!')}catch{alert('Error')}};
    reader.readAsText(file);
  };

  const renderTag=(p)=><span className={`tag tag-${p.toLowerCase()}`}>{p}</span>;

  const incomeLabels={shawnieNet:"Shawnie Net",richNet:"Rich Net",childBenefit:"Child Benefit",universalCredit:"Universal Credit",pip:"PIP",other:"Other"};
  const expenseLabels={rent:"Rent/Mortgage",councilTax:"Council Tax",electric:"Electric",gas:"Gas",water:"Water",broadband:"Broadband",phoneRich:"Phone Rich",phoneShawnie:"Phone Shawnie",carFinance:"Car Finance",carInsurance:"Car Insurance",petrol:"Petrol",groceries:"Groceries",childcare:"Childcare",subscriptions:"Subscriptions",insurance:"Insurance",other:"Other"};
  const savingsLabels={emergency:"Emergency Fund",houseDeposit:"House Deposit",lisaRich:"LISA Rich",lisaShawnie:"LISA Shawnie",madisonJISA:"Madison JISA",pension:"Extra Pension"};

  return(
    <div className="app">
      {showCelebration&&<div className="celebration"><div className="celebration-box">{celebrationText}</div></div>}
      {showAchievement&&<div className="achievement-toast">{achievementText}</div>}

      {/* Note Modal */}
      <div className={`modal ${showNoteModal?'show':''}`} onClick={()=>setShowNoteModal(false)} role="dialog" aria-modal="true" aria-labelledby="note-modal-title">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3 id="note-modal-title">Add Family Note</h3><button className="modal-close" onClick={()=>setShowNoteModal(false)} aria-label="Close modal">√ó</button></div>
          <div className="modal-body">
            <textarea className="modal-textarea" value={noteText} onChange={e=>setNoteText(e.target.value)} placeholder="What's on your mind?"/>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowNoteModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={addNote}>Save Note</button>
          </div>
        </div>
      </div>

      {/* Event Modal */}
      <div className={`modal ${showEventModal?'show':''}`} onClick={()=>setShowEventModal(false)} role="dialog" aria-modal="true" aria-labelledby="event-modal-title">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3 id="event-modal-title">Add Event</h3><button className="modal-close" onClick={()=>setShowEventModal(false)} aria-label="Close modal">√ó</button></div>
          <div className="modal-body">
            <div className="form-group"><label className="form-label">Time</label><input type="time" className="form-input" value={eventForm.time} onChange={e=>setEventForm({...eventForm,time:e.target.value})}/></div>
            <div className="form-group"><label className="form-label">Title</label><input type="text" className="form-input" value={eventForm.title} onChange={e=>setEventForm({...eventForm,title:e.target.value})} placeholder="Event name"/></div>
            <div className="form-group"><label className="form-label">Description</label><input type="text" className="form-input" value={eventForm.desc} onChange={e=>setEventForm({...eventForm,desc:e.target.value})} placeholder="Optional"/></div>
            <div className="form-group"><label className="form-label">Who</label><input type="text" className="form-input" value={eventForm.who} onChange={e=>setEventForm({...eventForm,who:e.target.value})} placeholder="Family, Rich, Shawnie..."/></div>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowEventModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={addEvent}>Add Event</button>
          </div>
        </div>
      </div>

      {/* Growth Modal */}
      <div className={`modal ${showGrowthModal?'show':''}`} onClick={()=>setShowGrowthModal(false)} role="dialog" aria-modal="true">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3>Add Growth Entry</h3><button className="modal-close" onClick={()=>setShowGrowthModal(false)}>√ó</button></div>
          <div className="modal-body">
            <div className="form-group"><label className="form-label">Height (cm)</label><input type="number" className="form-input" value={growthForm.height} onChange={e=>setGrowthForm({...growthForm,height:e.target.value})} placeholder="e.g. 76"/></div>
            <div className="form-group"><label className="form-label">Weight (kg)</label><input type="number" step="0.1" className="form-input" value={growthForm.weight} onChange={e=>setGrowthForm({...growthForm,weight:e.target.value})} placeholder="e.g. 10.2"/></div>
            <div className="form-group"><label className="form-label">Head Circumference (cm) - Optional</label><input type="number" className="form-input" value={growthForm.headCirc} onChange={e=>setGrowthForm({...growthForm,headCirc:e.target.value})} placeholder="e.g. 46"/></div>
            <div className="form-group"><label className="form-label">Notes</label><textarea className="modal-textarea" value={growthForm.notes} onChange={e=>setGrowthForm({...growthForm,notes:e.target.value})} placeholder="Any observations..."/></div>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowGrowthModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={()=>{
              if(!growthForm.height||!growthForm.weight){
                alert('Please enter height and weight');
                return;
              }
              addMadisonGrowth(growthForm.height,growthForm.weight,growthForm.headCirc,growthForm.notes);
              setGrowthForm({height:'',weight:'',headCirc:'',notes:''});
              setShowGrowthModal(false);
            }}>Save Entry</button>
          </div>
        </div>
      </div>

      {/* Health Modal */}
      <div className={`modal ${showHealthModal?'show':''}`} onClick={()=>setShowHealthModal(false)} role="dialog" aria-modal="true">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3>Add Health Note</h3><button className="modal-close" onClick={()=>setShowHealthModal(false)}>√ó</button></div>
          <div className="modal-body">
            <div className="form-group">
              <label className="form-label">Type</label>
              <select className="form-input" value={healthForm.type} onChange={e=>setHealthForm({...healthForm,type:e.target.value})}>
                <option>Check-up</option>
                <option>Illness</option>
                <option>Vaccination</option>
                <option>Injury</option>
                <option>Appointment</option>
                <option>Other</option>
              </select>
            </div>
            <div className="form-group"><label className="form-label">Notes</label><textarea className="modal-textarea" value={healthForm.notes} onChange={e=>setHealthForm({...healthForm,notes:e.target.value})} placeholder="What happened..."/></div>
            <div className="form-group"><label className="form-label">Weight (kg) - Optional</label><input type="number" step="0.1" className="form-input" value={healthForm.weight} onChange={e=>setHealthForm({...healthForm,weight:e.target.value})} placeholder="e.g. 10.2"/></div>
            <div className="form-group"><label className="form-label">Height (cm) - Optional</label><input type="number" className="form-input" value={healthForm.height} onChange={e=>setHealthForm({...healthForm,height:e.target.value})} placeholder="e.g. 76"/></div>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowHealthModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={()=>{
              if(!healthForm.notes.trim()){
                alert('Please enter notes');
                return;
              }
              addHealthNote(healthForm.type,healthForm.notes,healthForm.weight,healthForm.height);
              setHealthForm({type:'Check-up',notes:'',weight:'',height:''});
              setShowHealthModal(false);
            }}>Save Note</button>
          </div>
        </div>
      </div>

      <header className="header"><div className="header-content">
        <div className="header-top">
          <div className="logo"><div className="logo-icon">üè†</div><div><div className="logo-title">{config.familyName}</div><div className="logo-sub">{config.location} ‚Üí {config.targetLocation}</div></div></div>
          <div className="header-btns">
            <button className="icon-btn" onClick={()=>setDarkMode(!darkMode)} aria-label="Toggle dark mode" title={darkMode?'Light mode':'Dark mode'}>
              {darkMode?'‚òÄÔ∏è':'üåô'}
            </button>
            <button className="icon-btn" onClick={exportData} aria-label="Export data" title="Export data">üíæ</button>
            <label className="icon-btn" aria-label="Import data" title="Import data">üìÇ<input type="file" accept=".json" onChange={importData} style={{display:'none'}}/></label>
          </div>

        <div className="mini-stats">
          <div className="mini-stat"><div className={`mini-stat-val ${monthlyLeftover<0?'negative':'positive'}`}>¬£{monthlyLeftover}</div><div className="mini-stat-lbl">/mo</div></div>
          <div className="mini-stat"><div className="mini-stat-val">{daysUntilReturn}</div><div className="mini-stat-lbl">days</div></div>
          <div className="mini-stat"><div className="mini-stat-val">{goalsProgress.pct}%</div><div className="mini-stat-lbl">goals</div></div>
        </div>
        <div style={{display:'flex',gap:'8px',marginTop:'8px',flexWrap:'wrap'}}>
          <div className="level-badge">‚≠ê Level {data.gamification?.level||1}</div>
          <div className="streak-badge">üî• {data.gamification?.streak||0} day streak</div>
        </div>
        <div className="xp-bar">
          <div className="xp-fill" style={{width:`${((data.gamification?.xp||0)%100)}%`}}>
            {data.gamification?.xp||0} / {Math.ceil(((data.gamification?.xp||0)/100))*100+100} XP
          </div>
        </div>
      </div></div></header>

      <div className="nav-wrap"><nav className="nav">
        {[{id:'overview',label:'üè† Overview'},{id:'calendar',label:'üìÖ Daily Plan'},{id:'goals',label:'üéØ Goals'},{id:'budget',label:'üí∞ Budget'},{id:'madison',label:'üë∂ Madison'},{id:'month',label:'üìä Month'},{id:'memories',label:'üì∏ Memories'},{id:'week',label:'üìã Week'},{id:'settings',label:'‚öôÔ∏è'}].map(t=>
          <button key={t.id} className={`nav-btn ${tab===t.id?'active':''}`} onClick={()=>setTab(t.id)}>{t.label}</button>
        )}
      </nav></div>

      <main className="main">
        {/* OVERVIEW TAB */}
        {tab==='overview'&&<>
          <div className="overview-hero">
            <div className="overview-countdown">üéØ Days Until Shawnie Returns to Work</div>
            <div className="overview-days">{daysUntilReturn}</div>
            <div className="overview-label">The countdown is on!</div>
            <div className="overview-date">{returnDate.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</div>
          </div>

          <div className="overview-grid">
            <div className="overview-card income"><div className="overview-card-icon">üíö</div><div className="overview-card-value">¬£{totalIncome}</div><div className="overview-card-label">Monthly Income</div></div>
            <div className="overview-card expense"><div className="overview-card-icon">üí∏</div><div className="overview-card-value">¬£{totalExpenses}</div><div className="overview-card-label">Monthly Expenses</div></div>
            <div className="overview-card gap"><div className="overview-card-icon">{monthlyLeftover>=0?'‚ú®':'‚ö†Ô∏è'}</div><div className="overview-card-value" style={{color:monthlyLeftover>=0?'var(--sage)':'var(--critical)'}}>¬£{monthlyLeftover}</div><div className="overview-card-label">Monthly Leftover</div></div>
            <div className="overview-card goals"><div className="overview-card-icon">üéØ</div><div className="overview-card-value">{goalsProgress.pct}%</div><div className="overview-card-label">Goals Complete</div></div>
            <div className="overview-card savings"><div className="overview-card-icon">üíé</div><div className="overview-card-value">¬£{totalSaved.toLocaleString()}</div><div className="overview-card-label">Total Saved</div></div>
            <div className="overview-card pension"><div className="overview-card-icon">üë¥</div><div className="overview-card-value">¬£{Math.round(config.richPension/1000)}k</div><div className="overview-card-label">Pension</div></div>
          </div>

          <div className="card">
            <h3 className="card-title"><span className="card-icon">üìä</span>Progress</h3>
            <div className="progress-section">
              <div className="progress-title"><span>Goals Progress</span><span>{goalsProgress.done}/{goalsProgress.total}</span></div>
              <div className="progress-bar"><div className="progress-fill goals" style={{width:`${goalsProgress.pct}%`}}/></div>
            </div>
            {config.houseDeposit>0&&<div className="progress-section">
              <div className="progress-title"><span>House Deposit</span><span>¬£{config.houseDeposit.toLocaleString()} / ¬£25,000</span></div>
              <div className="progress-bar"><div className="progress-fill savings" style={{width:`${Math.min(100,(config.houseDeposit/25000)*100)}%`}}/></div>
            </div>}
          </div>

          <div className="card">
            <h3 className="card-title"><span className="card-icon">üöÄ</span>Your Journey</h3>
            <div className="timeline-item"><div className="timeline-dot current"/><div className="timeline-content"><div className="timeline-title">Now - Building foundations</div><div className="timeline-date">Benefits period ‚Ä¢ ¬£{totalIncome}/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">July 2026 - Shawnie returns</div><div className="timeline-date">Band 6 PIP Assessor</div><div className="timeline-amount">+¬£2,600/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">Sep 2026 - Rich starts apprenticeship</div><div className="timeline-date">Electrical training begins</div><div className="timeline-amount">+¬£1,000/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">2027 - Shawnie Band 7</div><div className="timeline-date">Senior position (~¬£50k)</div><div className="timeline-amount">+¬£400/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">2028 - Rich Qualified</div><div className="timeline-date">JIB Gold Card ‚Ä¢ ¬£40k+</div><div className="timeline-amount">Combined ¬£90k+</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">2029-30 - Homeowners!</div><div className="timeline-date">Sheffield property purchase</div><div className="timeline-amount">Target ¬£95k+</div></div></div>
          </div>

          {potentialSavings>0&&<div className="tip-box">üí° <strong>Unclaimed benefit:</strong> Social broadband could save ¬£{Math.round(potentialSavings/12)}/month. <button className="btn btn-sm btn-secondary" onClick={()=>setTab('benefits')}>Check Benefits ‚Üí</button></div>}

          <div className="card">
            <h3 className="card-title"><span className="card-icon">‚ö°</span>Next Actions</h3>
            {currentGoalSteps.map((s,i)=>(
              <div key={i} className="goal-focus">
                <div className="goal-focus-title">{s.goalIcon} {s.goalTitle}</div>
                <div className="goal-focus-text">{s.text}</div>
                {s.time&&<div className="goal-focus-time">‚è±Ô∏è {s.time} ‚Ä¢ {renderTag(s.person)}</div>}
              </div>
            ))}
            <button className="btn btn-primary" onClick={()=>setTab('goals')}>View All Goals ‚Üí</button>
          </div>
        </>}

        {/* DAILY PLAN TAB - INTEGRATED CALENDAR & GOALS */}
        {tab==='calendar'&&<>
          <div className="week-nav">
            <button className="btn btn-secondary btn-sm" onClick={()=>{const d=new Date(selectedDate);d.setDate(d.getDate()-7);setSelectedDate(d)}}>‚Üê</button>
            <div className="day-tabs">
              {weekDates.map(d=>(
                <div key={d.toISOString()} className={`day-tab ${isSelected(d)?'active':''} ${isToday(d)?'today':''}`} onClick={()=>setSelectedDate(d)}>
                  <div className="day-name">{d.toLocaleDateString('en-GB',{weekday:'short'})}</div>
                  <div className="day-num">{d.getDate()}</div>
                </div>
              ))}
            </div>
            <button className="btn btn-secondary btn-sm" onClick={()=>{const d=new Date(selectedDate);d.setDate(d.getDate()+7);setSelectedDate(d)}}>‚Üí</button>
          </div>

          {/* Today's Priority Goals */}
          {currentGoalSteps.length>0&&<div className="card" style={{background:'linear-gradient(135deg,#fdf4ff,#f3e8ff)',border:'2px solid #a855f7'}}>
            <h3 className="card-title" style={{color:'#7c3aed'}}>üéØ Today's Goal Actions</h3>
            {currentGoalSteps.map((s,i)=>(
              <div key={i} className="goal-focus">
                <div className="goal-focus-title">{s.goalIcon} {s.goalTitle}</div>
                <div className="goal-focus-text">{s.text}</div>
                {s.time&&<div className="goal-focus-time">‚è±Ô∏è {s.time} ‚Ä¢ {renderTag(s.person)}</div>}
              </div>
            ))}
            <button className="btn btn-secondary btn-sm" style={{marginTop:'8px'}} onClick={()=>setTab('goals')}>View All Goals ‚Üí</button>
          </div>}

          {/* Events */}
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'16px'}}>
              <h3 className="card-title" style={{marginBottom:0}}>üìÖ {selectedDate.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long'})}</h3>
              <button className="btn btn-primary btn-sm" onClick={()=>setShowEventModal(true)}>+ Event</button>
            </div>
            {dayEvents.length>0&&dayEvents.map(ev=>(
              <div key={ev.id} className="event-card">
                <div className="event-header">
                  <div className="event-time">üïê {ev.time}</div>
                  <button className="event-delete" onClick={()=>deleteEvent(dateKey,ev.id)}>√ó</button>
                </div>
                <div className="event-title">{ev.title}</div>
                {ev.desc&&<div className="event-desc">{ev.desc}</div>}
                {ev.who&&<div className="event-meta">üë• {ev.who}</div>}
              </div>
            ))}
            {dayEvents.length===0&&<div style={{padding:'16px',textAlign:'center',color:'var(--navy-light)',fontSize:'0.85rem'}}>No events scheduled ‚Ä¢ Click + Event to add</div>}
          </div>

          {/* Madison Priority Tasks */}
          <div className="card" style={{background:'linear-gradient(135deg,#fff5f0,#ffe8df)',border:'2px solid var(--madison)'}}>
            <h3 className="card-title" style={{color:'#d97706'}}>üë∂ Madison's Day <span style={{fontSize:'0.8rem',fontWeight:600,color:'#f59e0b',marginLeft:'8px'}}>Total: {tailoredDailyTasks.family.reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {tailoredDailyTasks.family.map((task,i)=>{
              const key=`madison-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Meals */}
          <div className="card">
            <h3 className="card-title">üçΩÔ∏è Today's Meals <span style={{fontSize:'0.8rem',fontWeight:600,color:'var(--gold)',marginLeft:'8px'}}>Total: {tailoredDailyTasks.meals.reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {tailoredDailyTasks.meals.map((task,i)=>{
              const key=`meal-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              const mealData=i===0?dayMeals.breakfast:i===1?dayMeals.lunch:dayMeals.dinner;
              return(
                <div key={i} style={{marginBottom:'12px'}}>
                  <div className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                    <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                    <div className="task-time">{task.exactTime}</div>
                    <div className="task-content" style={{flex:1}}>
                      <div className="task-text">{task.icon} {task.task}</div>
                    </div>
                    {renderTag(task.person)}
                    <div className="time-badge">+{task.xp} XP</div>
                  </div>
                  <div style={{marginLeft:'98px',fontSize:'0.8rem',color:'var(--navy-light)',marginTop:'4px'}}>
                    {mealData.name} ‚Ä¢ ¬£{mealData.cost.toFixed(2)} ‚Ä¢ Prep: {mealData.prep}
                  </div>
                </div>
              );
            })}
            <div className="tip-box" style={{margin:'12px 0 0 0'}}>üí∞ Today's food cost: <strong>¬£{dailyMealCost}</strong> ‚Ä¢ Weekly average: ~¬£45-50</div>
          </div>

          {/* House Tasks */}
          <div className="card">
            <h3 className="card-title">üè† House Tasks <span style={{fontSize:'0.8rem',fontWeight:600,color:'var(--sage)',marginLeft:'8px'}}>Total: {tailoredDailyTasks.house.reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {tailoredDailyTasks.house.map((task,i)=>{
              const key=`house-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Weekly Special Tasks */}
          {weeklySpecialTasks[dayOfWeek]&&weeklySpecialTasks[dayOfWeek].length>0&&<div className="card">
            <h3 className="card-title">‚ú® {['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][dayOfWeek]} Specials</h3>
            {weeklySpecialTasks[dayOfWeek].map((task,i)=>{
              const key=`special-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return<div key={i} className={`task-item ${done?'completed':''}`} onClick={()=>toggleTask(key)}>
                <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                <div className="task-content">
                  <div className="task-text">{task.icon} {task.task}</div>
                  <div className="task-meta">
                    {renderTag(task.person)}
                    <span className="tag tag-high">{task.category}</span>
                  </div>
                </div>
              </div>
            })}
          </div>}

          {/* Goal-Linked Tasks */}
          <div className="card" style={{background:'linear-gradient(135deg,#f0fdf4,#dcfce7)',border:'2px solid var(--sage)'}}>
            <h3 className="card-title" style={{color:'#15803d'}}>üéØ Goal Actions <span style={{fontSize:'0.8rem',fontWeight:600,color:'#059669',marginLeft:'8px'}}>Total: {tailoredDailyTasks.goals.reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {tailoredDailyTasks.goals.map((task,i)=>{
              const shouldShow=task.frequency==='daily'||(task.frequency==='weekly'&&dayOfWeek===1)||(task.frequency==='monthly'&&new Date(selectedDate).getDate()===1);
              if(!shouldShow)return null;
              const key=`goal-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <span className={`tag tag-${task.frequency==='daily'?'medium':'high'}`} style={{fontSize:'0.65rem'}}>{task.frequency}</span>
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Social & Self-Care */}
          <div className="card">
            <h3 className="card-title">üíù Wellbeing</h3>
            {tailoredDailyTasks.social.map((task,i)=>{
              const shouldShow=task.frequency==='daily'||(task.frequency==='weekly'&&dayOfWeek===0)||(task.frequency==='monthly'&&new Date(selectedDate).getDate()===1);
              if(!shouldShow)return null;
              const key=`social-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return<div key={i} className={`task-item ${done?'completed':''}`} onClick={()=>toggleTask(key)}>
                <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                <div className="task-content">
                  <div className="task-text">{task.icon} {task.task}</div>
                  <div className="task-meta">
                    {renderTag(task.person)}
                    <span className="tag tag-low">social</span>
                  </div>
                </div>
              </div>
            })}
            {tailoredDailyTasks.selfCare.map((task,i)=>{
              const key=`care-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Family & Friends */}
          <div className="card">
            <h3 className="card-title">üë®‚Äçüë©‚Äçüëß Family & Friends</h3>
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(200px,1fr))',gap:'12px'}}>
              {Object.entries(data.familyFriends||familyAndFriends).map(([location,people])=>(
                <div key={location}>
                  <div style={{fontSize:'0.7rem',fontWeight:'600',color:'var(--navy-light)',textTransform:'uppercase',marginBottom:'6px'}}>
                    {location==='sheffield'&&'üèôÔ∏è Sheffield'}
                    {location==='harrogate'&&'üå≥ Harrogate'}
                    {location==='durham'&&'üìç Durham'}
                    {location==='peterlee'&&'üèòÔ∏è Peterlee'}
                    {location==='richFamily'&&'üë® Rich\'s Family'}
                    {location==='shawnieFamily'&&'üë© Shawnie\'s Family'}
                  </div>
                  {people.map(person=>(
                    <div key={person.id} style={{padding:'8px',background:'var(--cream)',borderRadius:'8px',marginBottom:'4px',fontSize:'0.85rem'}}>
                      <div style={{display:'flex',alignItems:'center',gap:'6px'}}>
                        <span>{person.icon}</span>
                        <span style={{fontWeight:'600'}}>{person.names}</span>
                      </div>
                      {person.relation&&<div style={{fontSize:'0.7rem',color:'var(--navy-light)',marginTop:'2px'}}>{person.relation}</div>}
                    </div>
                  ))}
                </div>
              ))}
            </div>
            <div className="tip-box" style={{marginTop:'16px'}}>üí° <strong>Stay connected:</strong> Video calls, visits, messages ‚Ä¢ Building your Sheffield life while keeping family close!</div>
          </div>

          {/* Activities */}
          {dayActivities.length>0&&<div className="card">
            <h3 className="card-title">üéÆ Today's Activities</h3>
            {dayActivities.map((act,i)=>(
              <div key={i} className="activity-card">
                <div className="activity-name">{act.icon} {act.name}{act.cost>0&&` - ¬£${act.cost}`}</div>
                <div className="activity-meta">{act.duration} ‚Ä¢ {act.person}{act.cost===0&&' ‚Ä¢ FREE'}</div>
              </div>
            ))}
          </div>}
        </>}
        {/* GOALS TAB */}
        {tab==='goals'&&<>
          <div className="card" style={{marginBottom:'16px'}}>
           <div style={{position:'relative'}}>
            <input 
             type="text"
             className="form-input"
             placeholder="üîç Search goals, steps..."
            value={searchTerm}
            onChange={e=>handleSearch(e.target.value)}
            style={{paddingLeft:'40px'}}
          />
          {searchTerm&&(
           <button 
             onClick={()=>handleSearch('')}
             style={{
               position:'absolute',
                right:'12px',
               top:'50%',
               transform:'translateY(-50%)',
               background:'none',
               border:'none',
               fontSize:'1.2rem',
               cursor:'pointer',
               color:'var(--navy-light)'
             }}
           >
             √ó
            </button>
          )}
       </div>
       {searchTerm&&(
         <div style={{marginTop:'8px',fontSize:'0.85rem',color:'var(--navy-light)'}}>
            Found: {searchResults.goals.length} goals
          </div>
       )}
      </div>
  
       <div className="summary-row">

            <div className="summary-box income"><div className="summary-label">Complete</div><div className="summary-value">{goalsProgress.done}</div></div>
            <div className="summary-box expense"><div className="summary-label">Remaining</div><div className="summary-value">{goalsProgress.total-goalsProgress.done}</div></div>
            <div className="summary-box saving"><div className="summary-label">Progress</div><div className="summary-value">{goalsProgress.pct}%</div></div>
            <div className="summary-box leftover"><div className="summary-label">Total</div><div className="summary-value">{goalsProgress.total}</div></div>
          </div>
          
          <div className="card">
            <h3 className="card-title">üìä Progress Rings</h3>
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(120px,1fr))',gap:'16px'}}>
              {data.goals.map(goal=>{
                const done=goal.steps.filter(s=>s.done).length;
                const total=goal.steps.length;
                const pct=total?(done/total)*100:0;
                const circumference=2*Math.PI*40;
                const offset=circumference-(pct/100)*circumference;
                const strokeColor=goal.priority==='critical'?'var(--critical)':goal.priority==='high'?'var(--high)':goal.priority==='medium'?'var(--medium)':'var(--low)';
                
                return(
                  <div key={goal.id} style={{textAlign:'center'}}>
                    <svg className="progress-ring" width="100" height="100" style={{transform:'rotate(-90deg)'}}>
                      <circle
                        className="progress-ring-circle"
                        stroke="var(--cream-dark)"
                        strokeWidth="8"
                        cx="50"
                        cy="50"
                        r="40"
                      />
                      <circle
                        className="progress-ring-circle"
                        stroke={strokeColor}
                        strokeWidth="8"
                        strokeDasharray={circumference}
                        strokeDashoffset={offset}
                        cx="50"
                        cy="50"
                        r="40"
                      />
                      <text x="50" y="50" textAnchor="middle" dy="0.3em" fontSize="24" transform="rotate(90 50 50)">
                        {goal.icon}
                      </text>
                    </svg>
                    <div style={{fontSize:'0.9rem',fontWeight:700,marginTop:'8px',color:'var(--navy)'}}>
                      {Math.round(pct)}%
                    </div>
                    <div style={{fontSize:'0.7rem',color:'var(--navy-light)',marginBottom:'4px'}}>
                      {done}/{total} steps
                    </div>
                    <div style={{fontSize:'0.75rem',fontWeight:600,color:'var(--navy)',lineHeight:1.3}}>
                      {goal.title.length>20?goal.title.substring(0,20)+'...':goal.title}
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          {(searchTerm?searchResults.goals:data.goals).map(goal=>{
            const done=goal.steps.filter(s=>s.done).length;
            const total=goal.steps.length;
            const pct=total?Math.round((done/total)*100):0;
            const isOpen=expandedGoals[goal.id];
            return<div key={goal.id} className={`goal-card ${goal.priority}`}>
              <div className="goal-header" onClick={()=>setExpandedGoals(prev=>({...prev,[goal.id]:!prev[goal.id]}))}>
                <div className="goal-icon">{goal.icon}</div>
                <div className="goal-info">
                  <div className="goal-title">{highlightText(goal.title,searchTerm)}</div>
                  <div className="goal-subtitle">{highlightText(goal.subtitle,searchTerm)}</div>
                  <div style={{display:'flex',gap:4,marginTop:4}}>{renderTag(goal.person)}<span className={`tag tag-${goal.priority}`}>{goal.priority}</span></div>
                </div>
                <div className="goal-progress"><div className="goal-pct">{pct}%</div><div className="goal-count">{done}/{total}</div></div>
                <div style={{transform:isOpen?'rotate(180deg)':'none',transition:'0.2s'}}><ChevronDown/></div>
              </div>
              <div className={`goal-body ${isOpen?'open':''}`}>
                {goal.steps.map(step=>(
                  <div key={step.id} className={`step-item ${step.done?'completed':''}`} onClick={()=>toggleGoalStep(goal.id,step.id)}>
                    <div className={`step-check ${step.done?'checked':''}`}>{step.done&&<Check/>}</div>
                    <div className="step-text">{highlightText(step.text,searchTerm)}</div>
                    <div className="step-date">{step.time&&`‚è±Ô∏è${step.time} ‚Ä¢ `}{step.date}</div>
                  </div>
                ))}
              </div>
            </div>
          })}
        </>}

        {/* BUDGET TAB */}
        {tab==='budget'&&<>
          <div className="summary-row">
            <div className="summary-box income"><div className="summary-label">Income</div><div className="summary-value">¬£{totalIncome}</div></div>
            <div className="summary-box expense"><div className="summary-label">Expenses</div><div className="summary-value">¬£{totalExpenses}</div></div>
            <div className="summary-box saving"><div className="summary-label">Saving</div><div className="summary-value">¬£{totalSavings}</div></div>
            <div className={`summary-box ${monthlyLeftover>=0?'leftover':'negative'}`}><div className="summary-label">Leftover</div><div className="summary-value">¬£{monthlyLeftover}</div></div>
          </div>

           {monthlyLeftover<0&&<div className="tip-box" style={{background:'#fee2e2',borderColor:'#dc2626',color:'#991b1b'}}>‚ö†Ô∏è <strong>Monthly shortfall:</strong> ¬£{Math.abs(monthlyLeftover)} | {monthsUntilReturn} months to go | Total gap: ¬£{totalGapToBridge.toLocaleString()}</div>}

          <div className="card">
            <h3 className="card-title"><span className="card-icon">üìä</span>Budget Breakdown</h3>
            <div className="chart-container">
              <canvas id="budgetChart"></canvas>
            </div>
          </div>
          
          <div className="card">
            <h3 className="card-title"><span className="card-icon">üìà</span>Savings Projection</h3>
            <div className="chart-container">
              <canvas id="savingsChart"></canvas>
            </div>
            <div className="tip-box" style={{marginTop:'16px'}}>
              üí° <strong>Projection:</strong> Shawnie returns July 1st, 2026 (¬£40k/year, ¬£2,600/mo net). 
              Childcare: ¬£640/mo. Net gain: ¬£1,960/mo. Target: ¬£25k house deposit by 2029!
            </div>
          </div>
          
          <div className="card">
            <h3 className="card-title"><span className="card-icon">üë¥</span>Pension Growth Projection</h3>
            <div className="chart-container">
              <canvas id="pensionChart"></canvas>
            </div>
            <div className="tip-box" style={{marginTop:'16px'}}>
              üí° <strong>Retirement projections:</strong> Based on current balances and monthly contributions. 
              Assumes 5% annual growth. Rich retires at 67 (2057), Shawnie at 67 (2059).
            </div>
          </div>

          <div className="budget-grid">            <div className="budget-section">
              <div className="budget-section-title">üíö Income</div>
              {Object.entries(incomeLabels).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.income[key]||''} placeholder="0" onChange={e=>updateBudget('income',key,e.target.value)}/></div>
              )}
              <div className="budget-total"><span className="budget-total-label">Total Income</span><span className="budget-total-value" style={{color:'#059669'}}>¬£{totalIncome}</span></div>
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üè† Housing & Utilities</div>
              {Object.entries(expenseLabels).slice(0,6).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.expenses[key]||''} placeholder="0" onChange={e=>updateBudget('expenses',key,e.target.value)}/></div>
              )}
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üöó Transport & Living</div>
              {Object.entries(expenseLabels).slice(6,12).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.expenses[key]||''} placeholder="0" onChange={e=>updateBudget('expenses',key,e.target.value)}/></div>
              )}
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üì¶ Other Expenses</div>
              {Object.entries(expenseLabels).slice(12).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.expenses[key]||''} placeholder="0" onChange={e=>updateBudget('expenses',key,e.target.value)}/></div>
              )}
              <div className="budget-total"><span className="budget-total-label">Total Expenses</span><span className="budget-total-value" style={{color:'#dc2626'}}>¬£{totalExpenses}</span></div>
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üí∞ Monthly Savings</div>
              {Object.entries(savingsLabels).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.savings[key]||''} placeholder="0" onChange={e=>updateBudget('savings',key,e.target.value)}/></div>
              )}
              <div className="budget-total"><span className="budget-total-label">Total Savings</span><span className="budget-total-value" style={{color:'#0284c7'}}>¬£{totalSavings}</span></div>
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üíé Savings Pots</div>
              <div className="budget-row"><span className="budget-label">Emergency Fund</span><input type="number" className="budget-input" value={config.emergencyFund||''} placeholder="0" onChange={e=>setConfig(c=>({...c,emergencyFund:Number(e.target.value)||0}))}/></div>
              <div className="budget-row"><span className="budget-label">House Deposit</span><input type="number" className="budget-input" value={config.houseDeposit||''} placeholder="0" onChange={e=>setConfig(c=>({...c,houseDeposit:Number(e.target.value)||0}))}/></div>
              <div className="budget-total"><span className="budget-total-label">Total Saved</span><span className="budget-total-value" style={{color:'#d97706'}}>¬£{totalSaved.toLocaleString()}</span></div>
            </div>
          </div>

          <div className="card" style={{marginTop:16}}>
            <h3 className="card-title">üë¥ Pensions</h3>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
              <div><label className="form-label">Rich's Pension</label><input type="number" className="form-input" value={config.richPension||''} onChange={e=>setConfig(c=>({...c,richPension:Number(e.target.value)||0}))}/></div>
              <div><label className="form-label">Shawnie's Pension</label><input type="number" className="form-input" value={config.shawniePension||''} onChange={e=>setConfig(c=>({...c,shawniePension:Number(e.target.value)||0}))}/></div>
            </div>
            <div className="tip-box">Combined Pensions: <strong>¬£{(config.richPension+config.shawniePension).toLocaleString()}</strong></div>
          </div>
        </>}


        {/* MADISON TAB */}
        {tab==='madison'&&<>
          <div className="madison-hero">
            <div className="overview-countdown">üë∂ Madison's Journey</div>
            <div className="madison-age">{formatAge(data.madison?.birthDate||'2024-02-01')}</div>
            <div className="overview-label">old today</div>
            <div className="overview-date">Born {new Date(data.madison?.birthDate||'2024-02-01').toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}</div>
          </div>

          <div className="nav" style={{marginBottom:'16px',background:'var(--madison-light)',padding:'6px'}}>
            {['overview','growth','health','development','vaccinations'].map(t=>(
              <button key={t} className={`nav-btn ${madisonTab===t?'active':''}`} onClick={()=>setMadisonTab(t)} style={{fontSize:'0.75rem',padding:'8px 12px'}}>
                {t==='overview'&&'üìä Overview'}
                {t==='growth'&&'üìè Growth'}
                {t==='health'&&'üè• Health'}
                {t==='development'&&'üéØ Development'}
                {t==='vaccinations'&&'üíâ Vaccines'}
              </button>
            ))}
          </div>

          {/* OVERVIEW SUB-TAB */}
          {madisonTab==='overview'&&<>
            <div className="madison-stat-grid">
              {data.madison?.growth?.length>0&&<>
                <div className="madison-stat-card">
                  <div className="madison-stat-icon">üìè</div>
                  <div className="madison-stat-value">{data.madison.growth[data.madison.growth.length-1].height}</div>
                  <div className="madison-stat-label">Height (cm)</div>
                  <div className="madison-stat-date">{new Date(data.madison.growth[data.madison.growth.length-1].date).toLocaleDateString('en-GB',{month:'short',year:'numeric'})}</div>
                </div>
                <div className="madison-stat-card">
                  <div className="madison-stat-icon">‚öñÔ∏è</div>
                  <div className="madison-stat-value">{data.madison.growth[data.madison.growth.length-1].weight}</div>
                  <div className="madison-stat-label">Weight (kg)</div>
                  <div className="madison-stat-date">{new Date(data.madison.growth[data.madison.growth.length-1].date).toLocaleDateString('en-GB',{month:'short',year:'numeric'})}</div>
                </div>
              </>}
              <div className="madison-stat-card">
                <div className="madison-stat-icon">üíâ</div>
                <div className="madison-stat-value">{data.madison?.vaccinations?.filter(v=>v.completed).length}/{data.madison?.vaccinations?.length||0}</div>
                <div className="madison-stat-label">Vaccinations</div>
              </div>
              <div className="madison-stat-card">
                <div className="madison-stat-icon">üéØ</div>
                <div className="madison-stat-value">{Object.values(data.madison?.developmental||{}).reduce((sum,arr)=>sum+arr.filter(m=>m.achieved).length,0)}</div>
                <div className="madison-stat-label">Milestones</div>
              </div>
            </div>

            <div className="card">
              <h3 className="card-title">üéâ Recent Achievements</h3>
              {Object.entries(data.madison?.developmental||{}).map(([category,items])=>
                items.filter(m=>m.achieved).slice(-2).map(m=>(
                  <div key={m.id} className="dev-milestone achieved" style={{background:'var(--sage-light)',cursor:'default'}}>
                    <div className="dev-check checked"><Check/></div>
                    <div className="dev-text">{m.skill}</div>
                    <div className="dev-age">{m.date?new Date(m.date).toLocaleDateString('en-GB',{month:'short',day:'numeric'}):''}</div>
                  </div>
                ))
              )}
            </div>

            <div className="card">
              <h3 className="card-title">üìã Coming Up</h3>
              {data.madison?.vaccinations?.filter(v=>!v.completed).slice(0,3).map(v=>(
                <div key={v.id} className="vacc-item">
                  <div className="vacc-check"><span style={{fontSize:'1.2rem'}}>üíâ</span></div>
                  <div className="vacc-info">
                    <div className="vacc-name">{v.name}</div>
                    <div className="vacc-age">Due: {v.ageWeeks?`${v.ageWeeks} weeks`:v.ageMonths?`${v.ageMonths} months`:`${v.ageYears} years`}</div>
                  </div>
                </div>
              ))}
            </div>
          </>}

          {/* GROWTH SUB-TAB */}
          {madisonTab==='growth'&&<>
            <button className="btn btn-primary" style={{marginBottom:'16px',width:'100%'}} onClick={()=>setShowGrowthModal(true)}>+ Add Growth Entry</button>

            <div className="card">
              <h3 className="card-title">üìà Growth Chart</h3>
              <div className="chart-container" style={{height:'300px'}}>
                <canvas id="growthChart"></canvas>
              </div>
            </div>

            <div className="card">
              <h3 className="card-title">üìè Growth History</h3>
              {[...(data.madison?.growth||[])].reverse().map(entry=>(
                <div key={entry.id} className="growth-entry">
                  <div className="growth-date-col">{new Date(entry.date).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})}</div>
                  <div className="growth-data-col">
                    <div className="growth-metric">
                      <div className="growth-metric-label">Height</div>
                      <div className="growth-metric-value">{entry.height} cm</div>
                    </div>
                    <div className="growth-metric">
                      <div className="growth-metric-label">Weight</div>
                      <div className="growth-metric-value">{entry.weight} kg</div>
                    </div>
                    {entry.headCirc&&<div className="growth-metric">
                      <div className="growth-metric-label">Head</div>
                      <div className="growth-metric-value">{entry.headCirc} cm</div>
                    </div>}
                  </div>
                </div>
              ))}
            </div>
          </>}

          {/* HEALTH SUB-TAB */}
          {madisonTab==='health'&&<>
            <button className="btn btn-primary" style={{marginBottom:'16px',width:'100%'}} onClick={()=>setShowHealthModal(true)}>+ Add Health Note</button>

            <div className="card">
              <h3 className="card-title">üè• Health Records</h3>
              {[...(data.madison?.health||[])].reverse().map(note=>(
                <div key={note.id} className="health-note">
                  <div className="health-note-header">
                    <div className="health-note-date">{new Date(note.date).toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}</div>
                    <div className="health-note-type">{note.type}</div>
                  </div>
                  <div className="health-note-text">{note.notes}</div>
                  {(note.weight||note.height)&&<div style={{marginTop:'8px',fontSize:'0.75rem',color:'#7a4a1f'}}>
                    {note.weight&&`Weight: ${note.weight}kg`}
                    {note.weight&&note.height&&' ‚Ä¢ '}
                    {note.height&&`Height: ${note.height}cm`}
                  </div>}
                </div>
              ))}
            </div>
          </>}

          {/* DEVELOPMENT SUB-TAB */}
          {madisonTab==='development'&&<>
            {Object.entries(data.madison?.developmental||{}).map(([category,items])=>(
              <div key={category} className="dev-category">
                <div className="dev-category-title">
                  {category==='motor'&&'üèÉ Motor Skills'}
                  {category==='language'&&'üí¨ Language'}
                  {category==='social'&&'üë• Social'}
                  {category==='cognitive'&&'üß† Cognitive'}
                  <span style={{marginLeft:'auto',fontSize:'0.8rem',fontWeight:'normal'}}>
                    {items.filter(m=>m.achieved).length}/{items.length}
                  </span>
                </div>
                {items.map(milestone=>(
                  <div key={milestone.id} className={`dev-milestone ${milestone.achieved?'achieved':''}`} onClick={()=>toggleDevMilestone(category,milestone.id)}>
                    <div className={`dev-check ${milestone.achieved?'checked':''}`}>{milestone.achieved&&<Check/>}</div>
                    <div className="dev-text">{milestone.skill}</div>
                    <div className="dev-age">{milestone.ageMonths}m</div>
                  </div>
                ))}
              </div>
            ))}
          </>}

          {/* VACCINATIONS SUB-TAB */}
          {madisonTab==='vaccinations'&&<>
            <div className="card">
              <h3 className="card-title">üíâ Vaccination Schedule (NHS UK)</h3>
              <div style={{marginBottom:'16px',fontSize:'0.85rem',color:'var(--navy-light)'}}>
                UK vaccination schedule - tap to mark as complete
              </div>
              {data.madison?.vaccinations?.map(vacc=>(
                <div key={vacc.id} className={`vacc-item ${vacc.completed?'completed':''}`}>
                  <div className={`vacc-check ${vacc.completed?'checked':''}`} onClick={()=>toggleVaccination(vacc.id)}>
                    {vacc.completed&&<Check/>}
                  </div>
                  <div className="vacc-info">
                    <div className="vacc-name">{vacc.name}</div>
                    <div className="vacc-age">
                      Age: {vacc.ageWeeks?`${vacc.ageWeeks} weeks`:vacc.ageMonths?`${vacc.ageMonths} months`:`${vacc.ageYears} years`}
                    </div>
                  </div>
                  <div className="vacc-date">
                    {vacc.completed&&vacc.date?new Date(vacc.date).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'}):'Not yet'}
                  </div>
                </div>
              ))}
            </div>
          </>}
        </>}
        {/* MEMORIES TAB */}
        {tab==='memories'&&<>
          <button className="btn btn-primary" style={{marginBottom:'16px',width:'100%'}} onClick={()=>setShowNoteModal(true)}>+ Add Family Note</button>

          <div className="card" style={{marginBottom:'16px'}}>
            <div style={{position:'relative'}}>
              <input 
                type="text"
                className="form-input"
                placeholder="üîç Search notes..."
                value={searchTerm}
                onChange={e=>handleSearch(e.target.value)}
                style={{paddingLeft:'40px'}}
              />
              {searchTerm&&(
                <button 
                  onClick={()=>handleSearch('')}
                  style={{
                    position:'absolute',
                    right:'12px',
                    top:'50%',
                    transform:'translateY(-50%)',
                    background:'none',
                    border:'none',
                    fontSize:'1.2rem',
                    cursor:'pointer',
                    color:'var(--navy-light)'
                  }}
                >
                  √ó
                </button>
              )}
            </div>
            {searchTerm&&(
              <div style={{marginTop:'8px',fontSize:'0.85rem',color:'var(--navy-light)'}}>
                Found: {searchResults.notes.length} notes
              </div>
            )}
          </div>

          {(searchTerm?searchResults.notes:data.notes).length>0&&<div className="card">
            <h3 className="card-title">üìù Family Notes</h3>
            {(searchTerm?searchResults.notes:data.notes).map(note=>(
              <div key={note.id} className="note-card">
                <div className="note-date">{new Date(note.date).toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</div>
                <div className="note-text">{highlightText(note.text,searchTerm)}</div>
                <button className="btn btn-sm btn-secondary" style={{marginTop:'8px'}} onClick={()=>deleteNote(note.id)}>Delete</button>
              </div>
            ))}
          </div>}

          <div className="card">
            <h3 className="card-title">üéØ Milestones</h3>
            <div className="milestone-grid">
              {data.milestones.map(m=>(
                <div key={m.id} className={`milestone-card ${m.achieved?'achieved':''}`}>
                  <div className={`milestone-photo ${m.photo?'has-photo':''}`}>
                    {m.photo?(
                      <>
                        <img src={m.photo} alt={m.title}/>
                        <div className="photo-date">{new Date(m.date).toLocaleDateString('en-GB',{month:'short',year:'numeric'})}</div>
                      </>
                    ):m.icon}
                    {m.achieved&&<div className="achievement-badge">‚úì Achieved!</div>}
                    <label className="milestone-upload">
                      üì∑
                      <input type="file" accept="image/*" onChange={e=>e.target.files[0]&&uploadMilestonePhoto(m.id,e.target.files[0])}/>
                    </label>
                  </div>
                  <div className="milestone-content">
                    <div className="milestone-title">{m.title}</div>
                    <div style={{fontSize:'0.75rem',color:'var(--navy-light)',marginBottom:'8px'}}>{m.date}</div>
                    {m.notes&&<div className="milestone-notes">"{m.notes}"</div>}
                    <button className="btn btn-sm btn-secondary" style={{width:'100%',marginBottom:'8px'}} onClick={(e)=>{
                      e.stopPropagation();
                      const notes=prompt('Add a note about this milestone:',m.notes||'');
                      if(notes!==null){
                        setData(prev=>({...prev,milestones:prev.milestones.map(ms=>ms.id===m.id?{...ms,notes}:ms)}));
                      }
                    }}>
                      {m.notes?'‚úèÔ∏è Edit Note':'+ Add Note'}
                    </button>
                    <div className={`benefit-check ${m.achieved?'checked':''}`} onClick={()=>toggleMilestone(m.id)} style={{margin:'0 auto',cursor:'pointer'}}>
                      {m.achieved&&<Check/>}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </>}
        
        {/* WEEK OVERVIEW TAB */}
        {tab==='week'&&<>
          <div className="card week-overview-card">
            <h3 className="card-title">üìã Week at a Glance</h3>
            {weekDates.map(d=>{
              const dk=d.toISOString().split('T')[0];
              const evs=data.events[dk]||[];
              const dow=d.getDay();
              const meals=weeklyMeals[dow];
              const acts=weeklyActivities[dow]||[];
              const cost=meals.breakfast.cost+meals.lunch.cost+meals.dinner.cost;
              return<div key={dk} className="week-overview-day">
                <div className="week-overview-date">{d.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'short'})}</div>
                <div className="week-overview-items">
                  <div className="week-overview-item"><span className="week-overview-icon">üçΩÔ∏è</span><span>Meals: ¬£{cost.toFixed(2)}</span></div>
                  {acts.map((a,i)=><div key={i} className="week-overview-item"><span className="week-overview-icon">{a.icon}</span><span>{a.name}</span></div>)}
                  {evs.map(e=><div key={e.id} className="week-overview-item event"><span className="week-overview-icon">üìÖ</span><span>{e.time} - {e.title}</span></div>)}
                  {currentGoalSteps.filter(s=>s.date.includes(d.toLocaleDateString('en-GB',{month:'short'})) || s.date.includes('Ongoing')).slice(0,1).map((s,i)=>
                    <div key={i} className="week-overview-item goal"><span className="week-overview-icon">üéØ</span><span>{s.text.substring(0,40)}...</span></div>
                  )}
                </div>
              </div>
            })}
          </div>
        </>}

        {/* MONTH OVERVIEW TAB */}
        {tab==='month'&&<>
          <div className="card">
            <h3 className="card-title">üìä December 2025</h3>
            
            <div className="quick-stats">
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.level||1}</div>
                <div className="quick-stat-label">Level</div>
              </div>
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.streak||0}</div>
                <div className="quick-stat-label">Streak</div>
              </div>
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.xp||0}</div>
                <div className="quick-stat-label">Total XP</div>
              </div>
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.longestStreak||0}</div>
                <div className="quick-stat-label">Best Streak</div>
              </div>
            </div>
            
            <div className="month-calendar">
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>SUN</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>MON</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>TUE</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>WED</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>THU</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>FRI</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>SAT</div>
              
              {Array.from({length:31},(_, i)=>{
                const day=i+1;
                const isToday=day===new Date().getDate()&&new Date().getMonth()===11;
                const dateStr=`2025-12-${day.toString().padStart(2,'0')}`;
                const dayTasks=Object.keys(data.completedTasks).filter(k=>k.includes(dateStr)&&data.completedTasks[k]);
                const totalPossible=26;
                const completion=dayTasks.length/totalPossible;
                
                return(
                  <div
                    key={day}
                    className={`month-day ${
                      completion>=0.8?'completed':completion>=0.5?'partial':''
                    } ${isToday?'today':''}`}
                    title={`${day} Dec: ${dayTasks.length}/${totalPossible} tasks (${Math.round(completion*100)}%)`}
                  >
                    {day}
                  </div>
                );
              })}
            </div>
            
            <div className="tip-box" style={{marginTop:'16px'}}>
              üí° <strong>Green days</strong> = 80%+ complete ‚Ä¢ <strong>Yellow days</strong> = 50-79% ‚Ä¢ <strong>Gray days</strong> = Under 50%
            </div>
          </div>
          
          <div className="card">
            <h3 className="card-title">üèÜ Achievements</h3>
            {(data.gamification?.achievements||[]).length===0&&(
              <div style={{padding:'40px',textAlign:'center',color:'var(--navy-light)'}}>
                <div style={{fontSize:'3rem',marginBottom:'16px'}}>üéØ</div>
                <div style={{fontSize:'1rem',fontWeight:600,marginBottom:'8px'}}>No achievements yet!</div>
                <div style={{fontSize:'0.85rem'}}>Complete tasks to unlock achievements and earn bonus XP!</div>
              </div>
            )}
            {(data.gamification?.achievements||[]).map((achievement,i)=>(
              <div key={i} style={{padding:'12px',background:'var(--cream)',borderRadius:'var(--radius-md)',marginBottom:'8px',display:'flex',alignItems:'center',gap:'12px'}}>
                <div style={{fontSize:'2rem'}}>{achievement.icon}</div>
                <div style={{flex:1}}>
                  <div style={{fontWeight:700,fontSize:'0.9rem'}}>{achievement.name}</div>
                  <div style={{fontSize:'0.75rem',color:'var(--navy-light)'}}>{achievement.description}</div>
                </div>
                <div style={{fontSize:'0.8rem',fontWeight:700,color:'var(--gold)'}}>+{achievement.xp} XP</div>
              </div>
            ))}
          </div>
        </>}

        {/* SETTINGS TAB */}
        {tab==='settings'&&<div className="card">
          <h3 className="card-title">‚öôÔ∏è Settings</h3>
          <div style={{display:'grid',gap:12}}>
            <div><label className="form-label">Family Name</label><input type="text" className="form-input" value={config.familyName} onChange={e=>setConfig(c=>({...c,familyName:e.target.value}))}/></div>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
              <div><label className="form-label">Current Location</label><input type="text" className="form-input" value={config.location} onChange={e=>setConfig(c=>({...c,location:e.target.value}))}/></div>
              <div><label className="form-label">Target Location</label><input type="text" className="form-input" value={config.targetLocation} onChange={e=>setConfig(c=>({...c,targetLocation:e.target.value}))}/></div>
            </div>
            <div>
  <label className="form-label">Shawnie Return Date</label>
  <input 
    type="date" 
    className="form-input" 
    value={config.shawnieReturnDate} 
    min={new Date().toISOString().split('T')[0]}
    onChange={e=>{
      const newDate=new Date(e.target.value);
      const today=new Date();
      today.setHours(0,0,0,0);
      
      if(newDate<today){
        alert('Return date cannot be in the past');
        return;
      }
      
      setConfig(c=>({...c,shawnieReturnDate:e.target.value}));
    }}
  />
</div>
          </div>
          <div style={{marginTop:20,display:'flex',gap:10,flexWrap:'wrap'}}>
            <button className="btn btn-secondary" onClick={exportData} title="Backup your family data">
              üíæ Export Data
            </button>
            <label className="btn btn-secondary" style={{cursor:'pointer'}} title="Restore from backup">
              üìÇ Import Data
              <input type="file" accept=".json" onChange={importData} style={{display:'none'}}/>
            </label>
            <button className="btn btn-secondary" onClick={()=>{
              if(confirm('Clear all milestone photos? This cannot be undone.')){
                setData(prev=>({...prev,milestones:prev.milestones.map(m=>({...m,photo:null}))}));
                celebrate('Photos Cleared! üóëÔ∏è');
              }
            }} title="Free up storage space">
              üóëÔ∏è Clear Photos
            </button>
            <button className="btn btn-primary" style={{background:'#dc2626'}} onClick={()=>{
              if(confirm('‚ö†Ô∏è Reset EVERYTHING? This will delete all your family data, tasks, notes, and photos. This cannot be undone!')){
                localStorage.clear();
                window.location.reload();
              }
            }} title="Start fresh">
              üîÑ Reset All
            </button>
          </div>        </div>}
      </main>
      <button className="fab" onClick={()=>setTab('overview')}>üè†</button>
    </div>
  );
};

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
  </script>
</body>
</html>
