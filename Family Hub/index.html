<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- PWA Meta Tags - Phase 13 -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Family Hub Pro">
  <meta name="theme-color" content="#0ea5e9">
  <meta name="description" content="Professional family management system - Tasks, budget, goals, and more">
  
  <title>Family Hub Pro - Your Family's Command Center</title>
  
  <!-- Modern Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* Modern Professional Reset & Base */
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    
    :root{
      /* Modern Color Palette - Professional & Clean */
      --primary:#0ea5e9;
      --primary-dark:#0284c7;
      --primary-light:#38bdf8;
      --secondary:#8b5cf6;
      --secondary-dark:#7c3aed;
      --accent:#f59e0b;
      --accent-dark:#d97706;
      --success:#10b981;
      --warning:#f59e0b;
      --error:#ef4444;
      
      /* Neutrals - Modern Grays */
      --gray-50:#f9fafb;
      --gray-100:#f3f4f6;
      --gray-200:#e5e7eb;
      --gray-300:#d1d5db;
      --gray-400:#9ca3af;
      --gray-500:#6b7280;
      --gray-600:#4b5563;
      --gray-700:#374151;
      --gray-800:#1f2937;
      --gray-900:#111827;
      
      /* Semantic Colors */
      --bg-primary:#ffffff;
      --bg-secondary:var(--gray-50);
      --text-primary:var(--gray-900);
      --text-secondary:var(--gray-600);
      --border:var(--gray-200);
      
      /* Shadows - Modern & Subtle */
      --shadow-xs:0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-sm:0 1px 3px 0 rgb(0 0 0 / 0.1);
      --shadow-md:0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg:0 10px 15px -3px rgb(0 0 0 / 0.1);
      --shadow-xl:0 20px 25px -5px rgb(0 0 0 / 0.1);
      --shadow-2xl:0 25px 50px -12px rgb(0 0 0 / 0.25);
      
      /* Border Radius - Modern */
      --radius-sm:0.375rem;
      --radius-md:0.5rem;
      --radius-lg:0.75rem;
      --radius-xl:1rem;
      --radius-2xl:1.5rem;
      --radius-full:9999px;
      
      /* Spacing System */
      --space-1:0.25rem;
      --space-2:0.5rem;
      --space-3:0.75rem;
      --space-4:1rem;
      --space-6:1.5rem;
      --space-8:2rem;
      
      /* Transitions */
      --transition:all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Dark Mode Variables */
    body.dark-mode{
      --bg-primary:#0f172a;
      --bg-secondary:#1e293b;
      --text-primary:#f1f5f9;
      --text-secondary:#cbd5e1;
      --border:#334155;
    }
    
    /* Base Styles - Modern Typography */
    body{
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      background:var(--bg-secondary);
      color:var(--text-primary);
      min-height:100vh;
      line-height:1.6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      transition:background 0.3s,color 0.3s;
    }
    
    h1,h2,h3,h4,h5,h6{
      font-weight:700;
      line-height:1.2;
      letter-spacing:-0.02em;
    }
    
    /* Modern App Container */
    .app{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    
    /* Modern Header - Clean & Professional */
    .header{
      background:var(--bg-primary);
      border-bottom:1px solid var(--border);
      padding:1rem 1.5rem;
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter:blur(8px);
      background:rgba(255,255,255,0.8);
    }
    
    body.dark-mode .header{
      background:rgba(15,23,42,0.8);
      border-bottom-color:var(--border);
    }
    
    .header-content{
      max-width:1400px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    
    /* Modern Logo */
    .logo{
      display:flex;
      align-items:center;
      gap:0.75rem;
    }
    
    .logo-icon{
      width:2.5rem;
      height:2.5rem;
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      border-radius:var(--radius-lg);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.25rem;
      box-shadow:var(--shadow-md);
    }
    
    .logo-title{
      font-size:1.25rem;
      font-weight:700;
      color:var(--text-primary);
    }
    
    .logo-sub{
      font-size:0.75rem;
      color:var(--text-secondary);
      font-weight:500;
    }
    
    /* Modern Stats Bar */
    .stats-bar{
      display:flex;
      gap:1.5rem;
      align-items:center;
    }
    
    .stat-item{
      display:flex;
      align-items:center;
      gap:0.5rem;
      padding:0.5rem 1rem;
      background:var(--bg-secondary);
      border-radius:var(--radius-full);
      font-size:0.875rem;
      font-weight:600;
    }
    
    .stat-icon{font-size:1.25rem}
    .stat-value{color:var(--primary)}
    
    /* Modern Navigation - Sleek Tabs */
    .nav{
      background:var(--bg-primary);
      border-bottom:1px solid var(--border);
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
    }
    
    .nav-inner{
      max-width:1400px;
      margin:0 auto;
      display:flex;
      gap:0.5rem;
      padding:0.5rem 1.5rem;
    }
    
    .nav-tab{
      padding:0.625rem 1.25rem;
      background:transparent;
      border:none;
      border-radius:var(--radius-lg);
      font-size:0.875rem;
      font-weight:600;
      color:var(--text-secondary);
      cursor:pointer;
      transition:var(--transition);
      white-space:nowrap;
      position:relative;
    }
    
    .nav-tab:hover{
      background:var(--bg-secondary);
      color:var(--text-primary);
    }
    
    .nav-tab.active{
      background:var(--primary);
      color:white;
      box-shadow:var(--shadow-md);
    }
    
    /* Main Content - Modern Layout */
    main{
      flex:1;
      max-width:1400px;
      width:100%;
      margin:0 auto;
      padding:2rem 1.5rem;
    }
    
    /* Modern Cards - Clean & Elevated */
    .card{
      background:var(--bg-primary);
      border-radius:var(--radius-xl);
      padding:1.5rem;
      box-shadow:var(--shadow-sm);
      border:1px solid var(--border);
      margin-bottom:1.5rem;
      transition:var(--transition);
    }
    
    .card:hover{
      box-shadow:var(--shadow-md);
    }
    
    .card-title{
      font-size:1.25rem;
      font-weight:700;
      margin-bottom:1rem;
      color:var(--text-primary);
      display:flex;
      align-items:center;
      gap:0.5rem;
    }
    
    .card-icon{
      font-size:1.5rem;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    
    /* Modern Buttons */
    .btn{
      padding:0.625rem 1.25rem;
      border-radius:var(--radius-lg);
      font-weight:600;
      font-size:0.875rem;
      border:none;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;
      align-items:center;
      gap:0.5rem;
      text-decoration:none;
    }
    
    .btn-primary{
      background:var(--primary);
      color:white;
    }
    
    .btn-primary:hover{
      background:var(--primary-dark);
      transform:translateY(-1px);
      box-shadow:var(--shadow-lg);
    }
    
    .btn-secondary{
      background:var(--bg-secondary);
      color:var(--text-primary);
      border:1px solid var(--border);
    }
    
    .btn-secondary:hover{
      background:var(--gray-200);
    }
    
    .btn-sm{
      padding:0.5rem 1rem;
      font-size:0.8125rem;
    }
    
    /* Modern Inputs */
    .form-input{
      width:100%;
      padding:0.75rem 1rem;
      border:1px solid var(--border);
      border-radius:var(--radius-lg);
      font-size:0.875rem;
      background:var(--bg-primary);
      color:var(--text-primary);
      transition:var(--transition);
    }
    
    .form-input:focus{
      outline:none;
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(14,165,233,0.1);
    }
    
    /* Modern Tags/Badges */
    .tag{
      display:inline-flex;
      padding:0.25rem 0.75rem;
      border-radius:var(--radius-full);
      font-size:0.75rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.025em;
    }
    
    .tag-critical{background:#fee2e2;color:#991b1b}
    .tag-high{background:#fed7aa;color:#92400e}
    .tag-medium{background:#dbeafe;color:#1e40af}
    .tag-low{background:#e5e7eb;color:#374151}
    
    /* Modern Task List */
    .compact-task{
      display:flex;
      align-items:center;
      gap:1rem;
      padding:0.875rem;
      background:var(--bg-secondary);
      border-radius:var(--radius-lg);
      margin-bottom:0.75rem;
      cursor:pointer;
      transition:var(--transition);
      border:2px solid transparent;
    }
    
    .compact-task:hover{
      background:var(--gray-100);
      border-color:var(--primary);
      transform:translateX(4px);
    }
    
    .compact-task.completed{
      opacity:0.6;
    }
    
    .task-check{
      width:1.5rem;
      height:1.5rem;
      border:2px solid var(--gray-300);
      border-radius:var(--radius-md);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      transition:var(--transition);
    }
    
    .task-check.checked{
      background:var(--success);
      border-color:var(--success);
      color:white;
    }
    
    /* Modern Progress Bars */
    .progress-bar{
      height:0.5rem;
      background:var(--gray-200);
      border-radius:var(--radius-full);
      overflow:hidden;
      margin:0.5rem 0;
    }
    
    .progress-fill{
      height:100%;
      background:linear-gradient(90deg,var(--primary),var(--secondary));
      transition:width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius:var(--radius-full);
    }
    
    /* Modern Grid Layouts */
    .summary-row{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:1rem;
      margin-bottom:1.5rem;
    }
    
    .summary-box{
      background:var(--bg-primary);
      padding:1.5rem;
      border-radius:var(--radius-xl);
      border:1px solid var(--border);
      box-shadow:var(--shadow-sm);
      transition:var(--transition);
    }
    
    .summary-box:hover{
      box-shadow:var(--shadow-md);
      transform:translateY(-2px);
    }
    
    .summary-label{
      font-size:0.8125rem;
      color:var(--text-secondary);
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.05em;
      margin-bottom:0.5rem;
    }
    
    .summary-value{
      font-size:2rem;
      font-weight:700;
      color:var(--text-primary);
    }
    
    /* Modern Modal */
    .modal-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.5);
      backdrop-filter:blur(4px);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:100;
      padding:1rem;
    }
    
    .modal-content{
      background:var(--bg-primary);
      border-radius:var(--radius-2xl);
      padding:2rem;
      max-width:500px;
      width:100%;
      box-shadow:var(--shadow-2xl);
      max-height:90vh;
      overflow-y:auto;
    }
    
    /* Modern FAB */
    .fab{
      position:fixed;
      bottom:2rem;
      right:2rem;
      width:3.5rem;
      height:3.5rem;
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:white;
      border:none;
      border-radius:var(--radius-full);
      font-size:1.5rem;
      cursor:pointer;
      box-shadow:var(--shadow-xl);
      transition:var(--transition);
      z-index:40;
    }
    
    .fab:hover{
      transform:scale(1.1) rotate(90deg);
      box-shadow:var(--shadow-2xl);
    }
    
    /* Dark Mode Specifics */
    body.dark-mode{
      background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);
    }
    
    body.dark-mode .card{
      background:rgba(30,41,59,0.6);
      border-color:rgba(71,85,105,0.3);
      backdrop-filter:blur(10px);
    }
    
    body.dark-mode .compact-task{
      background:rgba(30,41,59,0.4);
    }
    
    body.dark-mode .compact-task:hover{
      background:rgba(30,41,59,0.7);
    }
    
    /* Responsive Design */
    @media(max-width:768px){
      main{padding:1rem}
      .card{padding:1rem}
      .summary-row{grid-template-columns:1fr}
      .stats-bar{display:none}
    }
    
    /* Animations */
    @keyframes slideIn{
      from{opacity:0;transform:translateY(20px)}
      to{opacity:1;transform:translateY(0)}
    }
    
    .card{animation:slideIn 0.4s ease-out}
    
    /* Offline Indicator */
    .offline-banner{
      position:fixed;
      top:0;
      left:0;
      right:0;
      background:#f59e0b;
      color:white;
      padding:0.75rem;
      text-align:center;
      font-weight:600;
      font-size:0.875rem;
      z-index:60;
      box-shadow:var(--shadow-lg);
    }
    
    /* PWA Install Prompt */
    .install-prompt{
      position:fixed;
      bottom:5rem;
      left:1rem;
      right:1rem;
      background:var(--bg-primary);
      border-radius:var(--radius-xl);
      padding:1rem;
      box-shadow:var(--shadow-2xl);
      border:1px solid var(--border);
      z-index:50;
      display:flex;
      gap:1rem;
      align-items:center;
    }
  </style>
<body>
  <div id="root"></div>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script type="text/babel">
const{useState,useEffect,useMemo,useCallback}=React;
const Check=()=><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>;
const ChevronDown=()=><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>;

const weeklyMeals={
  0:{breakfast:{name:"Lazy Sunday pancakes",cost:1.20,prep:"25min",cook:"Rich"},lunch:{name:"Roast prep nibbles",cost:2.00,prep:"15min",cook:"Rich"},dinner:{name:"Sunday roast chicken",cost:8.00,prep:"2hr",cook:"Rich"}},
  1:{breakfast:{name:"Porridge with honey",cost:0.40,prep:"10min",cook:"Rich"},lunch:{name:"Leftover roast sandwiches",cost:0.50,prep:"5min",cook:"Either"},dinner:{name:"Spaghetti Bolognese",cost:4.00,prep:"45min",cook:"Rich"}},
  2:{breakfast:{name:"Scrambled eggs on toast",cost:0.80,prep:"10min",cook:"Rich"},lunch:{name:"Soup & crusty bread",cost:1.50,prep:"20min",cook:"Rich"},dinner:{name:"Chicken stir fry",cost:4.50,prep:"30min",cook:"Rich"}},
  3:{breakfast:{name:"Yogurt, granola & fruit",cost:0.70,prep:"5min",cook:"Either"},lunch:{name:"Cheese toasties",cost:1.20,prep:"15min",cook:"Either"},dinner:{name:"Shepherd's pie",cost:4.00,prep:"1hr",cook:"Rich"}},
  4:{breakfast:{name:"Beans on toast",cost:0.50,prep:"10min",cook:"Either"},lunch:{name:"Jacket potato & beans",cost:1.00,prep:"1hr",cook:"Rich"},dinner:{name:"Fish fingers & chips",cost:3.50,prep:"30min",cook:"Rich"}},
  5:{breakfast:{name:"French toast",cost:0.60,prep:"15min",cook:"Rich"},lunch:{name:"BLT sandwiches",cost:2.00,prep:"10min",cook:"Either"},dinner:{name:"Homemade pizza",cost:3.50,prep:"45min",cook:"Rich"}},
  6:{breakfast:{name:"Full English (budget)",cost:2.00,prep:"25min",cook:"Rich"},lunch:{name:"Pasta salad",cost:1.50,prep:"15min",cook:"Rich"},dinner:{name:"Curry & rice",cost:4.00,prep:"45min",cook:"Rich"}}
};

const weeklyActivities={
  0:[{name:"Board game afternoon",icon:"üé≤",person:"Family",cost:0,duration:"2hr"},{name:"Anime movie night",icon:"üì∫",person:"Both",cost:0,duration:"2hr"}],
  1:[{name:"Library visit",icon:"üìö",person:"Family",cost:0,duration:"1hr"},{name:"Lego building",icon:"üß±",person:"Family",cost:0,duration:"1hr"}],
  2:[{name:"Seaham beach walk",icon:"üèñÔ∏è",person:"Family",cost:0,duration:"2hr"},{name:"History documentary",icon:"üèõÔ∏è",person:"Rich",cost:0,duration:"1hr"}],
  3:[{name:"Soft play / park",icon:"üõù",person:"Madison",cost:0,duration:"2hr"},{name:"Cafe trip",icon:"‚òï",person:"Family",cost:8,duration:"1hr"}],
  4:[{name:"Museum trip (free)",icon:"üèõÔ∏è",person:"Family",cost:0,duration:"2hr"},{name:"Gaming session",icon:"üéÆ",person:"Both",cost:0,duration:"2hr"}],
  5:[{name:"Local park adventure",icon:"üå≥",person:"Family",cost:0,duration:"2hr"},{name:"Pizza making together",icon:"üçï",person:"Family",cost:0,duration:"1hr"}],
  6:[{name:"Lie-in rotation",icon:"üò¥",person:"Both",cost:0,duration:"2hr"},{name:"Nature walk / hike",icon:"ü•æ",person:"Family",cost:0,duration:"2hr"}]
};

const dailyTasks={
  fixed:[
    {task:"Make beds",person:"Both",time:"morning",icon:"üõèÔ∏è"},
    {task:"Breakfast dishes",person:"Rich",time:"morning",icon:"üçΩÔ∏è"},
    {task:"Kitchen wipe",person:"Rich",time:"morning",icon:"üßΩ"},
    {task:"Madison morning routine",person:"Shawnie",time:"morning",icon:"üë∂"},
    {task:"Laundry load",person:"Rich",time:"morning",icon:"üëï"},
    {task:"Lunch dishes",person:"Either",time:"afternoon",icon:"üçΩÔ∏è"},
    {task:"Living room tidy",person:"Either",time:"afternoon",icon:"üõãÔ∏è"},
    {task:"Madison quiet time",person:"Both",time:"afternoon",icon:"üò¥"},
    {task:"Cook dinner",person:"Rich",time:"evening",icon:"üç≥"},
    {task:"Dinner dishes",person:"Rich",time:"evening",icon:"üçΩÔ∏è"},
    {task:"Bath Madison",person:"Rich",time:"evening",icon:"üõÅ"},
    {task:"Bedtime routine",person:"Both",time:"evening",icon:"üìñ"},
    {task:"Evening tidy (10min)",person:"Both",time:"evening",icon:"‚ú®"},
    {task:"Check finances",person:"Shawnie",time:"evening",icon:"üí∞"}
  ],
  weekly:{
    0:[{task:"Hoover whole house",person:"Rich",icon:"üßπ"},{task:"Meal plan for week",person:"Shawnie",icon:"üìù"}],
    1:[{task:"Clean bathroom",person:"Rich",icon:"üöø"},{task:"Mop kitchen floor",person:"Rich",icon:"üßπ"}],
    2:[{task:"Change bed sheets",person:"Both",icon:"üõèÔ∏è"},{task:"Dust surfaces",person:"Either",icon:"‚ú®"}],
    3:[{task:"Deep clean kitchen",person:"Rich",icon:"‚ú®"},{task:"Budget review",person:"Shawnie",icon:"üìä"}],
    4:[{task:"Hoover whole house",person:"Rich",icon:"üßπ"},{task:"Clean mirrors/windows",person:"Either",icon:"ü™ü"}],
    5:[{task:"Tidy/declutter session",person:"Both",icon:"üì¶"},{task:"Food shopping",person:"Both",icon:"üõí"}],
    6:[{task:"Laundry catch-up",person:"Rich",icon:"üëï"},{task:"Week prep",person:"Both",icon:"üìã"}]
  }
};

// GOALS SYSTEM OVERHAUL - Daily Tasks + Stretch Goals
const dailyGoalTasks=[
  // ELECTRICIAN PATH - Daily actions
  {id:'elec-1',goal:'electrician',task:'Research 1 Sheffield apprenticeship opportunity',person:'Rich',time:'Anytime',xp:25,frequency:'daily',priority:'critical',category:'career'},
  {id:'elec-2',goal:'electrician',task:'Practice electrical theory (15 mins)',person:'Rich',time:'Anytime',xp:20,frequency:'daily',priority:'high',category:'career'},
  {id:'elec-3',goal:'electrician',task:'Watch 1 electrical tutorial video',person:'Rich',time:'Anytime',xp:15,frequency:'weekly',priority:'medium',category:'career'},
  
  // SHAWNIE CAREER - Daily actions
  {id:'shawn-1',goal:'shawnie-career',task:'Review PIP assessment guidelines (10 mins)',person:'Shawnie',time:'Anytime',xp:15,frequency:'daily',priority:'high',category:'career'},
  {id:'shawn-2',goal:'shawnie-career',task:'Research Sheffield NHS roles',person:'Shawnie',time:'Anytime',xp:20,frequency:'weekly',priority:'medium',category:'career'},
  
  // SHEFFIELD MOVE - Daily actions  
  {id:'sheff-1',goal:'sheffield',task:'Browse Rightmove Sheffield (10 mins)',person:'Both',time:'Anytime',xp:15,frequency:'daily',priority:'high',category:'move'},
  {id:'sheff-2',goal:'sheffield',task:'Research Sheffield neighborhood',person:'Both',time:'Anytime',xp:20,frequency:'weekly',priority:'high',category:'move'},
  {id:'sheff-3',goal:'sheffield',task:'Check Sheffield local groups/events',person:'Both',time:'Anytime',xp:15,frequency:'weekly',priority:'medium',category:'move'},
  
  // FINANCIAL - Daily actions
  {id:'fin-1',goal:'financial',task:'Check bank balance & upcoming bills',person:'Shawnie',time:'21:00',xp:10,frequency:'daily',priority:'critical',category:'money'},
  {id:'fin-2',goal:'financial',task:'Log today\'s expenses in notes',person:'Both',time:'Anytime',xp:10,frequency:'daily',priority:'high',category:'money'},
  {id:'fin-3',goal:'financial',task:'Find 1 money-saving opportunity',person:'Both',time:'Anytime',xp:15,frequency:'daily',priority:'medium',category:'money'},
  
  // MADISON - Daily tracking
  {id:'mad-1',goal:'madison',task:'Update Madison development log',person:'Both',time:'21:30',xp:15,frequency:'daily',priority:'high',category:'madison'},
  {id:'mad-2',goal:'madison',task:'Take 1 photo of Madison',person:'Both',time:'Anytime',xp:10,frequency:'daily',priority:'medium',category:'madison'},
  {id:'mad-3',goal:'madison',task:'Try 1 new activity with Madison',person:'Both',time:'Anytime',xp:20,frequency:'weekly',priority:'medium',category:'madison'},
  
  // FAMILY WELLBEING - Daily actions
  {id:'fam-1',goal:'wellbeing',task:'15-min quality time (just you two)',person:'Both',time:'22:00',xp:20,frequency:'daily',priority:'high',category:'wellbeing'},
  {id:'fam-2',goal:'wellbeing',task:'Express gratitude to partner',person:'Both',time:'Anytime',xp:10,frequency:'daily',priority:'medium',category:'wellbeing'},
  {id:'fam-3',goal:'wellbeing',task:'Plan weekend family activity',person:'Both',time:'Anytime',xp:15,frequency:'weekly',priority:'medium',category:'wellbeing'}
];

// STRETCH GOALS - Ambitious, long-term aspirations
const stretchGoals=[
  {
    id:'stretch-1',
    icon:'üèÜ',
    title:'Rich: Master Electrician',
    subtitle:'Full qualification + ¬£45k+ salary',
    person:'Rich',
    target:'2029',
    milestones:[
      {text:'Complete Level 3 qualification',target:'2028',xp:500},
      {text:'Pass 18th Edition exam',target:'2028',xp:300},
      {text:'Secure ¬£40k+ qualified position',target:'2029',xp:1000},
      {text:'Achieve ¬£45k+ salary',target:'2029',xp:500}
    ],
    reward:'Career secured + financial stability for family'
  },
  {
    id:'stretch-2',
    icon:'üëë',
    title:'Shawnie: Band 8a Team Leader',
    subtitle:'Senior NHS leadership role',
    person:'Shawnie',
    target:'2030',
    milestones:[
      {text:'Return to work Band 6',target:'Jul 2026',xp:300},
      {text:'Achieve Band 7 promotion',target:'2027',xp:500},
      {text:'Complete leadership training',target:'2028-2029',xp:300},
      {text:'Secure Band 8a position (¬£55k+)',target:'2030',xp:1000}
    ],
    reward:'NHS leadership + ¬£55k+ income + career fulfillment'
  },
  {
    id:'stretch-3',
    icon:'üèòÔ∏è',
    title:'Family: Sheffield Life Established',
    subtitle:'Fully settled in new city',
    person:'Family',
    target:'2027',
    milestones:[
      {text:'Move to Sheffield',target:'Nov 2026',xp:500},
      {text:'Make 5+ local family friends',target:'2027',xp:300},
      {text:'Find favorite local spots (caf√©, park, etc)',target:'2027',xp:200},
      {text:'Madison thriving in Sheffield nursery',target:'2027',xp:300},
      {text:'Feel "at home" in Sheffield',target:'2027',xp:500}
    ],
    reward:'Community, belonging, happiness in Sheffield'
  },
  {
    id:'stretch-4',
    icon:'üè°',
    title:'Family: First-Time Homeowners',
    subtitle:'Own home in Sheffield by 2030',
    person:'Family',
    target:'2030',
    milestones:[
      {text:'Save ¬£25,000 deposit',target:'2029',xp:1000},
      {text:'Get mortgage approval',target:'2030',xp:300},
      {text:'Find perfect family home',target:'2030',xp:200},
      {text:'Complete house purchase',target:'2030',xp:1500},
      {text:'Move into OWN home',target:'2030',xp:500}
    ],
    reward:'Stability, security, wealth building, legacy for Madison'
  },
  {
    id:'stretch-5',
    icon:'üí∞',
    title:'Family: ¬£95k+ Combined Income',
    subtitle:'Financial freedom achieved',
    person:'Family',
    target:'2029',
    milestones:[
      {text:'Rich earning ¬£40k+ (qualified)',target:'2029',xp:500},
      {text:'Shawnie earning ¬£50k+ (Band 7)',target:'2028',xp:500},
      {text:'Combined ¬£90k+ income',target:'2029',xp:500},
      {text:'Combined ¬£95k+ income',target:'2029',xp:500},
      {text:'Save ¬£1,000+/month comfortably',target:'2029',xp:300}
    ],
    reward:'No more money stress, holidays, savings, Madison\'s future secured'
  },
  {
    id:'stretch-6',
    icon:'üë∂',
    title:'Madison: Thriving Development',
    subtitle:'Happy, healthy, hitting milestones',
    person:'Madison',
    target:'2028',
    milestones:[
      {text:'Walking confidently',target:'2026',xp:200},
      {text:'Talking in sentences',target:'2027',xp:200},
      {text:'Potty trained',target:'2028',xp:200},
      {text:'Ready for school',target:'2028',xp:300},
      {text:'Happy, confident, loved',target:'Ongoing',xp:500}
    ],
    reward:'Madison grows into amazing little human, proud parents'
  },
  {
    id:'stretch-7',
    icon:'‚úàÔ∏è',
    title:'Family: First Proper Holiday',
    subtitle:'Week abroad - make memories',
    person:'Family',
    target:'2028',
    milestones:[
      {text:'Save ¬£2,000 for holiday fund',target:'2028',xp:300},
      {text:'Madison old enough to travel (3+)',target:'2028',xp:100},
      {text:'Book week-long family holiday',target:'2028',xp:200},
      {text:'Go on amazing holiday together',target:'2028',xp:1000}
    ],
    reward:'Memories with Madison, break from UK, quality family time'
  },
  {
    id:'stretch-8',
    icon:'üéì',
    title:'Madison: School Ready',
    subtitle:'Start Reception September 2028',
    person:'Madison',
    target:'2028',
    milestones:[
      {text:'Thriving in nursery (2026-2028)',target:'2028',xp:300},
      {text:'Social skills developed',target:'2028',xp:200},
      {text:'Accepted to good primary school',target:'2028',xp:300},
      {text:'Excited to start school',target:'Sep 2028',xp:500}
    ],
    reward:'Madison ready for next chapter, proud parents'
  },
  {
    id:'stretch-9',
    icon:'üí™',
    title:'Rich: Physically Fit & Healthy',
    subtitle:'Get in best shape',
    person:'Rich',
    target:'2027',
    milestones:[
      {text:'Establish gym routine (3x/week)',target:'2026',xp:200},
      {text:'Achieve target weight/fitness',target:'2027',xp:300},
      {text:'Maintain for 6+ months',target:'2027',xp:300},
      {text:'Feel energized and confident',target:'2027',xp:200}
    ],
    reward:'Energy for Madison, confidence, long life to watch her grow'
  },
  {
    id:'stretch-10',
    icon:'‚ù§Ô∏è',
    title:'Family: Strong Marriage',
    subtitle:'Partnership through challenges',
    person:'Both',
    target:'Ongoing',
    milestones:[
      {text:'Survive tough 2025-2026',target:'Jul 2026',xp:500},
      {text:'Weekly date nights maintained',target:'Ongoing',xp:200},
      {text:'Support each other\'s goals',target:'Ongoing',xp:300},
      {text:'Still deeply in love',target:'Ongoing',xp:1000}
    ],
    reward:'Strong partnership, happy family, role models for Madison'
  }
];

const defaultGoals=[];

const defaultBenefits=[
  {id:'uc',name:'Universal Credit',claimed:true,saving:null},
  {id:'cb',name:'Child Benefit (¬£25.60/wk)',claimed:true,saving:111},
  {id:'ctReduction',name:'Council Tax Reduction',claimed:true,saving:null},
  {id:'warmHome',name:'Warm Home Discount (¬£150/yr)',claimed:true,saving:150},
  {id:'healthyStart',name:'Healthy Start Vouchers (¬£8.50/wk)',claimed:true,saving:442},
  {id:'socialBroadband',name:'Social Broadband (save ¬£20/mo)',claimed:false,saving:240},
  {id:'waterSocial',name:'Water Social Tariff',claimed:true,saving:200},
  {id:'freeDental',name:'Free NHS Dental (HC2)',claimed:true,saving:70},
  {id:'freeEyeTest',name:'Free Eye Tests',claimed:true,saving:25}
];

const defaultBudget={
  income:{shawnieNet:0,richNet:0,childBenefit:108,universalCredit:1800,pip:0,other:200},
  expenses:{
    rent:700,councilTax:0,electric:120,gas:80,water:35,broadband:30,
    phoneRich:15,phoneShawnie:15,carFinance:200,carInsurance:80,petrol:100,
    groceries:400,childcare:0,subscriptions:40,insurance:30,other:50
  },
  savings:{emergency:0,houseDeposit:0,lisaRich:0,lisaShawnie:0,madisonJISA:0,pension:0}
};

// Phase 8: Bill Tracker
const defaultBills=[
  {id:'rent',name:'Rent',amount:700,dueDate:1,category:'housing',recurring:'monthly',autoDebit:true,lastPaid:''},
  {id:'electric',name:'Electricity',amount:120,dueDate:15,category:'utilities',recurring:'monthly',autoDebit:true,lastPaid:''},
  {id:'gas',name:'Gas',amount:80,dueDate:15,category:'utilities',recurring:'monthly',autoDebit:true,lastPaid:''},
  {id:'water',name:'Water',amount:35,dueDate:5,category:'utilities',recurring:'monthly',autoDebit:true,lastPaid:''},
  {id:'broadband',name:'Broadband',amount:30,dueDate:10,category:'utilities',recurring:'monthly',autoDebit:true,lastPaid:''},
  {id:'council-tax',name:'Council Tax',amount:0,dueDate:1,category:'housing',recurring:'monthly',autoDebit:false,lastPaid:''},
  {id:'car-finance',name:'Car Finance',amount:200,dueDate:20,category:'transport',recurring:'monthly',autoDebit:true,lastPaid:''},
  {id:'car-insurance',name:'Car Insurance',amount:960,dueDate:'2026-03-15',category:'transport',recurring:'yearly',autoDebit:false,lastPaid:''}
];

// Phase 8: Subscription Tracker
const defaultSubscriptions=[
  {id:'netflix',name:'Netflix',cost:10.99,billing:'monthly',category:'entertainment',autoRenew:true,renewDate:'2025-12-01',cancelBy:'',worth:true,notes:''},
  {id:'spotify',name:'Spotify',cost:10.99,billing:'monthly',category:'entertainment',autoRenew:true,renewDate:'2025-12-15',cancelBy:'',worth:true,notes:''},
  {id:'prime',name:'Amazon Prime',cost:8.99,billing:'monthly',category:'shopping',autoRenew:true,renewDate:'2025-12-20',cancelBy:'',worth:true,notes:''}
];

// Phase 8: Savings Goals
const defaultSavingsGoals=[
  {id:'emergency',name:'Emergency Fund',target:3000,current:0,priority:'critical',monthly:50,deadline:'2027-12',icon:'üõ°Ô∏è',notes:'3 months expenses'},
  {id:'house-deposit',name:'House Deposit',target:25000,current:0,priority:'critical',monthly:500,deadline:'2029-12',icon:'üè°',notes:'First home Sheffield'},
  {id:'madison-future',name:"Madison's Future",target:5000,current:0,priority:'high',monthly:50,deadline:'2030-07',icon:'üéì',notes:'Education fund'},
  {id:'holiday',name:'Family Holiday',target:2000,current:0,priority:'medium',monthly:100,deadline:'2028-06',icon:'‚úàÔ∏è',notes:'First proper holiday'},
  {id:'car',name:'New Car Fund',target:5000,current:0,priority:'low',monthly:0,deadline:'2027-12',icon:'üöó',notes:'Replace current car'}
];

// Phase 8: Expense Tracking
const defaultExpenseLog=[];

const defaultMilestones=[
  {id:'first-smile',title:'First Smile',date:'2025-09',icon:'üòä',achieved:true,photo:null,notes:''},
  {id:'first-laugh',title:'First Laugh',date:'2025-11',icon:'üòÑ',achieved:false,photo:null,notes:''},
  {id:'rolling-over',title:'Rolling Over',date:'2025-12',icon:'üîÑ',achieved:true,photo:null,notes:''},
  {id:'first-unassisted-sit',title:'First Unassisted Sit',date:'2026-01',icon:'ü™ë',achieved:false,photo:null,notes:''},
  {id:'first-crawl',title:'First Crawl',date:'2026-04',icon:'üë∂',achieved:false,photo:null,notes:''},
  {id:'first-words',title:'First Words',date:'2026-07',icon:'üí¨',achieved:false,photo:null,notes:''},
  {id:'first-steps',title:'First Steps',date:'2026-07',icon:'üë£',achieved:false,photo:null,notes:''},
  {id:'first-birthday',title:'First Birthday',date:'2026-07-09',icon:'üéÇ',achieved:false,photo:null,notes:''},
  {id:'first-christmas',title:'First Christmas',date:'2025-12',icon:'üéÑ',achieved:false,photo:null,notes:''},
  {id:'first-swim',title:'First Swim',date:'2026-08',icon:'üèä',achieved:false,photo:null,notes:''},
  {id:'first-tooth',title:'First Tooth',date:'2026-01',icon:'ü¶∑',achieved:false,photo:null,notes:''},
  {id:'first-holiday',title:'First Family Holiday',date:'2026',icon:'üèñÔ∏è',achieved:false,photo:null,notes:''},
  {id:'first-day-nursery',title:'First Day Nursery',date:'2027',icon:'üè´',achieved:false,photo:null,notes:''},
  {id:'potty-trained',title:'Potty Trained',date:'2027',icon:'üöΩ',achieved:false,photo:null,notes:''},
  {id:'first-bike',title:'First Bike Ride',date:'2028',icon:'üö≤',achieved:false,photo:null,notes:''},
  {id:'first-school-day',title:'First Day School',date:'2029',icon:'üéí',achieved:false,photo:null,notes:''}
];

const familyAndFriends={
  sheffield:[
    {id:'kyle-dunja',names:'Kyle & Dunja',type:'friends',icon:'üë´',relation:'Friends',lastSeen:'',notes:''},
    {id:'kat',names:'Kat',type:'friend',icon:'üë§',relation:'Friend',lastSeen:'',notes:''}
  ],
  harrogate:[
    {id:'luke',names:'Luke',type:'friend',icon:'üë§',relation:'Friend',lastSeen:'',notes:''},
    {id:'rheiza',names:'Rheiza',type:'friend',icon:'üë§',relation:'Friend',lastSeen:'',notes:''}
  ],
  durham:[
    {id:'kay-family',names:'Kay, Richard & Zachary',type:'friends',icon:'üë®‚Äçüë©‚Äçüë¶',relation:'Friends & Son',lastSeen:'',notes:''}
  ],
  peterlee:[
    {id:'debbie-mick',names:'Debbie & Mick',type:'family',icon:'üë¥üëµ',relation:'Shawnie\'s Parents',lastSeen:'',notes:''}
  ],
  richFamily:[
    {id:'emily-isaac',names:'Emily & Isaac',type:'family',icon:'üë©‚Äçüë¶',relation:'Rich\'s Sister & Nephew',lastSeen:'',notes:''},
    {id:'becky-sully',names:'Becky & Sully',type:'family',icon:'üëµüë¥',relation:'Rich\'s Mom & Partner',lastSeen:'',notes:''}
  ],
  shawnieFamily:[
    {id:'jemma-family',names:'Jemma, James, Amelia & Oliver',type:'family',icon:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',relation:'Shawnie\'s Sister, Brother-in-law & Kids',lastSeen:'',notes:''},
    {id:'flora',names:'Flora',type:'family',icon:'üëµ',relation:'Shawnie\'s Grandma',lastSeen:'',notes:''},
    {id:'albert',names:'Albert',type:'family',icon:'üë¥',relation:'Shawnie\'s Grandad',lastSeen:'',notes:''},
    {id:'carole-jim',names:'Carole & Jim',type:'family',icon:'üëµüë¥',relation:'Shawnie\'s Grandma & Great-Grandad',lastSeen:'',notes:''}
  ]
};

const tailoredDailyTasks={
  family:[
    {task:'Wake & change Madison',person:'Both',exactTime:'7:00',icon:'üë∂',priority:'critical',xp:10},
    {task:'Madison breakfast',person:'Both',exactTime:'8:00',icon:'üçº',priority:'critical',xp:10},
    {task:'Tummy time',person:'Either',exactTime:'9:00',icon:'ü§∏',priority:'high',xp:8},
    {task:'Morning nap',person:'Either',exactTime:'10:00',icon:'üò¥',priority:'high',xp:5},
    {task:'Madison lunch',person:'Both',exactTime:'12:00',icon:'üçº',priority:'critical',xp:10},
    {task:'Play & activities',person:'Either',exactTime:'13:00',icon:'üéÆ',priority:'high',xp:8},
    {task:'Afternoon nap',person:'Either',exactTime:'14:30',icon:'üò¥',priority:'high',xp:5},
    {task:'Madison dinner',person:'Both',exactTime:'17:00',icon:'üçº',priority:'critical',xp:10},
    {task:'Bath time',person:'Rich',exactTime:'18:30',icon:'üõÅ',priority:'critical',xp:10},
    {task:'Bedtime routine',person:'Both',exactTime:'19:00',icon:'üìñ',priority:'critical',xp:15}
  ],
  house:[
    {task:'Make beds',person:'Both',exactTime:'8:30',icon:'üõèÔ∏è',priority:'medium',xp:5},
    {task:'Kitchen clean',person:'Rich',exactTime:'9:30',icon:'üßΩ',priority:'medium',xp:5},
    {task:'Laundry',person:'Rich',exactTime:'10:30',icon:'üëï',priority:'low',xp:5},
    {task:'Living room tidy',person:'Either',exactTime:'15:00',icon:'üõãÔ∏è',priority:'low',xp:3},
    {task:'Dinner prep',person:'Rich',exactTime:'16:30',icon:'üç≥',priority:'high',xp:10},
    {task:'Evening tidy',person:'Both',exactTime:'20:00',icon:'‚ú®',priority:'low',xp:5}
  ],
  meals:[
    {task:'Family breakfast',person:'Rich',exactTime:'9:00',icon:'üç≥',priority:'high',xp:8},
    {task:'Family lunch',person:'Either',exactTime:'13:00',icon:'ü•™',priority:'high',xp:8},
    {task:'Family dinner',person:'Rich',exactTime:'18:00',icon:'üçΩÔ∏è',priority:'high',xp:10}
  ],
  goals:dailyGoalTasks.filter(t=>t.frequency==='daily'||new Date().getDay()===0&&t.frequency==='weekly'||new Date().getDate()===1&&t.frequency==='monthly'),
  selfCare:[
    {task:'Rich relax time',person:'Rich',exactTime:'21:00',icon:'üéÆ',priority:'low',xp:5},
    {task:'Shawnie relax time',person:'Shawnie',exactTime:'21:00',icon:'‚òï',priority:'low',xp:5},
    {task:'Couple time',person:'Both',exactTime:'22:00',icon:'‚ù§Ô∏è',priority:'medium',xp:10}
  ],
  social:[
    {task:'Quick message to family/friends',person:'Both',exactTime:'Anytime',icon:'üí¨',priority:'low',xp:5,frequency:'daily'},
    {task:'Video call grandparents',person:'Both',exactTime:'Anytime',icon:'üìπ',priority:'medium',xp:15,frequency:'weekly'},
    {task:'Share Madison photo/update',person:'Both',exactTime:'Anytime',icon:'üì∏',priority:'low',xp:10,frequency:'weekly'},
    {task:'Plan Sheffield family meetup',person:'Both',exactTime:'Anytime',icon:'ü§ù',priority:'medium',xp:20,frequency:'monthly'}
  ]
};

const weeklySpecialTasks={
  0:[
    {task:'Hoover whole house',person:'Rich',icon:'üßπ',category:'cleaning'},
    {task:'Meal plan for week',person:'Both',icon:'üìù',category:'planning'},
    {task:'Sunday roast prep',person:'Rich',icon:'üçó',category:'cooking'}
  ],
  1:[
    {task:'Clean bathroom',person:'Rich',icon:'üöø',category:'cleaning'},
    {task:'Apprenticeship applications',person:'Rich',icon:'‚ö°',category:'goals'}
  ],
  2:[
    {task:'Change bed sheets',person:'Both',icon:'üõèÔ∏è',category:'cleaning'}
  ],
  3:[
    {task:'Deep clean kitchen',person:'Rich',icon:'‚ú®',category:'cleaning'},
    {task:'Budget review meeting',person:'Both',icon:'üìä',category:'goals'}
  ],
  4:[
    {task:'Hoover whole house',person:'Rich',icon:'üßπ',category:'cleaning'}
  ],
  5:[
    {task:'Food shopping',person:'Both',icon:'üõí',category:'essential'},
    {task:'Tidy/declutter session',person:'Both',icon:'üì¶',category:'cleaning'}
  ],
  6:[]
};

const defaultMadisonData={
  birthDate:'2025-07-09',
  growth:[
    {id:1,date:'2025-07-09',height:50,weight:3.4,headCirc:35,notes:'Birth measurements'},
    {id:2,date:'2025-08-09',height:56,weight:4.8,headCirc:38,notes:'1-month check'},
    {id:3,date:'2025-10-09',height:61,weight:6.2,headCirc:41,notes:'3-month check'},
    {id:4,date:'2025-12-09',height:65,weight:7.0,headCirc:43,notes:'5-month check'}
  ],
  vaccinations:[
    {id:'8wk-1',name:'6-in-1 vaccine (1st dose)',ageWeeks:8,completed:true,date:'2025-09-03'},
    {id:'8wk-2',name:'Rotavirus (1st dose)',ageWeeks:8,completed:true,date:'2025-09-03'},
    {id:'8wk-3',name:'MenB (1st dose)',ageWeeks:8,completed:true,date:'2025-09-03'},
    {id:'12wk-1',name:'6-in-1 vaccine (2nd dose)',ageWeeks:12,completed:true,date:'2025-10-01'},
    {id:'12wk-2',name:'Pneumococcal (PCV)',ageWeeks:12,completed:true,date:'2025-10-01'},
    {id:'12wk-3',name:'Rotavirus (2nd dose)',ageWeeks:12,completed:true,date:'2025-10-01'},
    {id:'16wk-1',name:'6-in-1 vaccine (3rd dose)',ageWeeks:16,completed:false,date:''},
    {id:'16wk-2',name:'MenB (2nd dose)',ageWeeks:16,completed:false,date:''},
    {id:'1yr-1',name:'Hib/MenC (1st dose)',ageMonths:12,completed:false,date:''},
    {id:'1yr-2',name:'MMR (1st dose)',ageMonths:12,completed:false,date:''},
    {id:'1yr-3',name:'Pneumococcal (2nd dose)',ageMonths:12,completed:false,date:''},
    {id:'1yr-4',name:'MenB (3rd dose)',ageMonths:12,completed:false,date:''},
    {id:'2yr',name:'Flu vaccine (annual)',ageYears:2,completed:false,date:''},
    {id:'3yr-1',name:'MMR (2nd dose)',ageYears:3,completed:false,date:''},
    {id:'3yr-2',name:'4-in-1 pre-school booster',ageYears:3,completed:false,date:''}
  ],
  developmental:{
    motor:[
      {id:'m1',skill:'Holds head steady',achieved:true,ageMonths:3,date:'2025-10-09'},
      {id:'m2',skill:'Rolls over both ways',achieved:true,ageMonths:5,date:'2025-12-09'},
      {id:'m3',skill:'Sits without support',achieved:false,ageMonths:6,date:''},
      {id:'m4',skill:'Crawls',achieved:false,ageMonths:9,date:''},
      {id:'m5',skill:'Pulls to standing',achieved:false,ageMonths:10,date:''},
      {id:'m6',skill:'Walks independently',achieved:false,ageMonths:12,date:''},
      {id:'m7',skill:'Runs',achieved:false,ageMonths:18,date:''},
      {id:'m8',skill:'Kicks ball',achieved:false,ageMonths:24,date:''},
      {id:'m9',skill:'Jumps with both feet',achieved:false,ageMonths:30,date:''}
    ],
    language:[
      {id:'l1',skill:'Responds to name',achieved:false,ageMonths:9,date:''},
      {id:'l2',skill:'Says "mama" or "dada"',achieved:false,ageMonths:11,date:''},
      {id:'l3',skill:'Says 3-5 words',achieved:false,ageMonths:15,date:''},
      {id:'l4',skill:'Points to named objects',achieved:false,ageMonths:18,date:''},
      {id:'l5',skill:'Uses 2-word phrases',achieved:false,ageMonths:24,date:''},
      {id:'l6',skill:'Speaks in sentences',achieved:false,ageMonths:36,date:''}
    ],
    social:[
      {id:'s1',skill:'Smiles at people',achieved:true,ageMonths:2,date:'2025-09-09'},
      {id:'s2',skill:'Plays peek-a-boo',achieved:false,ageMonths:9,date:''},
      {id:'s3',skill:'Waves bye-bye',achieved:false,ageMonths:10,date:''},
      {id:'s4',skill:'Shows affection to familiar people',achieved:false,ageMonths:12,date:''},
      {id:'s5',skill:'Plays alongside other children',achieved:false,ageMonths:24,date:''},
      {id:'s6',skill:'Takes turns in games',achieved:false,ageMonths:36,date:''}
    ],
    cognitive:[
      {id:'c1',skill:'Looks at things when you point',achieved:false,ageMonths:12,date:''},
      {id:'c2',skill:'Finds hidden objects',achieved:false,ageMonths:15,date:''},
      {id:'c3',skill:'Knows names of familiar people',achieved:false,ageMonths:18,date:''},
      {id:'c4',skill:'Sorts shapes and colors',achieved:false,ageMonths:24,date:''},
      {id:'c5',skill:'Counts to 10',achieved:false,ageMonths:48,date:''}
    ]
  },
  health:[
    {id:1,date:'2025-07-09',type:'Birth',notes:'Born healthy, 3.4kg, 50cm',weight:3.4,height:50},
    {id:2,date:'2025-07-23',type:'Check-up',notes:'2-week check - all good',weight:3.8,height:52},
    {id:3,date:'2025-10-09',type:'Check-up',notes:'3-month development check - meeting milestones',weight:6.2,height:61},
    {id:4,date:'2025-12-09',type:'Check-up',notes:'5-month check - rolling over, very alert',weight:7.0,height:65}
  ]
};

const createDefaultData=()=>({
  goals:defaultGoals,
  benefits:defaultBenefits,
  budget:defaultBudget,
  completedTasks:{},
  lastReset:new Date().toDateString(),
  milestones:defaultMilestones,
  notes:[],
  events:{},
  madison:defaultMadisonData,
  familyFriends:familyAndFriends,
  socialLog:[],
  bills:defaultBills,
  subscriptions:defaultSubscriptions,
  savingsGoals:defaultSavingsGoals,
  expenseLog:defaultExpenseLog,
  gamification:{
    xp:0,
    level:1,
    streak:0,
    longestStreak:0,
    totalTasksCompleted:0,
    achievements:[],
    dailyXP:{},
    monthlyCompletion:{}
  }
});

const createDefaultConfig=()=>({
  familyName:'Turnbull-Shaw',
  location:'Seaham',
  targetLocation:'Sheffield',
  moveDate:'2026-07-01',
  startDate:'2025-12-04',
  shawnieReturnDate:'2026-07-01',
  shawnieBirthDate:'1992-01-11',
  richBirthDate:'1990-12-16',
  madisonBirthDate:'2025-07-09',
  richPension:72766.58,
  shawniePension:0,
  emergencyFund:0,
  houseDeposit:0
});

const App=()=>{
  const[tab,setTab]=useState('overview');
  const[data,setData]=useState(createDefaultData);
  const[config,setConfig]=useState(createDefaultConfig);
  const[darkMode,setDarkMode]=useState(()=>localStorage.getItem('darkMode')==='true');
  const[selectedDate,setSelectedDate]=useState(new Date());
  const[expandedGoals,setExpandedGoals]=useState({});
  const[showCelebration,setShowCelebration]=useState(false);
  const[celebrationText,setCelebrationText]=useState('');
  const[showAchievement,setShowAchievement]=useState(false);
  const[achievementText,setAchievementText]=useState('');
  const[showNoteModal,setShowNoteModal]=useState(false);
  const[showEventModal,setShowEventModal]=useState(false);
  const[noteText,setNoteText]=useState('');
  const[eventForm,setEventForm]=useState({time:'',title:'',desc:'',who:''});
  const[searchTerm,setSearchTerm]=useState('');
  const[searchResults,setSearchResults]=useState({goals:[],notes:[],benefits:[]});
  const[showGrowthModal,setShowGrowthModal]=useState(false);
  const[showHealthModal,setShowHealthModal]=useState(false);
  const[isOnline,setIsOnline]=useState(navigator.onLine);
  const[dataHistory,setDataHistory]=useState([]);
  const[personFilter,setPersonFilter]=useState('All');
  const[priorityFilter,setPriorityFilter]=useState('All');
  const[weather,setWeather]=useState(null);
  const[showGratitudeModal,setShowGratitudeModal]=useState(false);
  const[gratitudeText,setGratitudeText]=useState('');
  const[smartSuggestions,setSmartSuggestions]=useState([]);
  const[personalizedRecs,setPersonalizedRecs]=useState([]);
  const[showSuggestionsPanel,setShowSuggestionsPanel]=useState(true);
  const[growthForm,setGrowthForm]=useState({height:'',weight:'',headCirc:'',notes:''});
  const[healthForm,setHealthForm]=useState({type:'Check-up',notes:'',weight:'',height:''});
  const[madisonTab,setMadisonTab]=useState('overview');
  
  // Phase 13: PWA Features
  const[deferredPrompt,setDeferredPrompt]=useState(null);
  const[showInstallPrompt,setShowInstallPrompt]=useState(false);
  const[isInstalled,setIsInstalled]=useState(false);

  useEffect(()=>{
    try{
      const savedData=JSON.parse(localStorage.getItem('familyHubV12Data')||'null');
      const savedConfig=JSON.parse(localStorage.getItem('familyHubV12Config')||'null');
      if(savedData)setData({...createDefaultData(),...savedData});
      if(savedConfig)setConfig({...createDefaultConfig(),...savedConfig});
    }catch(e){
      console.error('Failed to load saved data:',e);
      alert('Error loading saved data. Starting fresh.');
    }
  },[]);

  // Auto-save with debouncing for performance
  useEffect(()=>{
    const timer=setTimeout(()=>{
      try{
        localStorage.setItem('familyHubV12Data',JSON.stringify(data));
      }catch(e){
        console.error('Failed to save data:',e);
        if(e.name==='QuotaExceededError')alert('Storage full! Clear old photos in Settings.');
      }
    },500);
    return()=>clearTimeout(timer);
  },[data]);
  
  useEffect(()=>{
    try{
      localStorage.setItem('familyHubV12Config',JSON.stringify(config));
    }catch(e){
      console.error('Failed to save config:',e);
    }
  },[config]);

  useEffect(()=>{
    const today=new Date().toDateString();
    if(data.lastReset!==today){
      const newCompleted={...data.completedTasks};
      Object.keys(newCompleted).forEach(key=>{if(key.startsWith('daily-'))delete newCompleted[key]});
      setData(prev=>({...prev,completedTasks:newCompleted,lastReset:today}));
    }
  },[]);
  
  useEffect(()=>{
    const handleKeyDown=(e)=>{
      // Ctrl/Cmd+S to force save
      if((e.ctrlKey||e.metaKey)&&e.key==='s'){
        e.preventDefault();
        try{
          localStorage.setItem('familyHubV12Data',JSON.stringify(data));
          localStorage.setItem('familyHubV12Config',JSON.stringify(config));
          celebrate('üíæ Manually saved!');
        }catch(err){
          console.error('Save failed:',err);
          alert('Save failed! ' + err.message);
        }
        return;
      }
      
      // Ctrl+K or Cmd+K to focus search
      if((e.ctrlKey||e.metaKey)&&e.key==='k'){
        e.preventDefault();
        const searchInput=document.querySelector('input[placeholder*="Search"]');
        if(searchInput)searchInput.focus();
        return;
      }
      
      // / key to focus search (like GitHub)
      if(e.key==='/'&&!['INPUT','TEXTAREA'].includes(e.target.tagName)){
        e.preventDefault();
        const searchInput=document.querySelector('input[placeholder*="Search"]');
        if(searchInput)searchInput.focus();
        return;
      }
      
      // Escape to close modals
      if(e.key==='Escape'){
        if(showNoteModal)setShowNoteModal(false);
        if(showEventModal)setShowEventModal(false);
      }
      
      // Arrow keys for calendar navigation
      if(e.key==='ArrowLeft'&&tab==='calendar'){
        const d=new Date(selectedDate);
        d.setDate(d.getDate()-1);
        setSelectedDate(d);
      }
      if(e.key==='ArrowRight'&&tab==='calendar'){
        const d=new Date(selectedDate);
        d.setDate(d.getDate()+1);
        setSelectedDate(d);
      }
      
      // Tab switching shortcuts (Ctrl+1-9)
      if(e.ctrlKey&&e.key>='1'&&e.key<='9'){
        e.preventDefault();
        const tabs=['overview','calendar','budget','madison','month','memories','week','stretch','settings'];
        const idx=parseInt(e.key)-1;
        if(tabs[idx])setTab(tabs[idx]);
      }
    };
    window.addEventListener('keydown',handleKeyDown);
    return()=>window.removeEventListener('keydown',handleKeyDown);
},[showNoteModal,showEventModal,tab,selectedDate,data,config]);
  
  useEffect(()=>{
    localStorage.setItem('darkMode',darkMode);
    document.body.classList.toggle('dark',darkMode);
  },[darkMode]);
  
  // Phase 1: Offline detection
  useEffect(()=>{
    const handleOnline=()=>{
      setIsOnline(true);
      celebrate('‚úÖ Back online!');
    };
    const handleOffline=()=>{
      setIsOnline(false);
      celebrate('‚ö†Ô∏è Offline mode - changes will sync when reconnected');
    };
    window.addEventListener('online',handleOnline);
    window.addEventListener('offline',handleOffline);
    return()=>{
      window.removeEventListener('online',handleOnline);
      window.removeEventListener('offline',handleOffline);
    };
  },[]);
  
  // Phase 5: Fetch weather on load and daily
  useEffect(()=>{
    fetchWeather();
    const interval=setInterval(fetchWeather,3600000); // Update every hour
    return()=>clearInterval(interval);
  },[]);
  
  // Phase 7: Update smart suggestions every minute
  useEffect(()=>{
    const updateSuggestions=()=>{
      const suggestions=generateSmartSuggestions(data,config);
      setSmartSuggestions(suggestions);
      
      const recommendations=getPersonalizedRecommendations(data,config);
      setPersonalizedRecs(recommendations);
    };
    
    updateSuggestions();
    const interval=setInterval(updateSuggestions,60000); // Update every minute
    return()=>clearInterval(interval);
  },[data,config]);
  
  // Phase 13: PWA Installation
  useEffect(()=>{
    // Check if already installed
    if(window.matchMedia('(display-mode: standalone)').matches){
      setIsInstalled(true);
      return;
    }
    
    // Listen for install prompt
    const handleBeforeInstall=(e)=>{
      e.preventDefault();
      setDeferredPrompt(e);
      setShowInstallPrompt(true);
    };
    
    window.addEventListener('beforeinstallprompt',handleBeforeInstall);
    
    // Listen for successful install
    window.addEventListener('appinstalled',()=>{
      setIsInstalled(true);
      setShowInstallPrompt(false);
      celebrate('üéâ App installed successfully!');
    });
    
    return()=>window.removeEventListener('beforeinstallprompt',handleBeforeInstall);
  },[]);
  
  // Phase 13: Service Worker Registration
  useEffect(()=>{

  },[]);
  
  const handleInstallClick=async()=>{
    if(!deferredPrompt)return;
    
    deferredPrompt.prompt();
    const {outcome}=await deferredPrompt.userChoice;
    
    if(outcome==='accepted'){
      setShowInstallPrompt(false);
    }
    
    setDeferredPrompt(null);
  };
  
  useEffect(()=>{
    const checkStreak=()=>{
      const today=new Date().toDateString();
      const dateKey=new Date().toISOString().split('T')[0];
      
      const allTaskCategories=['family','house','meals','goals','selfCare'];
      let totalTodayTasks=0;
      allTaskCategories.forEach(cat=>{
        if(tailoredDailyTasks[cat]){
          totalTodayTasks+=tailoredDailyTasks[cat].length;
        }
      });
      
      const completedTodayTasks=Object.keys(data.completedTasks).filter(key=>
        key.includes(dateKey)&&data.completedTasks[key]
      ).length;
      
      const completionRate=totalTodayTasks>0?completedTodayTasks/totalTodayTasks:0;
      
      if(completionRate>=0.8&&data.lastReset===today){
        const newStreak=(data.gamification?.streak||0)+1;
        const longestStreak=Math.max(newStreak,data.gamification?.longestStreak||0);
        
        setData(prev=>({
          ...prev,
          gamification:{
            ...prev.gamification,
            streak:newStreak,
            longestStreak:longestStreak
          }
        }));
        
        if(newStreak===7){
          setAchievementText('üî• WEEK WARRIOR! 7 Day Streak!');
          setShowAchievement(true);
          setTimeout(()=>setShowAchievement(false),3000);
        }
      }
    };
    
    const timer=setTimeout(checkStreak,1000);
    return()=>clearTimeout(timer);
  },[data.completedTasks,data.lastReset,data.gamification]);
  
const celebrate=(text='üéâ Done!')=>{setCelebrationText(text);setShowCelebration(true);setTimeout(()=>setShowCelebration(false),1500)};

// Phase 1: Madison age calculator
const getMadisonAge=()=>{
  const birth=new Date(config.madisonBirthDate);
  const today=new Date();
  const totalDays=Math.floor((today-birth)/(1000*60*60*24));
  const months=Math.floor(totalDays/30.44);
  const days=totalDays%30;
  return {months,days,totalDays,weeks:Math.floor(totalDays/7)};
};

// Phase 5: Weather fetching
const fetchWeather=async()=>{
  try{
    const res=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=54.84&longitude=-1.29&current_weather=true&timezone=Europe/London`);
    const data=await res.json();
    const temp=Math.round(data.current_weather.temperature);
    const weatherCode=data.current_weather.weathercode;
    
    let condition='Clear';
    let advice='';
    let icon='‚òÄÔ∏è';
    
    if(weatherCode===0){condition='Clear';icon='‚òÄÔ∏è';advice='Perfect day for a walk with Madison!'}
    else if(weatherCode<=3){condition='Cloudy';icon='‚òÅÔ∏è';advice='Good weather - take Madison outside'}
    else if(weatherCode<=67){condition='Rainy';icon='üåßÔ∏è';advice='Bring rain cover for pram'}
    else if(weatherCode<=77){condition='Snow';icon='‚ùÑÔ∏è';advice='Bundle up Madison - it\'s cold!'}
    else{condition='Stormy';icon='‚õàÔ∏è';advice='Stay indoors today'}
    
    if(temp<5){advice='üß• Very cold - extra layers for Madison!'}
    else if(temp>25){advice='‚òÄÔ∏è Warm day - sun cream for Madison!'}
    
    setWeather({temp,condition,icon,advice});
  }catch(e){
    console.error('Weather fetch failed:',e);
  }
};

// Phase 5: Check if Shawnie has returned to work
const shawnieHasReturned=()=>new Date()>=new Date(config.shawnieReturnDate);

// Phase 5: Filter tasks by person and priority
const filterTasks=(tasks)=>{
  return tasks.filter(t=>{
    if(!shawnieHasReturned()&&t.person==='Shawnie')return false;
    if(personFilter!=='All'&&t.person!==personFilter)return false;
    if(priorityFilter!=='All'&&t.priority!==priorityFilter)return false;
    return true;
  });
};

// Phase 7: Smart Automation & Suggestions
const analyzeTaskPatterns=(completedTasks)=>{
  const patterns={
    mostProductiveHour:null,
    averageTasksPerDay:0,
    completionStreak:0,
    favoriteCategory:null,
    timeOfDayStats:{}
  };
  
  // Analyze completion times
  const taskTimes={};
  Object.keys(completedTasks).forEach(key=>{
    const hour=new Date().getHours();
    taskTimes[hour]=(taskTimes[hour]||0)+1;
  });
  
  // Find most productive hour
  let maxCount=0;
  Object.entries(taskTimes).forEach(([hour,count])=>{
    if(count>maxCount){
      maxCount=count;
      patterns.mostProductiveHour=hour;
    }
  });
  
  return patterns;
};

const generateSmartSuggestions=(data,config)=>{
  const suggestions=[];
  const now=new Date();
  const hour=now.getHours();
  
  // Morning suggestions (6-9am)
  if(hour>=6&&hour<9){
    if(!data.completedTasks[`madison-${now.toDateString()}-Wake & change Madison`]){
      suggestions.push({type:'task',priority:'critical',text:'Time to wake Madison!',icon:'üë∂',action:'madison-routine'});
    }
  }
  
  // Breakfast time (8-10am)
  if(hour>=8&&hour<10){
    if(!data.completedTasks[`meal-${now.toDateString()}-Family breakfast`]){
      suggestions.push({type:'task',priority:'high',text:'Don\'t forget breakfast!',icon:'üç≥',action:'meal-breakfast'});
    }
  }
  
  // Financial check reminder (evening)
  if(hour>=20&&hour<22){
    if(!data.completedTasks[`goal-${now.toDateString()}-Check bank balance & upcoming bills`]){
      suggestions.push({type:'task',priority:'high',text:'Check today\'s finances',icon:'üí∞',action:'finance-check'});
    }
  }
  
  // Bill due soon
  (data.bills||[]).forEach(bill=>{
    const dueDay=typeof bill.dueDate==='number'?bill.dueDate:new Date(bill.dueDate).getDate();
    const dueDate=new Date(now.getFullYear(),now.getMonth(),dueDay);
    const daysUntil=Math.ceil((dueDate-now)/(1000*60*60*24));
    
    if(daysUntil>=0&&daysUntil<=3&&!bill.autoDebit){
      suggestions.push({type:'bill',priority:'critical',text:`${bill.name} due in ${daysUntil} days!`,icon:'üí∏',action:'pay-bill',billId:bill.id});
    }
  });
  
  // Savings goal suggestion
  if(now.getDate()===1){
    suggestions.push({type:'savings',priority:'medium',text:'Start of month - update savings goals!',icon:'üí∞',action:'update-savings'});
  }
  
  // Madison milestone check
  const madisonAge=getMadisonAge();
  if(madisonAge.months===6&&!data.milestones.find(m=>m.id==='first-unassisted-sit'&&m.achieved)){
    suggestions.push({type:'milestone',priority:'medium',text:'Madison might be sitting soon - watch for it!',icon:'ü™ë',action:'milestone-check'});
  }
  
  // Gratitude reminder
  const gratitudeToday=data.notes?.some(n=>n.type==='gratitude'&&new Date(n.date).toDateString()===now.toDateString());
  if(hour>=21&&!gratitudeToday){
    suggestions.push({type:'wellbeing',priority:'low',text:'Take a moment for gratitude',icon:'‚ú®',action:'gratitude'});
  }
  
  return suggestions;
};

const getPersonalizedRecommendations=(data,config)=>{
  const recommendations=[];
  
  // Calculate stats
  const totalIncome=Object.values(data.budget.income).reduce((sum,val)=>sum+(val||0),0);
  const totalExpenses=Object.values(data.budget.expenses).reduce((sum,val)=>sum+(val||0),0);
  const monthlyLeftover=totalIncome-totalExpenses;
  
  // Financial recommendations
  if(monthlyLeftover<0){
    recommendations.push({
      category:'finance',
      priority:'critical',
      title:'Monthly Shortfall Detected',
      description:`You're ¬£${Math.abs(monthlyLeftover)} short each month until Shawnie returns`,
      action:'Review expenses & find cuts',
      icon:'‚ö†Ô∏è'
    });
  }
  
  if((data.subscriptions||[]).length>5){
    const totalSubCost=(data.subscriptions||[]).reduce((sum,s)=>sum+(s.billing==='monthly'?s.cost:s.cost/12),0);
    if(totalSubCost>50){
      recommendations.push({
        category:'finance',
        priority:'medium',
        title:'Subscription Review',
        description:`You're spending ¬£${totalSubCost.toFixed(2)}/month on ${data.subscriptions.length} subscriptions`,
        action:'Cancel unused subscriptions',
        icon:'üì±'
      });
    }
  }
  
  if((config.emergencyFund||0)<500){
    recommendations.push({
      category:'savings',
      priority:'high',
      title:'Build Emergency Fund',
      description:'Start with ¬£500 mini emergency fund',
      action:'Save ¬£50/month = ¬£500 in 10 months',
      icon:'üõ°Ô∏è'
    });
  }
  
  // Madison recommendations
  const madisonAge=getMadisonAge();
  if(madisonAge.months>=6){
    recommendations.push({
      category:'madison',
      priority:'medium',
      title:'Start Weaning Process',
      description:'Madison is ready for solid foods',
      action:'Introduce purees gradually',
      icon:'ü•Ñ'
    });
  }
  
  if(madisonAge.months>=9){
    const hasChildcare=data.budget.expenses.childcare>0;
    if(!hasChildcare){
      recommendations.push({
        category:'madison',
        priority:'high',
        title:'Research Childcare',
        description:'Shawnie returns soon - book childcare place',
        action:'Apply for childcare & Tax-Free Childcare account',
        icon:'üè´'
      });
    }
  }
  
  // Career recommendations
  if(!shawnieHasReturned()){
    const monthsUntilReturn=Math.ceil((new Date(config.shawnieReturnDate)-new Date())/(1000*60*60*24*30));
    if(monthsUntilReturn<=3){
      recommendations.push({
        category:'career',
        priority:'high',
        title:'Prepare for Shawnie\'s Return',
        description:`${monthsUntilReturn} months until return to work`,
        action:'Confirm childcare & work arrangements',
        icon:'üíº'
      });
    }
  }
  
  // Sheffield move
  const monthsUntilMove=Math.ceil((new Date(config.moveDate)-new Date())/(1000*60*60*24*30));
  if(monthsUntilMove<=6&&monthsUntilMove>0){
    recommendations.push({
      category:'move',
      priority:'critical',
      title:'Sheffield Move Approaching',
      description:`${monthsUntilMove} months until move`,
      action:'Start viewing properties & planning move',
      icon:'üèòÔ∏è'
    });
  }
  
  return recommendations;
};
  
  const calculateXP=(taskKey,taskXP=5)=>{
    const newXP=(data.gamification?.xp||0)+taskXP;
    const newLevel=Math.floor(newXP/100)+1;
    const oldLevel=data.gamification?.level||1;
    
    setData(prev=>({
      ...prev,
      gamification:{
        ...prev.gamification,
        xp:newXP,
        level:newLevel,
        totalTasksCompleted:(prev.gamification?.totalTasksCompleted||0)+1,
        dailyXP:{
          ...prev.gamification?.dailyXP,
          [new Date().toISOString().split('T')[0]]:(prev.gamification?.dailyXP?.[new Date().toISOString().split('T')[0]]||0)+taskXP
        }
      }
    }));
    
    if(newLevel>oldLevel){
      setAchievementText(`üéâ LEVEL ${newLevel}!`);
      setShowAchievement(true);
      setTimeout(()=>setShowAchievement(false),3000);
    }
    
    celebrate(`+${taskXP} XP!`);
  };
  const toggleTask=useCallback((taskKey,taskXP=5)=>{
    const wasCompleted=data.completedTasks[taskKey];
    if(!wasCompleted){
      calculateXP(taskKey,taskXP);
      
      // Phase 7: Smart suggestions after task completion
      const taskName=taskKey.split('-').slice(2).join('-');
      
      // Auto-suggest related tasks
      if(taskName.includes('Madison breakfast')){
        setTimeout(()=>{
          if(!data.completedTasks[taskKey.replace('breakfast','Tummy time')]){
            celebrate('üí° Time for tummy time soon!');
          }
        },1000);
      }
      
      if(taskName.includes('Wake & change Madison')){
        setTimeout(()=>{
          if(!data.completedTasks[taskKey.replace('Wake & change','breakfast')]){
            celebrate('üçº Don\'t forget Madison\'s breakfast!');
          }
        },1500);
      }
      
      if(taskName.includes('Bath time')){
        setTimeout(()=>{
          if(!data.completedTasks[taskKey.replace('Bath','Bedtime routine')]){
            celebrate('üìñ Bedtime routine next!');
          }
        },1000);
      }
    }
    setData(prev=>({...prev,completedTasks:{...prev.completedTasks,[taskKey]:!wasCompleted}}));
  },[data.completedTasks,calculateXP]);

const toggleGoalStep=useCallback((goalId,stepId)=>{
  const goal=data.goals.find(g=>g.id===goalId);
  const step=goal?.steps.find(s=>s.id===stepId);
  if(step&&!step.done)celebrate('üéØ Progress!');
  setData(prev=>({...prev,goals:prev.goals.map(g=>g.id===goalId?{...g,steps:g.steps.map(s=>s.id===stepId?{...s,done:!s.done}:s)}:g)}));
},[data.goals]);

const toggleBenefit=useCallback((id)=>{
  setData(prev=>({...prev,benefits:prev.benefits.map(b=>b.id===id?{...b,claimed:!b.claimed}:b)}));
},[]);

const updateBudget=useCallback((cat,field,val)=>{
  const numVal=Number(val);
  
  // Validation
  if(isNaN(numVal)){
    console.warn('Invalid number input');
    return;
  }
  if(numVal<0){
    alert('Amount cannot be negative');
    return;
  }
  if(numVal>100000){
    if(!confirm(`¬£${numVal.toLocaleString()} seems unusually high. Continue?`)){
      return;
    }
  }
  
  setData(prev=>({...prev,budget:{...prev.budget,[cat]:{...prev.budget[cat],[field]:numVal}}}));
},[]);

const toggleMilestone=useCallback((id)=>{
  const m=data.milestones.find(ms=>ms.id===id);
  if(m&&!m.achieved){
    let xpValue=50;
    if(id==='first-steps'||id==='first-words')xpValue=150;
    else if(id==='first-birthday')xpValue=500;
    else if(id==='first-crawl')xpValue=100;
    else if(id==='first-tooth')xpValue=75;
    calculateXP(`photo-milestone-${id}`,xpValue);
    celebrate(`üéâ ${xpValue} XP! Milestone!`);
  }
  setData(prev=>({...prev,milestones:prev.milestones.map(ms=>ms.id===id?{...ms,achieved:!ms.achieved}:ms)}));
},[data.milestones,calculateXP]);

const uploadMilestonePhoto=useCallback((id,file)=>{
  // Check file size FIRST
  if(file.size>5*1024*1024){
    alert('Image too large! Please use an image under 5MB.');
    return;
  }
  
  // Check file type
  if(!file.type.startsWith('image/')){
    alert('Please select an image file (JPG, PNG, etc.)');
    return;
  }
  
  const reader=new FileReader();
    reader.onload=(e)=>{
      const img=new Image();
      img.onload=()=>{
        const canvas=document.createElement('canvas');
        let width=img.width;
        let height=img.height;
        const maxSize=800;
        if(width>height&&width>maxSize){
          height*=maxSize/width;
          width=maxSize;
        }else if(height>maxSize){
          width*=maxSize/height;
          height=maxSize;
        }
        canvas.width=width;
        canvas.height=height;
        const ctx=canvas.getContext('2d');
        ctx.drawImage(img,0,0,width,height);
        const compressed=canvas.toDataURL('image/jpeg',0.7);
        if(compressed.length>500*1024){
          alert('Image still too large after compression. Try a smaller photo.');
          return;
        }
        setData(prev=>({...prev,milestones:prev.milestones.map(ms=>ms.id===id?{...ms,photo:compressed}:ms)}));
        checkStorageUsage();
      };
      img.src=e.target.result;
    };
    reader.readAsDataURL(file);
  },[]);

  const checkStorageUsage=()=>{
    try{
      let used=0;
      for(let key in localStorage){
        if(localStorage.hasOwnProperty(key)){
          used+=localStorage[key].length+key.length;
        }
      }
      const limit=5*1024*1024;
      if(used>limit*0.8){
        alert(`Storage ${Math.round((used/limit)*100)}% full - consider clearing old photos in Settings`);
      }
    }catch(e){console.error(e)}
  };

const addNote=useCallback(()=>{
  const trimmed=noteText.trim();
  
  if(!trimmed){
    alert('Please enter some text for your note');
    return;
  }
  
  if(trimmed.length>5000){
    alert('Note is too long (max 5000 characters)');
    return;
  }
  
  const note={id:Date.now(),date:new Date().toISOString(),text:trimmed};
  setData(prev=>({...prev,notes:[note,...prev.notes]}));
  setNoteText('');
  setShowNoteModal(false);
  celebrate('üìù Note Saved!');
},[noteText]);
  const deleteNote=(id)=>{
    setData(prev=>({...prev,notes:prev.notes.filter(n=>n.id!==id)}));
  };

const addEvent=useCallback(()=>{
  // Validation
  if(!eventForm.time){
    alert('Please select a time');
    return;
  }
  if(!eventForm.title.trim()){
    alert('Please enter an event title');
    return;
  }
  
  const dateKey=selectedDate.toISOString().split('T')[0];
  const event={
    id:Date.now(),
    time:eventForm.time,
    title:eventForm.title.trim(),
    desc:eventForm.desc.trim(),
    who:eventForm.who.trim()
  };
  setData(prev=>({...prev,events:{...prev.events,[dateKey]:[...(prev.events[dateKey]||[]),event]}}));
  setEventForm({time:'',title:'',desc:'',who:''});
  setShowEventModal(false);
  celebrate('üìÖ Event Added!');
},[eventForm,selectedDate]);

  const deleteEvent=(dateKey,eventId)=>{
    setData(prev=>({...prev,events:{...prev.events,[dateKey]:prev.events[dateKey].filter(e=>e.id!==eventId)}}));
  };
  const handleSearch=useCallback((term)=>{
  setSearchTerm(term);
  
  if(!term.trim()){
    setSearchResults({goals:[],notes:[],benefits:[]});
    return;
  }
  
  const lower=term.toLowerCase();
  
  // Search goals and steps
  const matchedGoals=data.goals.filter(g=>
    g.title.toLowerCase().includes(lower)||
    g.subtitle.toLowerCase().includes(lower)||
    g.steps.some(s=>s.text.toLowerCase().includes(lower))
  );
  
  // Search notes
  const matchedNotes=data.notes.filter(n=>
    n.text.toLowerCase().includes(lower)
  );
  
  // Search benefits
  const matchedBenefits=data.benefits.filter(b=>
    b.name.toLowerCase().includes(lower)
  );
  
  setSearchResults({
    goals:matchedGoals,
    notes:matchedNotes,
    benefits:matchedBenefits
  });
},[data.goals,data.notes,data.benefits]);

const highlightText=(text,term)=>{
  if(!term)return text;
  const regex=new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&')})`,'gi');
  const parts=text.split(regex);
  return parts.map((part,i)=>
    regex.test(part)?<mark key={i} style={{background:'#fef3c7',padding:'0 2px',borderRadius:'2px'}}>{part}</mark>:part
  );
};

// Madison helper functions
const calculateAge=(birthDate)=>{
  const birth=new Date(birthDate);
  const now=new Date();
  const months=((now.getFullYear()-birth.getFullYear())*12)+(now.getMonth()-birth.getMonth());
  const years=Math.floor(months/12);
  const remainingMonths=months%12;
  return{years,months:remainingMonths,totalMonths:months};
};

const formatAge=(birthDate)=>{
  const{years,months}=calculateAge(birthDate);
  if(years===0)return`${months} month${months!==1?'s':''}`;
  if(months===0)return`${years} year${years!==1?'s':''}`;
  return`${years}y ${months}m`;
};

const addMadisonGrowth=useCallback((height,weight,headCirc,notes)=>{
  const newEntry={
    id:Date.now(),
    date:new Date().toISOString().split('T')[0],
    height:Number(height),
    weight:Number(weight),
    headCirc:Number(headCirc)||null,
    notes:notes.trim()
  };
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      growth:[...prev.madison.growth,newEntry]
    }
  }));
  celebrate('üìè Growth recorded!');
},[]);

const toggleVaccination=useCallback((id)=>{
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      vaccinations:prev.madison.vaccinations.map(v=>
        v.id===id?{...v,completed:!v.completed,date:v.completed?'':new Date().toISOString().split('T')[0]}:v
      )
    }
  }));
  celebrate('üíâ Updated!');
},[]);

const toggleDevMilestone=useCallback((category,id)=>{
  const milestone=data.madison.developmental[category]?.find(m=>m.id===id);
  if(milestone&&!milestone.achieved){
    const xpValue=category==='motor'?75:category==='language'?100:category==='social'?50:60;
    calculateXP(`milestone-${category}-${id}`,xpValue);
    celebrate(`üéâ ${xpValue} XP! Milestone!`);
  }
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      developmental:{
        ...prev.madison.developmental,
        [category]:prev.madison.developmental[category].map(m=>
          m.id===id?{...m,achieved:!m.achieved,date:m.achieved?'':new Date().toISOString().split('T')[0]}:m
        )
      }
    }
  }));
},[data.madison,calculateXP]);

const addHealthNote=useCallback((type,notes,weight,height)=>{
  const newNote={
    id:Date.now(),
    date:new Date().toISOString().split('T')[0],
    type,
    notes:notes.trim(),
    weight:weight?Number(weight):null,
    height:height?Number(height):null
  };
  setData(prev=>({
    ...prev,
    madison:{
      ...prev.madison,
      health:[...prev.madison.health,newNote]
    }
  }));
  celebrate('üè• Note saved!');
},[]);

  const totalIncome=useMemo(()=>Object.values(data.budget.income).reduce((a,b)=>a+b,0),[data.budget.income]);
  const totalExpenses=useMemo(()=>Object.values(data.budget.expenses).reduce((a,b)=>a+b,0),[data.budget.expenses]);
  const totalSavings=useMemo(()=>Object.values(data.budget.savings).reduce((a,b)=>a+b,0),[data.budget.savings]);
  const monthlyLeftover=useMemo(()=>totalIncome-totalExpenses-totalSavings,[totalIncome,totalExpenses,totalSavings]);

  const today=useMemo(()=>new Date(),[]);
  const returnDate=useMemo(()=>new Date(config.shawnieReturnDate),[config.shawnieReturnDate]);
  const daysUntilReturn=useMemo(()=>Math.max(0,Math.ceil((returnDate-today)/(1000*60*60*24))),[returnDate,today]);
  const monthsUntilReturn=useMemo(()=>Math.max(0,Math.ceil((returnDate-today)/(1000*60*60*24*30))),[returnDate,today]);
  const totalGapToBridge=useMemo(()=>monthlyLeftover<0?Math.abs(monthlyLeftover)*monthsUntilReturn:0,[monthlyLeftover,monthsUntilReturn]);

  const goalsProgress=useMemo(()=>{
    let total=0,done=0;
    stretchGoals.forEach(g=>{
      g.milestones.forEach((m,idx)=>{
        total++;
        const key=`stretch-${g.id}-${idx}`;
        if(data.completedTasks[key])done++;
      });
    });
    return{total,done,pct:total?Math.round((done/total)*100):0};
  },[data.completedTasks]);

  const potentialSavings=data.benefits.filter(b=>!b.claimed&&b.saving).reduce((sum,b)=>sum+(b.saving||0),0);
  const totalSaved=config.emergencyFund+config.houseDeposit;

  const getWeekDates=()=>{
    const start=new Date(selectedDate);
    const day=start.getDay();
    start.setDate(start.getDate()-day+(day===0?-6:1));
    return Array.from({length:7},(_,i)=>{const d=new Date(start);d.setDate(start.getDate()+i);return d});
  };
  const weekDates=getWeekDates();
  const dayOfWeek=selectedDate.getDay();
  const dayMeals=weeklyMeals[dayOfWeek]||{breakfast:{name:"TBD",cost:0,prep:"",cook:""},lunch:{name:"TBD",cost:0,prep:"",cook:""},dinner:{name:"TBD",cost:0,prep:"",cook:""}};
  const dayActivities=weeklyActivities[dayOfWeek]||[];
  const dayWeeklyTasks=dailyTasks.weekly[dayOfWeek]||[];
  const dailyMealCost=(dayMeals.breakfast.cost+dayMeals.lunch.cost+dayMeals.dinner.cost).toFixed(2);
  const dateKey=selectedDate.toISOString().split('T')[0];
  const isToday=(d)=>d.toDateString()===new Date().toDateString();
  const isSelected=(d)=>d.toDateString()===selectedDate.toDateString();
  const dayEvents=data.events[dateKey]||[];

  const currentGoalSteps=useMemo(()=>{
    const now=new Date();
    const steps=[];
    data.goals.forEach(g=>{
      g.steps.filter(s=>!s.done).slice(0,2).forEach(s=>{
        if(s.date.includes('Dec 2025')||s.date.includes('Jan 2026')||s.date.includes('Ongoing')||s.date.includes('2025')){
          steps.push({...s,goalTitle:g.title,goalIcon:g.icon,person:g.person});
        }
      });
    });
    return steps.slice(0,4);
},[data.goals]);

  useEffect(()=>{
    if(tab==='budget'){
      const ctx=document.getElementById('budgetChart');
      if(ctx){
        const existingChart=Chart.getChart(ctx);
        if(existingChart){existingChart.destroy();}
        
        new Chart(ctx,{
          type:'doughnut',
          data:{
            labels:['Income','Expenses','Savings',monthlyLeftover>=0?'Leftover':'Shortfall'],
            datasets:[{
              data:[totalIncome,totalExpenses,totalSavings,Math.abs(monthlyLeftover)],
              backgroundColor:['#81b29a','#dc2626','#f2cc8f',monthlyLeftover>=0?'#3b82f6':'#f59e0b'],
              borderWidth:0
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{
                position:'bottom',
                labels:{
                  font:{family:'DM Sans',size:13},
                  padding:15,
                  color:darkMode?'#f9fafb':'#3d405b'
                }
              },
              tooltip:{
                callbacks:{
                  label:(context)=>{
                    const label=context.label||'';
                    const value=context.parsed||0;
                    return `${label}: ¬£${value}`;
                  }
                }
              }
            }
          }
        });
      }
      
      const savingsCtx=document.getElementById('savingsChart');
      if(savingsCtx){
        const existingChart=Chart.getChart(savingsCtx);
        if(existingChart){existingChart.destroy();}
        
        const months=['Dec 25','Jan 26','Feb 26','Mar 26','Apr 26','May 26','Jun 26','Jul 26','Aug 26','Sep 26','Oct 26','Nov 26','Dec 26'];
        const currentSavings=config.emergencyFund+config.houseDeposit;
        const currentIncome=totalIncome;
        const currentExpenses=totalExpenses;
        const monthlySavingsRate=totalSavings;
        
        const shawnieGrossReturn=40000;
        const shawnieNetReturn=2600;
        const childcareMonthly=640;
        const netGainFromReturn=shawnieNetReturn-childcareMonthly;
        
        const projected=months.map((_,i)=>{
          if(i===0)return currentSavings;
          if(i<7)return currentSavings+(monthlySavingsRate*(i));
          return currentSavings+(monthlySavingsRate*6)+((monthlySavingsRate+netGainFromReturn)*(i-6));
        });
        
        new Chart(savingsCtx,{
          type:'line',
          data:{
            labels:months,
            datasets:[{
              label:'Projected Savings',
              data:projected,
              borderColor:'#10b981',
              backgroundColor:'rgba(16,185,129,0.1)',
              fill:true,
              tension:0.4,
              pointRadius:5,
              pointHoverRadius:7,
              pointBackgroundColor:'#10b981',
              pointBorderColor:'#fff',
              pointBorderWidth:2
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{position:'bottom',labels:{font:{family:'DM Sans',size:13},color:darkMode?'#f9fafb':'#3d405b'}},
              tooltip:{
                callbacks:{
                  label:(context)=>`Savings: ¬£${Math.round(context.parsed.y).toLocaleString()}`
                }
              }
            },
            scales:{
              y:{
                beginAtZero:true,
                ticks:{
                  callback:(value)=>`¬£${(value/1000).toFixed(0)}k`,
                  color:darkMode?'#d1d5db':'#6b7280'
                },
                grid:{color:darkMode?'#374151':'#e5e7eb'}
              },
              x:{
                ticks:{color:darkMode?'#d1d5db':'#6b7280'},
                grid:{display:false}
              }
            }
          }
        });
      }
      
      const pensionCtx=document.getElementById('pensionChart');
      if(pensionCtx){
        const existingChart=Chart.getChart(pensionCtx);
        if(existingChart){existingChart.destroy();}
        
        const years=['2025','2030','2035','2040','2045','2050','2055'];
        const richPension=config.richPension||72766;
        const shawniePension=config.shawniePension||0;
        const growthRate=1.05;
        
        const richProjection=years.map((_,i)=>richPension*Math.pow(growthRate,i*5));
        const shawnieProjection=years.map((_,i)=>shawniePension*Math.pow(growthRate,i*5));
        
        new Chart(pensionCtx,{
          type:'line',
          data:{
            labels:years,
            datasets:[{
              label:'Rich',
              data:richProjection,
              borderColor:'#3b82f6',
              backgroundColor:'rgba(59,130,246,0.1)',
              fill:true,
              tension:0.4
            },{
              label:'Shawnie',
              data:shawnieProjection,
              borderColor:'#d4729b',
              backgroundColor:'rgba(212,114,155,0.1)',
              fill:true,
              tension:0.4
            }]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            plugins:{
              legend:{position:'bottom',labels:{font:{family:'DM Sans',size:13},color:darkMode?'#f9fafb':'#3d405b'}},
              tooltip:{
                callbacks:{
                  label:(context)=>`${context.dataset.label}: ¬£${Math.round(context.parsed.y/1000)}k`
                }
              }
            },
            scales:{
              y:{
                beginAtZero:true,
                ticks:{
                  callback:(value)=>`¬£${(value/1000).toFixed(0)}k`,
                  color:darkMode?'#d1d5db':'#6b7280'
                },
                grid:{color:darkMode?'#374151':'#e5e7eb'}
              },
              x:{
                ticks:{color:darkMode?'#d1d5db':'#6b7280'},
                grid:{display:false}
              }
            }
          }
        });
      }
    }
    
    if(tab==='madison'&&madisonTab==='growth'){
      const ctx=document.getElementById('growthChart');
      if(ctx&&data.madison?.growth){
        const existingChart=Chart.getChart(ctx);
        if(existingChart){existingChart.destroy();}
        
        const sortedGrowth=[...data.madison.growth].sort((a,b)=>new Date(a.date)-new Date(b.date));
        
        new Chart(ctx,{
          type:'line',
          data:{
            labels:sortedGrowth.map(g=>new Date(g.date).toLocaleDateString('en-GB',{month:'short',year:'2-digit'})),
            datasets:[
              {
                label:'Height (cm)',
                data:sortedGrowth.map(g=>g.height),
                borderColor:'#f2a65a',
                backgroundColor:'rgba(242,166,90,0.1)',
                tension:0.4,
                yAxisID:'y'
              },
              {
                label:'Weight (kg)',
                data:sortedGrowth.map(g=>g.weight),
                borderColor:'#81b29a',
                backgroundColor:'rgba(129,178,154,0.1)',
                tension:0.4,
                yAxisID:'y1'
              }
            ]
          },
          options:{
            responsive:true,
            maintainAspectRatio:false,
            interaction:{mode:'index',intersect:false},
            plugins:{
              legend:{position:'top'},
              tooltip:{
                callbacks:{
                  label:(context)=>`${context.dataset.label}: ${context.parsed.y}`
                }
              }
            },
            scales:{
              y:{
                type:'linear',
                display:true,
                position:'left',
                title:{display:true,text:'Height (cm)'},
                beginAtZero:false
              },
              y1:{
                type:'linear',
                display:true,
                position:'right',
                title:{display:true,text:'Weight (kg)'},
                beginAtZero:false,
                grid:{drawOnChartArea:false}
              }
            }
          }
        });
      }
    }
  },[tab,madisonTab,totalIncome,totalExpenses,totalSavings,monthlyLeftover,darkMode,data.madison]);

  const exportData=()=>{    const blob=new Blob([JSON.stringify({config,data,exportDate:new Date().toISOString()},null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;
    a.download=`family-hub-${new Date().toISOString().split('T')[0]}.json`;a.click();
  };

  const importData=(e)=>{
    const file=e.target.files[0];if(!file)return;
    const reader=new FileReader();
    reader.onload=(ev)=>{try{const imp=JSON.parse(ev.target.result);if(imp.config)setConfig(imp.config);if(imp.data)setData(imp.data);alert('Imported!')}catch{alert('Error')}};
    reader.readAsText(file);
  };

  const renderTag=(p)=><span className={`tag tag-${p.toLowerCase()}`}>{p}</span>;

  const incomeLabels={shawnieNet:"Shawnie Net",richNet:"Rich Net",childBenefit:"Child Benefit",universalCredit:"Universal Credit",pip:"PIP",other:"Other"};
  const expenseLabels={rent:"Rent/Mortgage",councilTax:"Council Tax",electric:"Electric",gas:"Gas",water:"Water",broadband:"Broadband",phoneRich:"Phone Rich",phoneShawnie:"Phone Shawnie",carFinance:"Car Finance",carInsurance:"Car Insurance",petrol:"Petrol",groceries:"Groceries",childcare:"Childcare",subscriptions:"Subscriptions",insurance:"Insurance",other:"Other"};
  const savingsLabels={emergency:"Emergency Fund",houseDeposit:"House Deposit",lisaRich:"LISA Rich",lisaShawnie:"LISA Shawnie",madisonJISA:"Madison JISA",pension:"Extra Pension"};

  return(
    <div className="app">
      {/* Phase 13: Offline Indicator */}
      {!isOnline&&<div className="offline-banner">
        ‚ö†Ô∏è OFFLINE MODE - Changes will sync when reconnected
      </div>}
      
      {/* Phase 13: PWA Install Prompt */}
      {showInstallPrompt&&!isInstalled&&<div className="install-prompt">
        <div style={{flex:1}}>
          <div style={{fontWeight:700,marginBottom:'0.25rem'}}>üì± Install Family Hub Pro</div>
          <div style={{fontSize:'0.875rem',color:'var(--text-secondary)'}}>Add to home screen for quick access & offline support</div>
        </div>
        <div style={{display:'flex',gap:'0.5rem'}}>
          <button className="btn btn-secondary btn-sm" onClick={()=>setShowInstallPrompt(false)}>Later</button>
          <button className="btn btn-primary btn-sm" onClick={handleInstallClick}>Install</button>
        </div>
      </div>}
      
      {showCelebration&&<div className="celebration"><div className="celebration-box">{celebrationText}</div></div>}
      {showAchievement&&<div className="achievement-toast">{achievementText}</div>}

      {/* Note Modal */}
      <div className={`modal ${showNoteModal?'show':''}`} onClick={()=>setShowNoteModal(false)} role="dialog" aria-modal="true" aria-labelledby="note-modal-title">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3 id="note-modal-title">Add Family Note</h3><button className="modal-close" onClick={()=>setShowNoteModal(false)} aria-label="Close modal">√ó</button></div>
          <div className="modal-body">
            <textarea className="modal-textarea" value={noteText} onChange={e=>setNoteText(e.target.value)} placeholder="What's on your mind?"/>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowNoteModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={addNote}>Save Note</button>
          </div>
        </div>
      </div>

      {/* Event Modal */}
      <div className={`modal ${showEventModal?'show':''}`} onClick={()=>setShowEventModal(false)} role="dialog" aria-modal="true" aria-labelledby="event-modal-title">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3 id="event-modal-title">Add Event</h3><button className="modal-close" onClick={()=>setShowEventModal(false)} aria-label="Close modal">√ó</button></div>
          <div className="modal-body">
            <div className="form-group"><label className="form-label">Time</label><input type="time" className="form-input" value={eventForm.time} onChange={e=>setEventForm({...eventForm,time:e.target.value})}/></div>
            <div className="form-group"><label className="form-label">Title</label><input type="text" className="form-input" value={eventForm.title} onChange={e=>setEventForm({...eventForm,title:e.target.value})} placeholder="Event name"/></div>
            <div className="form-group"><label className="form-label">Description</label><input type="text" className="form-input" value={eventForm.desc} onChange={e=>setEventForm({...eventForm,desc:e.target.value})} placeholder="Optional"/></div>
            <div className="form-group"><label className="form-label">Who</label><input type="text" className="form-input" value={eventForm.who} onChange={e=>setEventForm({...eventForm,who:e.target.value})} placeholder="Family, Rich, Shawnie..."/></div>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowEventModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={addEvent}>Add Event</button>
          </div>
        </div>
      </div>

      {/* Growth Modal */}
      <div className={`modal ${showGrowthModal?'show':''}`} onClick={()=>setShowGrowthModal(false)} role="dialog" aria-modal="true">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3>Add Growth Entry</h3><button className="modal-close" onClick={()=>setShowGrowthModal(false)}>√ó</button></div>
          <div className="modal-body">
            <div className="form-group"><label className="form-label">Height (cm)</label><input type="number" className="form-input" value={growthForm.height} onChange={e=>setGrowthForm({...growthForm,height:e.target.value})} placeholder="e.g. 76"/></div>
            <div className="form-group"><label className="form-label">Weight (kg)</label><input type="number" step="0.1" className="form-input" value={growthForm.weight} onChange={e=>setGrowthForm({...growthForm,weight:e.target.value})} placeholder="e.g. 10.2"/></div>
            <div className="form-group"><label className="form-label">Head Circumference (cm) - Optional</label><input type="number" className="form-input" value={growthForm.headCirc} onChange={e=>setGrowthForm({...growthForm,headCirc:e.target.value})} placeholder="e.g. 46"/></div>
            <div className="form-group"><label className="form-label">Notes</label><textarea className="modal-textarea" value={growthForm.notes} onChange={e=>setGrowthForm({...growthForm,notes:e.target.value})} placeholder="Any observations..."/></div>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowGrowthModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={()=>{
              if(!growthForm.height||!growthForm.weight){
                alert('Please enter height and weight');
                return;
              }
              addMadisonGrowth(growthForm.height,growthForm.weight,growthForm.headCirc,growthForm.notes);
              setGrowthForm({height:'',weight:'',headCirc:'',notes:''});
              setShowGrowthModal(false);
            }}>Save Entry</button>
          </div>
        </div>
      </div>

      {/* Health Modal */}
      <div className={`modal ${showHealthModal?'show':''}`} onClick={()=>setShowHealthModal(false)} role="dialog" aria-modal="true">
        <div className="modal-content" onClick={e=>e.stopPropagation()}>
          <div className="modal-header"><h3>Add Health Note</h3><button className="modal-close" onClick={()=>setShowHealthModal(false)}>√ó</button></div>
          <div className="modal-body">
            <div className="form-group">
              <label className="form-label">Type</label>
              <select className="form-input" value={healthForm.type} onChange={e=>setHealthForm({...healthForm,type:e.target.value})}>
                <option>Check-up</option>
                <option>Illness</option>
                <option>Vaccination</option>
                <option>Injury</option>
                <option>Appointment</option>
                <option>Other</option>
              </select>
            </div>
            <div className="form-group"><label className="form-label">Notes</label><textarea className="modal-textarea" value={healthForm.notes} onChange={e=>setHealthForm({...healthForm,notes:e.target.value})} placeholder="What happened..."/></div>
            <div className="form-group"><label className="form-label">Weight (kg) - Optional</label><input type="number" step="0.1" className="form-input" value={healthForm.weight} onChange={e=>setHealthForm({...healthForm,weight:e.target.value})} placeholder="e.g. 10.2"/></div>
            <div className="form-group"><label className="form-label">Height (cm) - Optional</label><input type="number" className="form-input" value={healthForm.height} onChange={e=>setHealthForm({...healthForm,height:e.target.value})} placeholder="e.g. 76"/></div>
          </div>
          <div className="modal-footer">
            <button className="btn btn-secondary" onClick={()=>setShowHealthModal(false)}>Cancel</button>
            <button className="btn btn-primary" onClick={()=>{
              if(!healthForm.notes.trim()){
                alert('Please enter notes');
                return;
              }
              addHealthNote(healthForm.type,healthForm.notes,healthForm.weight,healthForm.height);
              setHealthForm({type:'Check-up',notes:'',weight:'',height:''});
              setShowHealthModal(false);
            }}>Save Note</button>
          </div>
        </div>
      </div>

      <header className="header">
        <div className="header-content">
          <div className="logo">
            <div className="logo-icon">üë®‚Äçüë©‚Äçüëß</div>
            <div>
              <div className="logo-title">Family Hub Pro</div>
              <div className="logo-sub">{config.familyName} ‚Ä¢ {config.location}</div>
            </div>
          </div>
          
          <div className="stats-bar">
            <div className="stat-item">
              <span className="stat-icon">‚≠ê</span>
              <span className="stat-value">Lv {data.gamification?.level||1}</span>
            </div>
            <div className="stat-item">
              <span className="stat-icon">üî•</span>
              <span className="stat-value">{data.gamification?.streak||0}d</span>
            </div>
            <div className="stat-item">
              <span className="stat-icon">üí∞</span>
              <span className="stat-value" style={{color:monthlyLeftover<0?'var(--error)':'var(--success)'}}>¬£{monthlyLeftover}</span>
            </div>
            <button className="btn btn-secondary btn-sm" onClick={()=>setDarkMode(!darkMode)} title={darkMode?'Light mode':'Dark mode'}>
              {darkMode?'‚òÄÔ∏è':'üåô'}
            </button>
          </div>
        </div>
      </header>

      {/* Remove old duplicate offline indicator */}
      
      <nav className="nav">
        <div className="nav-inner">
          {[{id:'overview',label:'üè† Overview'},{id:'calendar',label:'üìÖ Daily'},{id:'budget',label:'üí∞ Budget'},{id:'madison',label:'üë∂ Madison'},{id:'stretch',label:'üèÜ Goals'},{id:'memories',label:'üì∏ Memories'},{id:'settings',label:'‚öôÔ∏è Settings'}].map(t=>
            <button key={t.id} className={`nav-tab ${tab===t.id?'active':''}`} onClick={()=>setTab(t.id)}>{t.label}</button>
          )}
        </div>
      </nav>

      <main>
        {/* OVERVIEW TAB */}
        {tab==='overview'&&<>
          <div className="overview-hero">
            <div className="overview-countdown">üéØ Days Until Shawnie Returns to Work</div>
            <div className="overview-days">{daysUntilReturn}</div>
            <div className="overview-label">The countdown is on!</div>
            <div className="overview-date">{returnDate.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</div>
          </div>

          {/* Phase 7: Smart Suggestions Panel */}
          {showSuggestionsPanel&&smartSuggestions.length>0&&<div className="card" style={{background:'linear-gradient(135deg,#f0f9ff,#e0f2fe)',border:'2px solid #0ea5e9'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}>
              <h3 className="card-title" style={{marginBottom:0,color:'#0369a1'}}>ü§ñ Smart Suggestions</h3>
              <button className="btn btn-secondary btn-sm" onClick={()=>setShowSuggestionsPanel(false)}>Dismiss</button>
            </div>
            <div style={{display:'grid',gap:'10px'}}>
              {smartSuggestions.slice(0,5).map((sug,idx)=>(
                <div key={idx} style={{
                  background:'white',
                  padding:'12px',
                  borderRadius:'var(--radius-md)',
                  display:'flex',
                  alignItems:'center',
                  gap:'12px',
                  borderLeft:`4px solid ${sug.priority==='critical'?'var(--critical)':sug.priority==='high'?'var(--high)':'var(--medium)'}`
                }}>
                  <div style={{fontSize:'2rem'}}>{sug.icon}</div>
                  <div style={{flex:1}}>
                    <div style={{fontWeight:600,marginBottom:'4px',color:'var(--navy)'}}>{sug.text}</div>
                    <div style={{fontSize:'0.75rem',color:'var(--navy-light)'}}>
                      <span className={`tag tag-${sug.priority}`}>{sug.priority}</span>
                    </div>
                  </div>
                  {sug.action&&<button className="btn btn-primary btn-sm" onClick={()=>{
                    if(sug.action==='madison-routine')setTab('calendar');
                    if(sug.action==='finance-check')setTab('budget');
                    if(sug.action==='gratitude')setShowGratitudeModal(true);
                    if(sug.action==='update-savings')setTab('budget');
                  }}>‚Üí</button>}
                </div>
              ))}
            </div>
            <div style={{fontSize:'0.75rem',color:'#0369a1',marginTop:'8px',textAlign:'center'}}>
              üí° Suggestions update automatically based on time, tasks, and patterns
            </div>
          </div>}

          {/* Phase 7: Personalized Recommendations */}
          {personalizedRecs.length>0&&<div className="card" style={{background:'linear-gradient(135deg,#fef3c7,#fde68a)',border:'2px solid #f59e0b'}}>
            <h3 className="card-title" style={{color:'#92400e'}}>üí° Personalized Recommendations</h3>
            <div style={{display:'grid',gap:'12px'}}>
              {personalizedRecs.map((rec,idx)=>(
                <div key={idx} style={{
                  background:'white',
                  padding:'14px',
                  borderRadius:'var(--radius-md)',
                  borderLeft:`4px solid ${rec.priority==='critical'?'var(--critical)':rec.priority==='high'?'var(--high)':'var(--medium)'}`
                }}>
                  <div style={{display:'flex',alignItems:'flex-start',gap:'12px',marginBottom:'8px'}}>
                    <div style={{fontSize:'2rem'}}>{rec.icon}</div>
                    <div style={{flex:1}}>
                      <div style={{fontWeight:700,marginBottom:'4px',color:'var(--navy)'}}>{rec.title}</div>
                      <div style={{fontSize:'0.85rem',color:'var(--navy-light)',marginBottom:'8px'}}>{rec.description}</div>
                      <div style={{fontSize:'0.85rem',background:'var(--cream)',padding:'8px',borderRadius:'var(--radius-sm)',fontWeight:600}}>
                        ‚úì {rec.action}
                      </div>
                    </div>
                    <span className={`tag tag-${rec.priority}`}>{rec.priority}</span>
                  </div>
                  <div style={{fontSize:'0.7rem',color:'var(--navy-light)',textTransform:'uppercase',fontWeight:600}}>
                    {rec.category}
                  </div>
                </div>
              ))}
            </div>
          </div>}

          <div className="overview-grid">
            <div className="overview-card income"><div className="overview-card-icon">üíö</div><div className="overview-card-value">¬£{totalIncome}</div><div className="overview-card-label">Monthly Income</div></div>
            <div className="overview-card expense"><div className="overview-card-icon">üí∏</div><div className="overview-card-value">¬£{totalExpenses}</div><div className="overview-card-label">Monthly Expenses</div></div>
            <div className="overview-card gap"><div className="overview-card-icon">{monthlyLeftover>=0?'‚ú®':'‚ö†Ô∏è'}</div><div className="overview-card-value" style={{color:monthlyLeftover>=0?'var(--sage)':'var(--critical)'}}>¬£{monthlyLeftover}</div><div className="overview-card-label">Monthly Leftover</div></div>
            <div className="overview-card goals"><div className="overview-card-icon">üèÜ</div><div className="overview-card-value">{goalsProgress.pct}%</div><div className="overview-card-label">Stretch Goals</div></div>
            <div className="overview-card savings"><div className="overview-card-icon">üíé</div><div className="overview-card-value">¬£{totalSaved.toLocaleString()}</div><div className="overview-card-label">Total Saved</div></div>
            <div className="overview-card pension"><div className="overview-card-icon">üë¥</div><div className="overview-card-value">¬£{Math.round(config.richPension/1000)}k</div><div className="overview-card-label">Pension</div></div>
          </div>

          <div className="card">
            <h3 className="card-title"><span className="card-icon">üìä</span>Progress</h3>
            <div className="progress-section">
              <div className="progress-title"><span>Stretch Goals Progress</span><span>{goalsProgress.done}/{goalsProgress.total}</span></div>
              <div className="progress-bar"><div className="progress-fill goals" style={{width:`${goalsProgress.pct}%`}}/></div>
            </div>
            {config.houseDeposit>0&&<div className="progress-section">
              <div className="progress-title"><span>House Deposit</span><span>¬£{config.houseDeposit.toLocaleString()} / ¬£25,000</span></div>
              <div className="progress-bar"><div className="progress-fill savings" style={{width:`${Math.min(100,(config.houseDeposit/25000)*100)}%`}}/></div>
            </div>}
          </div>

          <div className="card">
            <h3 className="card-title"><span className="card-icon">üöÄ</span>Your Journey</h3>
            <div className="timeline-item"><div className="timeline-dot current"/><div className="timeline-content"><div className="timeline-title">Now - Building foundations</div><div className="timeline-date">Benefits period ‚Ä¢ ¬£{totalIncome}/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">July 2026 - Shawnie returns</div><div className="timeline-date">Band 6 PIP Assessor</div><div className="timeline-amount">+¬£2,600/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">Sep 2026 - Rich starts apprenticeship</div><div className="timeline-date">Electrical training begins</div><div className="timeline-amount">+¬£1,000/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">2027 - Shawnie Band 7</div><div className="timeline-date">Senior position (~¬£50k)</div><div className="timeline-amount">+¬£400/mo</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">2028 - Rich Qualified</div><div className="timeline-date">JIB Gold Card ‚Ä¢ ¬£40k+</div><div className="timeline-amount">Combined ¬£90k+</div></div></div>
            <div className="timeline-item"><div className="timeline-dot future"/><div className="timeline-content"><div className="timeline-title">2029-30 - Homeowners!</div><div className="timeline-date">Sheffield property purchase</div><div className="timeline-amount">Target ¬£95k+</div></div></div>
          </div>

          {potentialSavings>0&&<div className="tip-box">üí° <strong>Unclaimed benefit:</strong> Social broadband could save ¬£{Math.round(potentialSavings/12)}/month. <button className="btn btn-sm btn-secondary" onClick={()=>setTab('benefits')}>Check Benefits ‚Üí</button></div>}

          <div className="card">
            <h3 className="card-title"><span className="card-icon">‚ö°</span>Next Actions</h3>
            {currentGoalSteps.map((s,i)=>(
              <div key={i} className="goal-focus">
                <div className="goal-focus-title">{s.goalIcon} {s.goalTitle}</div>
                <div className="goal-focus-text">{s.text}</div>
                {s.time&&<div className="goal-focus-time">‚è±Ô∏è {s.time} ‚Ä¢ {renderTag(s.person)}</div>}
              </div>
            ))}
            <button className="btn btn-primary" onClick={()=>setTab('goals')}>View All Goals ‚Üí</button>
          </div>
        </>}

        {/* DAILY PLAN TAB - INTEGRATED CALENDAR & GOALS */}
        {tab==='calendar'&&<>
          <div className="week-nav">
            <button className="btn btn-secondary btn-sm" onClick={()=>{const d=new Date(selectedDate);d.setDate(d.getDate()-7);setSelectedDate(d)}}>‚Üê</button>
            <div className="day-tabs">
              {weekDates.map(d=>(
                <div key={d.toISOString()} className={`day-tab ${isSelected(d)?'active':''} ${isToday(d)?'today':''}`} onClick={()=>setSelectedDate(d)}>
                  <div className="day-name">{d.toLocaleDateString('en-GB',{weekday:'short'})}</div>
                  <div className="day-num">{d.getDate()}</div>
                </div>
              ))}
            </div>
            <button className="btn btn-secondary btn-sm" onClick={()=>{const d=new Date(selectedDate);d.setDate(d.getDate()+7);setSelectedDate(d)}}>‚Üí</button>
          </div>

          {/* Phase 5: Weather Card */}
          {weather&&<div className="card" style={{background:`linear-gradient(135deg,rgba(129,178,154,0.1),rgba(242,166,90,0.1))`,border:'2px solid var(--sage)'}}>
            <div style={{display:'flex',alignItems:'center',gap:'16px'}}>
              <div style={{fontSize:'3rem'}}>{weather.icon}</div>
              <div style={{flex:1}}>
                <div style={{fontSize:'1.3rem',fontWeight:700,color:'var(--navy)',marginBottom:'4px'}}>
                  {weather.temp}¬∞C ‚Ä¢ {weather.condition}
                </div>
                <div style={{fontSize:'0.85rem',color:'var(--navy-light)'}}>
                  {weather.advice}
                </div>
              </div>
            </div>
          </div>}

          {/* Phase 5: Task Filters */}
          <div className="card" style={{padding:'12px'}}>
            <div style={{display:'flex',gap:'10px',flexWrap:'wrap',alignItems:'center'}}>
              <div style={{fontSize:'0.85rem',fontWeight:600,color:'var(--navy)'}}>Filter tasks:</div>
              <select className="form-input" value={personFilter} onChange={e=>setPersonFilter(e.target.value)} style={{width:'auto',padding:'6px 12px',fontSize:'0.85rem'}}>
                <option value="All">All People</option>
                <option value="Rich">Rich Only</option>
                <option value="Shawnie">Shawnie Only</option>
                <option value="Both">Both</option>
                <option value="Either">Either</option>
              </select>
              <select className="form-input" value={priorityFilter} onChange={e=>setPriorityFilter(e.target.value)} style={{width:'auto',padding:'6px 12px',fontSize:'0.85rem'}}>
                <option value="All">All Priorities</option>
                <option value="critical">Critical Only</option>
                <option value="high">High Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="low">Low Priority</option>
              </select>
              {(personFilter!=='All'||priorityFilter!=='All')&&<button className="btn btn-secondary btn-sm" onClick={()=>{setPersonFilter('All');setPriorityFilter('All')}}>Clear Filters</button>}
            </div>
          </div>

          {/* Phase 7: Smart Insights */}
          {smartSuggestions.filter(s=>s.type==='task').length>0&&<div className="card" style={{background:'linear-gradient(135deg,#f0fdf4,#dcfce7)',border:'2px solid #22c55e'}}>
            <h3 className="card-title" style={{color:'#15803d'}}>üí° Smart Reminders</h3>
            <div style={{display:'grid',gap:'8px'}}>
              {smartSuggestions.filter(s=>s.type==='task').map((sug,idx)=>(
                <div key={idx} style={{
                  background:'white',
                  padding:'10px',
                  borderRadius:'var(--radius-md)',
                  display:'flex',
                  alignItems:'center',
                  gap:'10px',
                  fontSize:'0.9rem'
                }}>
                  <div style={{fontSize:'1.5rem'}}>{sug.icon}</div>
                  <div style={{flex:1,fontWeight:600}}>{sug.text}</div>
                  <span className={`tag tag-${sug.priority}`} style={{fontSize:'0.7rem'}}>{sug.priority}</span>
                </div>
              ))}
            </div>
          </div>}

          {/* Today's Priority Goals */}
          {currentGoalSteps.length>0&&<div className="card" style={{background:'linear-gradient(135deg,#fdf4ff,#f3e8ff)',border:'2px solid #a855f7'}}>
            <h3 className="card-title" style={{color:'#7c3aed'}}>üéØ Today's Goal Actions</h3>
            {currentGoalSteps.map((s,i)=>(
              <div key={i} className="goal-focus">
                <div className="goal-focus-title">{s.goalIcon} {s.goalTitle}</div>
                <div className="goal-focus-text">{s.text}</div>
                {s.time&&<div className="goal-focus-time">‚è±Ô∏è {s.time} ‚Ä¢ {renderTag(s.person)}</div>}
              </div>
            ))}
            <button className="btn btn-secondary btn-sm" style={{marginTop:'8px'}} onClick={()=>setTab('goals')}>View All Goals ‚Üí</button>
          </div>}

          {/* Events */}
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'16px'}}>
              <h3 className="card-title" style={{marginBottom:0}}>üìÖ {selectedDate.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long'})}</h3>
              <button className="btn btn-primary btn-sm" onClick={()=>setShowEventModal(true)}>+ Event</button>
            </div>
            {dayEvents.length>0&&dayEvents.map(ev=>(
              <div key={ev.id} className="event-card">
                <div className="event-header">
                  <div className="event-time">üïê {ev.time}</div>
                  <button className="event-delete" onClick={()=>deleteEvent(dateKey,ev.id)}>√ó</button>
                </div>
                <div className="event-title">{ev.title}</div>
                {ev.desc&&<div className="event-desc">{ev.desc}</div>}
                {ev.who&&<div className="event-meta">üë• {ev.who}</div>}
              </div>
            ))}
            {dayEvents.length===0&&<div style={{padding:'16px',textAlign:'center',color:'var(--navy-light)',fontSize:'0.85rem'}}>No events scheduled ‚Ä¢ Click + Event to add</div>}
          </div>

          {/* Madison Priority Tasks */}
          <div className="card" style={{background:'linear-gradient(135deg,#fff5f0,#ffe8df)',border:'2px solid var(--madison)'}}>
            <h3 className="card-title" style={{color:'#d97706'}}>üë∂ Madison's Day <span style={{fontSize:'0.8rem',fontWeight:600,color:'#f59e0b',marginLeft:'8px'}}>Total: {filterTasks(tailoredDailyTasks.family).reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {filterTasks(tailoredDailyTasks.family).map((task,i)=>{
              const key=`madison-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Meals */}
          <div className="card">
            <h3 className="card-title">üçΩÔ∏è Today's Meals <span style={{fontSize:'0.8rem',fontWeight:600,color:'var(--gold)',marginLeft:'8px'}}>Total: {filterTasks(tailoredDailyTasks.meals).reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {filterTasks(tailoredDailyTasks.meals).map((task,i)=>{
              const key=`meal-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              const mealData=i===0?dayMeals.breakfast:i===1?dayMeals.lunch:dayMeals.dinner;
              return(
                <div key={i} style={{marginBottom:'12px'}}>
                  <div className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                    <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                    <div className="task-time">{task.exactTime}</div>
                    <div className="task-content" style={{flex:1}}>
                      <div className="task-text">{task.icon} {task.task}</div>
                    </div>
                    {renderTag(task.person)}
                    <div className="time-badge">+{task.xp} XP</div>
                  </div>
                  <div style={{marginLeft:'98px',fontSize:'0.8rem',color:'var(--navy-light)',marginTop:'4px'}}>
                    {mealData.name} ‚Ä¢ ¬£{mealData.cost.toFixed(2)} ‚Ä¢ Prep: {mealData.prep}
                  </div>
                </div>
              );
            })}
            <div className="tip-box" style={{margin:'12px 0 0 0'}}>üí∞ Today's food cost: <strong>¬£{dailyMealCost}</strong> ‚Ä¢ Weekly average: ~¬£45-50</div>
          </div>

          {/* House Tasks */}
          <div className="card">
            <h3 className="card-title">üè† House Tasks <span style={{fontSize:'0.8rem',fontWeight:600,color:'var(--sage)',marginLeft:'8px'}}>Total: {filterTasks(tailoredDailyTasks.house).reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {filterTasks(tailoredDailyTasks.house).map((task,i)=>{
              const key=`house-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Weekly Special Tasks */}
          {weeklySpecialTasks[dayOfWeek]&&weeklySpecialTasks[dayOfWeek].length>0&&<div className="card">
            <h3 className="card-title">‚ú® {['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][dayOfWeek]} Specials</h3>
            {weeklySpecialTasks[dayOfWeek].map((task,i)=>{
              const key=`special-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return<div key={i} className={`task-item ${done?'completed':''}`} onClick={()=>toggleTask(key)}>
                <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                <div className="task-content">
                  <div className="task-text">{task.icon} {task.task}</div>
                  <div className="task-meta">
                    {renderTag(task.person)}
                    <span className="tag tag-high">{task.category}</span>
                  </div>
                </div>
              </div>
            })}
          </div>}

          {/* Goal-Linked Tasks */}
          <div className="card" style={{background:'linear-gradient(135deg,#f0fdf4,#dcfce7)',border:'2px solid var(--sage)'}}>
            <h3 className="card-title" style={{color:'#15803d'}}>üéØ Goal Actions <span style={{fontSize:'0.8rem',fontWeight:600,color:'#059669',marginLeft:'8px'}}>Total: {filterTasks(tailoredDailyTasks.goals).reduce((sum,t)=>sum+t.xp,0)} XP</span></h3>
            {filterTasks(tailoredDailyTasks.goals).map((task,i)=>{
              const shouldShow=task.frequency==='daily'||(task.frequency==='weekly'&&dayOfWeek===1)||(task.frequency==='monthly'&&new Date(selectedDate).getDate()===1);
              if(!shouldShow)return null;
              const key=`goal-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <span className={`tag tag-${task.frequency==='daily'?'medium':'high'}`} style={{fontSize:'0.65rem'}}>{task.frequency}</span>
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Social & Self-Care */}
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}>
              <h3 className="card-title" style={{marginBottom:0}}>üíù Wellbeing</h3>
              <button className="btn btn-primary btn-sm" onClick={()=>setShowGratitudeModal(true)}>‚ú® Gratitude</button>
            </div>
            {(filterTasks(tailoredDailyTasks.social)||[]).map((task,i)=>{
              const shouldShow=task.frequency==='daily'||(task.frequency==='weekly'&&dayOfWeek===0)||(task.frequency==='monthly'&&new Date(selectedDate).getDate()===1);
              if(!shouldShow)return null;
              const key=`social-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
            {filterTasks(tailoredDailyTasks.selfCare).map((task,i)=>{
              const key=`care-${dateKey}-${task.task}`;
              const done=data.completedTasks[key];
              return(
                <div key={i} className={`compact-task ${done?'completed':''}`} onClick={()=>toggleTask(key,task.xp)}>
                  <div className={`task-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                  <div className="task-time">{task.exactTime}</div>
                  <div className="task-content" style={{flex:1}}>
                    <div className="task-text">{task.icon} {task.task}</div>
                  </div>
                  {renderTag(task.person)}
                  <div className="time-badge">+{task.xp} XP</div>
                </div>
              );
            })}
          </div>

          {/* Family & Friends */}
          <div className="card">
            <h3 className="card-title">üë®‚Äçüë©‚Äçüëß Family & Friends</h3>
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(200px,1fr))',gap:'12px'}}>
              {Object.entries(data.familyFriends||familyAndFriends).map(([location,people])=>(
                <div key={location}>
                  <div style={{fontSize:'0.7rem',fontWeight:'600',color:'var(--navy-light)',textTransform:'uppercase',marginBottom:'6px'}}>
                    {location==='sheffield'&&'üèôÔ∏è Sheffield'}
                    {location==='harrogate'&&'üå≥ Harrogate'}
                    {location==='durham'&&'üìç Durham'}
                    {location==='peterlee'&&'üèòÔ∏è Peterlee'}
                    {location==='richFamily'&&'üë® Rich\'s Family'}
                    {location==='shawnieFamily'&&'üë© Shawnie\'s Family'}
                  </div>
                  {people.map(person=>(
                    <div key={person.id} style={{padding:'8px',background:'var(--cream)',borderRadius:'8px',marginBottom:'4px',fontSize:'0.85rem'}}>
                      <div style={{display:'flex',alignItems:'center',gap:'6px'}}>
                        <span>{person.icon}</span>
                        <span style={{fontWeight:'600'}}>{person.names}</span>
                      </div>
                      {person.relation&&<div style={{fontSize:'0.7rem',color:'var(--navy-light)',marginTop:'2px'}}>{person.relation}</div>}
                    </div>
                  ))}
                </div>
              ))}
            </div>
            <div className="tip-box" style={{marginTop:'16px'}}>üí° <strong>Stay connected:</strong> Video calls, visits, messages ‚Ä¢ Building your Sheffield life while keeping family close!</div>
          </div>

          {/* Activities */}
          {dayActivities.length>0&&<div className="card">
            <h3 className="card-title">üéÆ Today's Activities</h3>
            {dayActivities.map((act,i)=>(
              <div key={i} className="activity-card">
                <div className="activity-name">{act.icon} {act.name}{act.cost>0&&` - ¬£${act.cost}`}</div>
                <div className="activity-meta">{act.duration} ‚Ä¢ {act.person}{act.cost===0&&' ‚Ä¢ FREE'}</div>
              </div>
            ))}
          </div>}
        </>}

        {/* STRETCH GOALS TAB */}
        {tab==='stretch'&&<>
          <div className="card" style={{background:'linear-gradient(135deg,var(--terracotta),var(--shawnie))',color:'white',textAlign:'center',padding:'24px'}}>
            <h2 style={{fontSize:'2rem',marginBottom:'8px'}}>üèÜ Stretch Goals</h2>
            <p style={{fontSize:'0.95rem',opacity:0.9}}>Your family's biggest dreams & ambitions</p>
          </div>

          {stretchGoals.map((goal,idx)=>(
            <div key={goal.id} className="card">
              <div style={{display:'flex',alignItems:'flex-start',gap:'16px',marginBottom:'16px'}}>
                <div style={{fontSize:'3rem'}}>{goal.icon}</div>
                <div style={{flex:1}}>
                  <h3 style={{fontSize:'1.3rem',fontWeight:700,marginBottom:'4px',color:'var(--navy)'}}>{goal.title}</h3>
                  <div style={{fontSize:'0.9rem',color:'var(--navy-light)',marginBottom:'8px'}}>{goal.subtitle}</div>
                  <div style={{display:'flex',gap:'8px',flexWrap:'wrap'}}>
                    {renderTag(goal.person)}
                    <span className="tag" style={{background:'var(--sage)',color:'white'}}>Target: {goal.target}</span>
                  </div>
                </div>
              </div>

              <div style={{background:'var(--cream)',padding:'16px',borderRadius:'var(--radius-md)',marginBottom:'16px'}}>
                <div style={{fontSize:'0.85rem',fontWeight:600,marginBottom:'12px',color:'var(--navy)'}}>üéØ Milestones:</div>
                {goal.milestones.map((milestone,mIdx)=>{
                  const key=`stretch-${goal.id}-${mIdx}`;
                  const done=data.completedTasks[key]||false;
                  return(
                    <div key={mIdx} className={`step-item ${done?'completed':''}`} onClick={()=>toggleTask(key,milestone.xp)} style={{marginBottom:'8px',cursor:'pointer'}}>
                      <div className={`step-check ${done?'checked':''}`}>{done&&<Check/>}</div>
                      <div style={{flex:1}}>
                        <div className="step-text">{milestone.text}</div>
                        <div style={{fontSize:'0.7rem',color:'var(--navy-light)',marginTop:'2px'}}>Target: {milestone.target} ‚Ä¢ +{milestone.xp} XP</div>
                      </div>
                    </div>
                  );
                })}
              </div>

              <div style={{background:'linear-gradient(135deg,rgba(129,178,154,0.1),rgba(242,166,90,0.1))',padding:'14px',borderRadius:'var(--radius-md)',borderLeft:'4px solid var(--sage)'}}>
                <div style={{fontSize:'0.75rem',fontWeight:600,color:'var(--navy)',marginBottom:'4px'}}>üéÅ REWARD:</div>
                <div style={{fontSize:'0.85rem',color:'var(--navy-light)',lineHeight:1.5}}>{goal.reward}</div>
              </div>
            </div>
          ))}

          <div className="card" style={{background:'var(--madison-light)',border:'2px solid var(--madison)'}}>
            <h3 style={{fontSize:'1.1rem',marginBottom:'12px',color:'#7a4a1f'}}>üí° About Stretch Goals</h3>
            <div style={{fontSize:'0.85rem',color:'#5a3a1f',lineHeight:1.6}}>
              <p style={{marginBottom:'8px'}}>These are your family's <strong>BIG dreams</strong> - the goals that will transform your lives over the next 5 years.</p>
              <p style={{marginBottom:'8px'}}>Unlike daily tasks, stretch goals are <strong>long-term aspirations</strong> that require months or years of effort. They represent the life you're building together.</p>
              <p>Check off milestones as you achieve them, and watch your dreams become reality! üåü</p>
            </div>
          </div>
        </>}

        {/* BUDGET TAB */}
        {tab==='budget'&&<>
          <div className="summary-row">
            <div className="summary-box income"><div className="summary-label">Income</div><div className="summary-value">¬£{totalIncome}</div></div>
            <div className="summary-box expense"><div className="summary-label">Expenses</div><div className="summary-value">¬£{totalExpenses}</div></div>
            <div className="summary-box saving"><div className="summary-label">Saving</div><div className="summary-value">¬£{totalSavings}</div></div>
            <div className={`summary-box ${monthlyLeftover>=0?'leftover':'negative'}`}><div className="summary-label">Leftover</div><div className="summary-value">¬£{monthlyLeftover}</div></div>
          </div>

           {monthlyLeftover<0&&<div className="tip-box" style={{background:'#fee2e2',borderColor:'#dc2626',color:'#991b1b'}}>‚ö†Ô∏è <strong>Monthly shortfall:</strong> ¬£{Math.abs(monthlyLeftover)} | {monthsUntilReturn} months to go | Total gap: ¬£{totalGapToBridge.toLocaleString()}</div>}

          {/* Phase 8: Bill Tracker */}
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}>
              <h3 className="card-title" style={{marginBottom:0}}>üìÖ Bill Tracker</h3>
              <button className="btn btn-primary btn-sm" onClick={()=>{
                const newBill={id:Date.now(),name:'New Bill',amount:0,dueDate:1,category:'other',recurring:'monthly',autoDebit:false,lastPaid:''};
                setData(prev=>({...prev,bills:[...prev.bills,newBill]}));
              }}>+ Add Bill</button>
            </div>
            <div style={{overflowX:'auto'}}>
              <table style={{width:'100%',fontSize:'0.85rem'}}>
                <thead>
                  <tr style={{borderBottom:'2px solid var(--cream-dark)'}}>
                    <th style={{textAlign:'left',padding:'8px'}}>Bill</th>
                    <th style={{textAlign:'right',padding:'8px'}}>Amount</th>
                    <th style={{textAlign:'center',padding:'8px'}}>Due</th>
                    <th style={{textAlign:'center',padding:'8px'}}>Frequency</th>
                    <th style={{textAlign:'center',padding:'8px'}}>Auto</th>
                    <th style={{textAlign:'center',padding:'8px'}}>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {(data.bills||defaultBills).map((bill,idx)=>{
                    const today=new Date();
                    const dueDay=typeof bill.dueDate==='number'?bill.dueDate:new Date(bill.dueDate).getDate();
                    const currentMonth=today.getMonth();
                    const dueThisMonth=new Date(today.getFullYear(),currentMonth,dueDay);
                    const daysUntil=Math.ceil((dueThisMonth-today)/(1000*60*60*24));
                    const isDueSoon=daysUntil>=0&&daysUntil<=7;
                    const isOverdue=daysUntil<0;
                    
                    return(
                      <tr key={bill.id} style={{borderBottom:'1px solid var(--cream)'}}>
                        <td style={{padding:'8px'}}>{bill.name}</td>
                        <td style={{textAlign:'right',padding:'8px',fontWeight:600}}>¬£{bill.amount}</td>
                        <td style={{textAlign:'center',padding:'8px'}}>{typeof bill.dueDate==='number'?`${bill.dueDate}th`:new Date(bill.dueDate).toLocaleDateString('en-GB',{day:'numeric',month:'short'})}</td>
                        <td style={{textAlign:'center',padding:'8px'}}><span className="tag">{bill.recurring}</span></td>
                        <td style={{textAlign:'center',padding:'8px'}}>{bill.autoDebit?'‚úÖ':'‚ö†Ô∏è'}</td>
                        <td style={{textAlign:'center',padding:'8px'}}>
                          {isOverdue?<span style={{color:'#dc2626',fontWeight:600}}>‚ö†Ô∏è Overdue</span>:
                           isDueSoon?<span style={{color:'#f59e0b',fontWeight:600}}>üîî Due soon</span>:
                           <span style={{color:'#059669'}}>‚úì OK</span>}
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
            <div className="tip-box" style={{marginTop:'12px'}}>
              üí° Bills due in next 7 days: <strong>{(data.bills||defaultBills).filter(b=>{
                const today=new Date();
                const dueDay=typeof b.dueDate==='number'?b.dueDate:new Date(b.dueDate).getDate();
                const dueThisMonth=new Date(today.getFullYear(),today.getMonth(),dueDay);
                const daysUntil=Math.ceil((dueThisMonth-today)/(1000*60*60*24));
                return daysUntil>=0&&daysUntil<=7;
              }).length}</strong>
            </div>
          </div>

          {/* Phase 8: Subscription Tracker */}
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}>
              <h3 className="card-title" style={{marginBottom:0}}>üì± Subscriptions</h3>
              <button className="btn btn-primary btn-sm" onClick={()=>{
                const newSub={id:Date.now(),name:'New Subscription',cost:0,billing:'monthly',category:'other',autoRenew:true,renewDate:'',worth:true,notes:''};
                setData(prev=>({...prev,subscriptions:[...prev.subscriptions,newSub]}));
              }}>+ Add Subscription</button>
            </div>
            <div style={{display:'grid',gap:'10px'}}>
              {(data.subscriptions||defaultSubscriptions).map((sub,idx)=>(
                <div key={sub.id} style={{background:'var(--cream)',padding:'12px',borderRadius:'var(--radius-md)',display:'flex',alignItems:'center',gap:'12px'}}>
                  <div style={{flex:1}}>
                    <div style={{fontWeight:600,marginBottom:'4px'}}>{sub.name}</div>
                    <div style={{fontSize:'0.75rem',color:'var(--navy-light)'}}>
                      ¬£{sub.cost}/{sub.billing} ‚Ä¢ Renews: {new Date(sub.renewDate).toLocaleDateString('en-GB')}
                    </div>
                  </div>
                  <div style={{textAlign:'right'}}>
                    <div style={{fontWeight:700,fontSize:'1.1rem',color:'var(--navy)'}}>¬£{sub.cost}</div>
                    <div style={{fontSize:'0.7rem',color:sub.worth?'#059669':'#dc2626'}}>{sub.worth?'‚úì Worth it':'‚ùå Review'}</div>
                  </div>
                  <button className="btn btn-secondary btn-sm" onClick={()=>{
                    if(confirm(`Cancel ${sub.name}?`)){
                      setData(prev=>({...prev,subscriptions:prev.subscriptions.filter(s=>s.id!==sub.id)}));
                    }
                  }}>üóëÔ∏è</button>
                </div>
              ))}
            </div>
            <div className="tip-box" style={{marginTop:'12px'}}>
              üí∞ <strong>Total monthly subscriptions:</strong> ¬£{(data.subscriptions||defaultSubscriptions).filter(s=>s.billing==='monthly').reduce((sum,s)=>sum+s.cost,0).toFixed(2)} ‚Ä¢ 
              <strong> Annual:</strong> ¬£{(data.subscriptions||defaultSubscriptions).reduce((sum,s)=>sum+(s.billing==='monthly'?s.cost*12:s.cost),0).toFixed(2)}
            </div>
          </div>

          {/* Phase 8: Savings Goals */}
          <div className="card">
            <h3 className="card-title">üéØ Savings Goals</h3>
            <div style={{display:'grid',gap:'12px'}}>
              {(data.savingsGoals||defaultSavingsGoals).map((goal,idx)=>{
                const progress=(goal.current/goal.target)*100;
                const monthsToTarget=goal.monthly>0?Math.ceil((goal.target-goal.current)/goal.monthly):999;
                const projectedDate=goal.monthly>0?new Date(Date.now()+monthsToTarget*30*24*60*60*1000):null;
                
                return(
                  <div key={goal.id} style={{background:'var(--cream)',padding:'14px',borderRadius:'var(--radius-md)'}}>
                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'8px'}}>
                      <div>
                        <div style={{fontSize:'1rem',fontWeight:700,marginBottom:'4px'}}>{goal.icon} {goal.name}</div>
                        <div style={{fontSize:'0.75rem',color:'var(--navy-light)'}}>{goal.notes}</div>
                      </div>
                      <span className={`tag tag-${goal.priority}`}>{goal.priority}</span>
                    </div>
                    
                    <div style={{marginBottom:'8px'}}>
                      <div style={{display:'flex',justifyContent:'space-between',fontSize:'0.8rem',marginBottom:'4px'}}>
                        <span>¬£{goal.current.toLocaleString()} / ¬£{goal.target.toLocaleString()}</span>
                        <span style={{fontWeight:600}}>{Math.round(progress)}%</span>
                      </div>
                      <div style={{height:'8px',background:'var(--cream-dark)',borderRadius:'4px',overflow:'hidden'}}>
                        <div style={{height:'100%',width:`${progress}%`,background:progress>=100?'#059669':progress>=50?'#f59e0b':'#dc2626',transition:'width 0.3s ease'}}/>
                      </div>
                    </div>
                    
                    <div style={{display:'flex',gap:'8px',fontSize:'0.75rem',color:'var(--navy-light)'}}>
                      <div>üí∞ ¬£{goal.monthly}/mo</div>
                      {projectedDate&&<div>üìÖ {monthsToTarget} months ({projectedDate.toLocaleDateString('en-GB',{month:'short',year:'numeric'})})</div>}
                      <div>üéØ Target: {goal.deadline}</div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          {/* Phase 8: Quick Expense Logger */}
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}>
              <h3 className="card-title" style={{marginBottom:0}}>üí∏ Quick Expense Log</h3>
              <button className="btn btn-primary btn-sm" onClick={()=>{
                const amount=prompt('Amount (¬£):');
                const category=prompt('Category (groceries/transport/entertainment/other):');
                const note=prompt('Note (optional):');
                if(amount&&category){
                  const expense={id:Date.now(),date:new Date().toISOString(),amount:parseFloat(amount),category,note:note||'',logged:new Date().toISOString()};
                  setData(prev=>({...prev,expenseLog:[...prev.expenseLog,expense]}));
                  celebrate(`üí∏ ¬£${amount} logged!`);
                }
              }}>+ Log Expense</button>
            </div>
            <div style={{maxHeight:'300px',overflowY:'auto'}}>
              {(data.expenseLog||[]).slice(-10).reverse().map(exp=>(
                <div key={exp.id} style={{display:'flex',justifyContent:'space-between',padding:'8px',borderBottom:'1px solid var(--cream)',fontSize:'0.85rem'}}>
                  <div>
                    <span style={{fontWeight:600}}>¬£{exp.amount}</span> ‚Ä¢ {exp.category}
                    {exp.note&&<div style={{fontSize:'0.75rem',color:'var(--navy-light)',marginTop:'2px'}}>{exp.note}</div>}
                  </div>
                  <div style={{fontSize:'0.75rem',color:'var(--navy-light)'}}>{new Date(exp.date).toLocaleDateString('en-GB')}</div>
                </div>
              ))}
              {(!data.expenseLog||data.expenseLog.length===0)&&<div style={{textAlign:'center',padding:'16px',color:'var(--navy-light)',fontSize:'0.85rem'}}>No expenses logged yet</div>}
            </div>
            {data.expenseLog&&data.expenseLog.length>0&&<div className="tip-box" style={{marginTop:'12px'}}>
              üìä <strong>This month:</strong> ¬£{data.expenseLog.filter(e=>new Date(e.date).getMonth()===new Date().getMonth()).reduce((sum,e)=>sum+e.amount,0).toFixed(2)}
            </div>}
          </div>

          <div className="card">
            <h3 className="card-title"><span className="card-icon">üìä</span>Budget Breakdown</h3>
            <div className="chart-container">
              <canvas id="budgetChart"></canvas>
            </div>
          </div>
          
          <div className="card">
            <h3 className="card-title"><span className="card-icon">üìà</span>Savings Projection</h3>
            <div className="chart-container">
              <canvas id="savingsChart"></canvas>
            </div>
            <div className="tip-box" style={{marginTop:'16px'}}>
              üí° <strong>Projection:</strong> Shawnie returns July 1st, 2026 (¬£40k/year, ¬£2,600/mo net). 
              Childcare: ¬£640/mo. Net gain: ¬£1,960/mo. Target: ¬£25k house deposit by 2029!
            </div>
          </div>
          
          <div className="card">
            <h3 className="card-title"><span className="card-icon">üë¥</span>Pension Growth Projection</h3>
            <div className="chart-container">
              <canvas id="pensionChart"></canvas>
            </div>
            <div className="tip-box" style={{marginTop:'16px'}}>
              üí° <strong>Retirement projections:</strong> Based on current balances and monthly contributions. 
              Assumes 5% annual growth. Rich retires at 67 (2057), Shawnie at 67 (2059).
            </div>
          </div>

          <div className="budget-grid">            <div className="budget-section">
              <div className="budget-section-title">üíö Income</div>
              {Object.entries(incomeLabels).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.income[key]||''} placeholder="0" onChange={e=>updateBudget('income',key,e.target.value)}/></div>
              )}
              <div className="budget-total"><span className="budget-total-label">Total Income</span><span className="budget-total-value" style={{color:'#059669'}}>¬£{totalIncome}</span></div>
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üè† Housing & Utilities</div>
              {Object.entries(expenseLabels).slice(0,6).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.expenses[key]||''} placeholder="0" onChange={e=>updateBudget('expenses',key,e.target.value)}/></div>
              )}
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üöó Transport & Living</div>
              {Object.entries(expenseLabels).slice(6,12).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.expenses[key]||''} placeholder="0" onChange={e=>updateBudget('expenses',key,e.target.value)}/></div>
              )}
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üì¶ Other Expenses</div>
              {Object.entries(expenseLabels).slice(12).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.expenses[key]||''} placeholder="0" onChange={e=>updateBudget('expenses',key,e.target.value)}/></div>
              )}
              <div className="budget-total"><span className="budget-total-label">Total Expenses</span><span className="budget-total-value" style={{color:'#dc2626'}}>¬£{totalExpenses}</span></div>
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üí∞ Monthly Savings</div>
              {Object.entries(savingsLabels).map(([key,label])=>
                <div key={key} className="budget-row"><span className="budget-label">{label}</span><input type="number" className="budget-input" value={data.budget.savings[key]||''} placeholder="0" onChange={e=>updateBudget('savings',key,e.target.value)}/></div>
              )}
              <div className="budget-total"><span className="budget-total-label">Total Savings</span><span className="budget-total-value" style={{color:'#0284c7'}}>¬£{totalSavings}</span></div>
            </div>

            <div className="budget-section">
              <div className="budget-section-title">üíé Savings Pots</div>
              <div className="budget-row"><span className="budget-label">Emergency Fund</span><input type="number" className="budget-input" value={config.emergencyFund||''} placeholder="0" onChange={e=>setConfig(c=>({...c,emergencyFund:Number(e.target.value)||0}))}/></div>
              <div className="budget-row"><span className="budget-label">House Deposit</span><input type="number" className="budget-input" value={config.houseDeposit||''} placeholder="0" onChange={e=>setConfig(c=>({...c,houseDeposit:Number(e.target.value)||0}))}/></div>
              <div className="budget-total"><span className="budget-total-label">Total Saved</span><span className="budget-total-value" style={{color:'#d97706'}}>¬£{totalSaved.toLocaleString()}</span></div>
            </div>
          </div>

          <div className="card" style={{marginTop:16}}>
            <h3 className="card-title">üë¥ Pensions</h3>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
              <div><label className="form-label">Rich's Pension</label><input type="number" className="form-input" value={config.richPension||''} onChange={e=>setConfig(c=>({...c,richPension:Number(e.target.value)||0}))}/></div>
              <div><label className="form-label">Shawnie's Pension</label><input type="number" className="form-input" value={config.shawniePension||''} onChange={e=>setConfig(c=>({...c,shawniePension:Number(e.target.value)||0}))}/></div>
            </div>
            <div className="tip-box">Combined Pensions: <strong>¬£{(config.richPension+config.shawniePension).toLocaleString()}</strong></div>
          </div>
        </>}


        {/* MADISON TAB */}
        {tab==='madison'&&<>
          <div className="madison-hero">
            <div className="overview-countdown">üë∂ Madison's Journey</div>
            <div className="madison-age">{formatAge(data.madison?.birthDate||'2024-02-01')}</div>
            <div className="overview-label">old today</div>
            <div className="overview-date">Born {new Date(data.madison?.birthDate||'2024-02-01').toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}</div>
          </div>

          <div className="nav" style={{marginBottom:'16px',background:'var(--madison-light)',padding:'6px'}}>
            {['overview','growth','health','development','vaccinations'].map(t=>(
              <button key={t} className={`nav-btn ${madisonTab===t?'active':''}`} onClick={()=>setMadisonTab(t)} style={{fontSize:'0.75rem',padding:'8px 12px'}}>
                {t==='overview'&&'üìä Overview'}
                {t==='growth'&&'üìè Growth'}
                {t==='health'&&'üè• Health'}
                {t==='development'&&'üéØ Development'}
                {t==='vaccinations'&&'üíâ Vaccines'}
              </button>
            ))}
          </div>

          {/* OVERVIEW SUB-TAB */}
          {madisonTab==='overview'&&<>
            <div className="madison-stat-grid">
              {data.madison?.growth?.length>0&&<>
                <div className="madison-stat-card">
                  <div className="madison-stat-icon">üìè</div>
                  <div className="madison-stat-value">{data.madison.growth[data.madison.growth.length-1].height}</div>
                  <div className="madison-stat-label">Height (cm)</div>
                  <div className="madison-stat-date">{new Date(data.madison.growth[data.madison.growth.length-1].date).toLocaleDateString('en-GB',{month:'short',year:'numeric'})}</div>
                </div>
                <div className="madison-stat-card">
                  <div className="madison-stat-icon">‚öñÔ∏è</div>
                  <div className="madison-stat-value">{data.madison.growth[data.madison.growth.length-1].weight}</div>
                  <div className="madison-stat-label">Weight (kg)</div>
                  <div className="madison-stat-date">{new Date(data.madison.growth[data.madison.growth.length-1].date).toLocaleDateString('en-GB',{month:'short',year:'numeric'})}</div>
                </div>
              </>}
              <div className="madison-stat-card">
                <div className="madison-stat-icon">üíâ</div>
                <div className="madison-stat-value">{data.madison?.vaccinations?.filter(v=>v.completed).length}/{data.madison?.vaccinations?.length||0}</div>
                <div className="madison-stat-label">Vaccinations</div>
              </div>
              <div className="madison-stat-card">
                <div className="madison-stat-icon">üéØ</div>
                <div className="madison-stat-value">{Object.values(data.madison?.developmental||{}).reduce((sum,arr)=>sum+arr.filter(m=>m.achieved).length,0)}</div>
                <div className="madison-stat-label">Milestones</div>
              </div>
            </div>

            <div className="card">
              <h3 className="card-title">üéâ Recent Achievements</h3>
              {Object.entries(data.madison?.developmental||{}).map(([category,items])=>
                items.filter(m=>m.achieved).slice(-2).map(m=>(
                  <div key={m.id} className="dev-milestone achieved" style={{background:'var(--sage-light)',cursor:'default'}}>
                    <div className="dev-check checked"><Check/></div>
                    <div className="dev-text">{m.skill}</div>
                    <div className="dev-age">{m.date?new Date(m.date).toLocaleDateString('en-GB',{month:'short',day:'numeric'}):''}</div>
                  </div>
                ))
              )}
            </div>

            <div className="card">
              <h3 className="card-title">üìã Coming Up</h3>
              {data.madison?.vaccinations?.filter(v=>!v.completed).slice(0,3).map(v=>(
                <div key={v.id} className="vacc-item">
                  <div className="vacc-check"><span style={{fontSize:'1.2rem'}}>üíâ</span></div>
                  <div className="vacc-info">
                    <div className="vacc-name">{v.name}</div>
                    <div className="vacc-age">Due: {v.ageWeeks?`${v.ageWeeks} weeks`:v.ageMonths?`${v.ageMonths} months`:`${v.ageYears} years`}</div>
                  </div>
                </div>
              ))}
            </div>
          </>}

          {/* GROWTH SUB-TAB */}
          {madisonTab==='growth'&&<>
            <button className="btn btn-primary" style={{marginBottom:'16px',width:'100%'}} onClick={()=>setShowGrowthModal(true)}>+ Add Growth Entry</button>

            <div className="card">
              <h3 className="card-title">üìà Growth Chart</h3>
              <div className="chart-container" style={{height:'300px'}}>
                <canvas id="growthChart"></canvas>
              </div>
            </div>

            <div className="card">
              <h3 className="card-title">üìè Growth History</h3>
              {[...(data.madison?.growth||[])].reverse().map(entry=>(
                <div key={entry.id} className="growth-entry">
                  <div className="growth-date-col">{new Date(entry.date).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'})}</div>
                  <div className="growth-data-col">
                    <div className="growth-metric">
                      <div className="growth-metric-label">Height</div>
                      <div className="growth-metric-value">{entry.height} cm</div>
                    </div>
                    <div className="growth-metric">
                      <div className="growth-metric-label">Weight</div>
                      <div className="growth-metric-value">{entry.weight} kg</div>
                    </div>
                    {entry.headCirc&&<div className="growth-metric">
                      <div className="growth-metric-label">Head</div>
                      <div className="growth-metric-value">{entry.headCirc} cm</div>
                    </div>}
                  </div>
                </div>
              ))}
            </div>
          </>}

          {/* HEALTH SUB-TAB */}
          {madisonTab==='health'&&<>
            <button className="btn btn-primary" style={{marginBottom:'16px',width:'100%'}} onClick={()=>setShowHealthModal(true)}>+ Add Health Note</button>

            <div className="card">
              <h3 className="card-title">üè• Health Records</h3>
              {[...(data.madison?.health||[])].reverse().map(note=>(
                <div key={note.id} className="health-note">
                  <div className="health-note-header">
                    <div className="health-note-date">{new Date(note.date).toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'})}</div>
                    <div className="health-note-type">{note.type}</div>
                  </div>
                  <div className="health-note-text">{note.notes}</div>
                  {(note.weight||note.height)&&<div style={{marginTop:'8px',fontSize:'0.75rem',color:'#7a4a1f'}}>
                    {note.weight&&`Weight: ${note.weight}kg`}
                    {note.weight&&note.height&&' ‚Ä¢ '}
                    {note.height&&`Height: ${note.height}cm`}
                  </div>}
                </div>
              ))}
            </div>
          </>}

          {/* DEVELOPMENT SUB-TAB */}
          {madisonTab==='development'&&<>
            {Object.entries(data.madison?.developmental||{}).map(([category,items])=>(
              <div key={category} className="dev-category">
                <div className="dev-category-title">
                  {category==='motor'&&'üèÉ Motor Skills'}
                  {category==='language'&&'üí¨ Language'}
                  {category==='social'&&'üë• Social'}
                  {category==='cognitive'&&'üß† Cognitive'}
                  <span style={{marginLeft:'auto',fontSize:'0.8rem',fontWeight:'normal'}}>
                    {items.filter(m=>m.achieved).length}/{items.length}
                  </span>
                </div>
                {items.map(milestone=>(
                  <div key={milestone.id} className={`dev-milestone ${milestone.achieved?'achieved':''}`} onClick={()=>toggleDevMilestone(category,milestone.id)}>
                    <div className={`dev-check ${milestone.achieved?'checked':''}`}>{milestone.achieved&&<Check/>}</div>
                    <div className="dev-text">{milestone.skill}</div>
                    <div className="dev-age">{milestone.ageMonths}m</div>
                  </div>
                ))}
              </div>
            ))}
          </>}

          {/* VACCINATIONS SUB-TAB */}
          {madisonTab==='vaccinations'&&<>
            <div className="card">
              <h3 className="card-title">üíâ Vaccination Schedule (NHS UK)</h3>
              <div style={{marginBottom:'16px',fontSize:'0.85rem',color:'var(--navy-light)'}}>
                UK vaccination schedule - tap to mark as complete
              </div>
              {data.madison?.vaccinations?.map(vacc=>(
                <div key={vacc.id} className={`vacc-item ${vacc.completed?'completed':''}`}>
                  <div className={`vacc-check ${vacc.completed?'checked':''}`} onClick={()=>toggleVaccination(vacc.id)}>
                    {vacc.completed&&<Check/>}
                  </div>
                  <div className="vacc-info">
                    <div className="vacc-name">{vacc.name}</div>
                    <div className="vacc-age">
                      Age: {vacc.ageWeeks?`${vacc.ageWeeks} weeks`:vacc.ageMonths?`${vacc.ageMonths} months`:`${vacc.ageYears} years`}
                    </div>
                  </div>
                  <div className="vacc-date">
                    {vacc.completed&&vacc.date?new Date(vacc.date).toLocaleDateString('en-GB',{day:'2-digit',month:'short',year:'numeric'}):'Not yet'}
                  </div>
                </div>
              ))}
            </div>
          </>}
        </>}
        {/* MEMORIES TAB */}
        {tab==='memories'&&<>
          <button className="btn btn-primary" style={{marginBottom:'16px',width:'100%'}} onClick={()=>setShowNoteModal(true)}>+ Add Family Note</button>

          <div className="card" style={{marginBottom:'16px'}}>
            <div style={{position:'relative'}}>
              <input 
                type="text"
                className="form-input"
                placeholder="üîç Search notes..."
                value={searchTerm}
                onChange={e=>handleSearch(e.target.value)}
                style={{paddingLeft:'40px'}}
              />
              {searchTerm&&(
                <button 
                  onClick={()=>handleSearch('')}
                  style={{
                    position:'absolute',
                    right:'12px',
                    top:'50%',
                    transform:'translateY(-50%)',
                    background:'none',
                    border:'none',
                    fontSize:'1.2rem',
                    cursor:'pointer',
                    color:'var(--navy-light)'
                  }}
                >
                  √ó
                </button>
              )}
            </div>
            {searchTerm&&(
              <div style={{marginTop:'8px',fontSize:'0.85rem',color:'var(--navy-light)'}}>
                Found: {searchResults.notes.length} notes
              </div>
            )}
          </div>

          {(searchTerm?searchResults.notes:data.notes).length>0&&<div className="card">
            <h3 className="card-title">üìù Family Notes</h3>
            {(searchTerm?searchResults.notes:data.notes).map(note=>(
              <div key={note.id} className="note-card">
                <div className="note-date">{new Date(note.date).toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'})}</div>
                <div className="note-text">{highlightText(note.text,searchTerm)}</div>
                <button className="btn btn-sm btn-secondary" style={{marginTop:'8px'}} onClick={()=>deleteNote(note.id)}>Delete</button>
              </div>
            ))}
          </div>}

          <div className="card">
            <h3 className="card-title">üéØ Milestones</h3>
            <div className="milestone-grid">
              {data.milestones.map(m=>(
                <div key={m.id} className={`milestone-card ${m.achieved?'achieved':''}`}>
                  <div className={`milestone-photo ${m.photo?'has-photo':''}`}>
                    {m.photo?(
                      <>
                        <img src={m.photo} alt={m.title}/>
                        <div className="photo-date">{new Date(m.date).toLocaleDateString('en-GB',{month:'short',year:'numeric'})}</div>
                      </>
                    ):m.icon}
                    {m.achieved&&<div className="achievement-badge">‚úì Achieved!</div>}
                    <label className="milestone-upload">
                      üì∑
                      <input type="file" accept="image/*" onChange={e=>e.target.files[0]&&uploadMilestonePhoto(m.id,e.target.files[0])}/>
                    </label>
                  </div>
                  <div className="milestone-content">
                    <div className="milestone-title">{m.title}</div>
                    <div style={{fontSize:'0.75rem',color:'var(--navy-light)',marginBottom:'8px'}}>{m.date}</div>
                    {m.notes&&<div className="milestone-notes">"{m.notes}"</div>}
                    <button className="btn btn-sm btn-secondary" style={{width:'100%',marginBottom:'8px'}} onClick={(e)=>{
                      e.stopPropagation();
                      const notes=prompt('Add a note about this milestone:',m.notes||'');
                      if(notes!==null){
                        setData(prev=>({...prev,milestones:prev.milestones.map(ms=>ms.id===m.id?{...ms,notes}:ms)}));
                      }
                    }}>
                      {m.notes?'‚úèÔ∏è Edit Note':'+ Add Note'}
                    </button>
                    <div className={`benefit-check ${m.achieved?'checked':''}`} onClick={()=>toggleMilestone(m.id)} style={{margin:'0 auto',cursor:'pointer'}}>
                      {m.achieved&&<Check/>}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </>}
        
        {/* WEEK OVERVIEW TAB */}
        {tab==='week'&&<>
          <div className="card week-overview-card">
            <h3 className="card-title">üìã Week at a Glance</h3>
            {weekDates.map(d=>{
              const dk=d.toISOString().split('T')[0];
              const evs=data.events[dk]||[];
              const dow=d.getDay();
              const meals=weeklyMeals[dow];
              const acts=weeklyActivities[dow]||[];
              const cost=meals.breakfast.cost+meals.lunch.cost+meals.dinner.cost;
              return<div key={dk} className="week-overview-day">
                <div className="week-overview-date">{d.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'short'})}</div>
                <div className="week-overview-items">
                  <div className="week-overview-item"><span className="week-overview-icon">üçΩÔ∏è</span><span>Meals: ¬£{cost.toFixed(2)}</span></div>
                  {acts.map((a,i)=><div key={i} className="week-overview-item"><span className="week-overview-icon">{a.icon}</span><span>{a.name}</span></div>)}
                  {evs.map(e=><div key={e.id} className="week-overview-item event"><span className="week-overview-icon">üìÖ</span><span>{e.time} - {e.title}</span></div>)}
                  {currentGoalSteps.filter(s=>s.date.includes(d.toLocaleDateString('en-GB',{month:'short'})) || s.date.includes('Ongoing')).slice(0,1).map((s,i)=>
                    <div key={i} className="week-overview-item goal"><span className="week-overview-icon">üéØ</span><span>{s.text.substring(0,40)}...</span></div>
                  )}
                </div>
              </div>
            })}
          </div>
        </>}

        {/* MONTH OVERVIEW TAB */}
        {tab==='month'&&<>
          <div className="card">
            <h3 className="card-title">üìä December 2025</h3>
            
            <div className="quick-stats">
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.level||1}</div>
                <div className="quick-stat-label">Level</div>
              </div>
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.streak||0}</div>
                <div className="quick-stat-label">Streak</div>
              </div>
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.xp||0}</div>
                <div className="quick-stat-label">Total XP</div>
              </div>
              <div className="quick-stat">
                <div className="quick-stat-value">{data.gamification?.longestStreak||0}</div>
                <div className="quick-stat-label">Best Streak</div>
              </div>
            </div>
            
            <div className="month-calendar">
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>SUN</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>MON</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>TUE</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>WED</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>THU</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>FRI</div>
              <div style={{fontWeight:700,fontSize:'0.7rem',color:'var(--navy-light)',padding:'8px',textAlign:'center'}}>SAT</div>
              
              {Array.from({length:31},(_, i)=>{
                const day=i+1;
                const isToday=day===new Date().getDate()&&new Date().getMonth()===11;
                const dateStr=`2025-12-${day.toString().padStart(2,'0')}`;
                const dayTasks=Object.keys(data.completedTasks).filter(k=>k.includes(dateStr)&&data.completedTasks[k]);
                const totalPossible=26;
                const completion=dayTasks.length/totalPossible;
                
                return(
                  <div
                    key={day}
                    className={`month-day ${
                      completion>=0.8?'completed':completion>=0.5?'partial':''
                    } ${isToday?'today':''}`}
                    title={`${day} Dec: ${dayTasks.length}/${totalPossible} tasks (${Math.round(completion*100)}%)`}
                  >
                    {day}
                  </div>
                );
              })}
            </div>
            
            <div className="tip-box" style={{marginTop:'16px'}}>
              üí° <strong>Green days</strong> = 80%+ complete ‚Ä¢ <strong>Yellow days</strong> = 50-79% ‚Ä¢ <strong>Gray days</strong> = Under 50%
            </div>
          </div>
          
          <div className="card">
            <h3 className="card-title">üèÜ Achievements</h3>
            {(data.gamification?.achievements||[]).length===0&&(
              <div style={{padding:'40px',textAlign:'center',color:'var(--navy-light)'}}>
                <div style={{fontSize:'3rem',marginBottom:'16px'}}>üéØ</div>
                <div style={{fontSize:'1rem',fontWeight:600,marginBottom:'8px'}}>No achievements yet!</div>
                <div style={{fontSize:'0.85rem'}}>Complete tasks to unlock achievements and earn bonus XP!</div>
              </div>
            )}
            {(data.gamification?.achievements||[]).map((achievement,i)=>(
              <div key={i} style={{padding:'12px',background:'var(--cream)',borderRadius:'var(--radius-md)',marginBottom:'8px',display:'flex',alignItems:'center',gap:'12px'}}>
                <div style={{fontSize:'2rem'}}>{achievement.icon}</div>
                <div style={{flex:1}}>
                  <div style={{fontWeight:700,fontSize:'0.9rem'}}>{achievement.name}</div>
                  <div style={{fontSize:'0.75rem',color:'var(--navy-light)'}}>{achievement.description}</div>
                </div>
                <div style={{fontSize:'0.8rem',fontWeight:700,color:'var(--gold)'}}>+{achievement.xp} XP</div>
              </div>
            ))}
          </div>
        </>}

        {/* SETTINGS TAB */}
        {tab==='settings'&&<>
          <div className="card">
            <h3 className="card-title">‚öôÔ∏è Family Settings</h3>
            <div style={{display:'grid',gap:16}}>
              
              {/* Basic Info */}
              <div style={{display:'grid',gap:12}}>
                <h4 style={{fontSize:'1rem',marginBottom:8,color:'var(--navy)'}}>üë®‚Äçüë©‚Äçüëß Family Information</h4>
                <div><label className="form-label">Family Name</label><input type="text" className="form-input" value={config.familyName} onChange={e=>setConfig(c=>({...c,familyName:e.target.value}))}/></div>
                
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                  <div><label className="form-label">Current Location</label><input type="text" className="form-input" value={config.location} onChange={e=>setConfig(c=>({...c,location:e.target.value}))}/></div>
                  <div><label className="form-label">Target Location (Sheffield)</label><input type="text" className="form-input" value={config.targetLocation} onChange={e=>setConfig(c=>({...c,targetLocation:e.target.value}))}/></div>
                </div>
              </div>

              {/* Important Dates */}
              <div style={{display:'grid',gap:12,paddingTop:16,borderTop:'1px solid var(--cream)'}}>
                <h4 style={{fontSize:'1rem',marginBottom:8,color:'var(--navy)'}}>üìÖ Important Dates</h4>
                
                <div><label className="form-label">Move Date (Sheffield)</label><input type="date" className="form-input" value={config.moveDate} onChange={e=>setConfig(c=>({...c,moveDate:e.target.value}))}/></div>
                
                <div><label className="form-label">Shawnie Return to Work</label><input type="date" className="form-input" value={config.shawnieReturnDate} onChange={e=>setConfig(c=>({...c,shawnieReturnDate:e.target.value}))}/></div>
                
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr 1fr',gap:12}}>
                  <div><label className="form-label">Rich's Birthday</label><input type="date" className="form-input" value={config.richBirthDate} onChange={e=>setConfig(c=>({...c,richBirthDate:e.target.value}))}/></div>
                  <div><label className="form-label">Shawnie's Birthday</label><input type="date" className="form-input" value={config.shawnieBirthDate} onChange={e=>setConfig(c=>({...c,shawnieBirthDate:e.target.value}))}/></div>
                  <div><label className="form-label">Madison's Birthday</label><input type="date" className="form-input" value={config.madisonBirthDate} onChange={e=>setConfig(c=>({...c,madisonBirthDate:e.target.value}))}/></div>
                </div>
              </div>

              {/* Financial */}
              <div style={{display:'grid',gap:12,paddingTop:16,borderTop:'1px solid var(--cream)'}}>
                <h4 style={{fontSize:'1rem',marginBottom:8,color:'var(--navy)'}}>üí∞ Financial Information</h4>
                
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                  <div><label className="form-label">Emergency Fund (¬£)</label><input type="number" className="form-input" value={config.emergencyFund} onChange={e=>setConfig(c=>({...c,emergencyFund:parseFloat(e.target.value)||0}))}/></div>
                  <div><label className="form-label">House Deposit Saved (¬£)</label><input type="number" className="form-input" value={config.houseDeposit} onChange={e=>setConfig(c=>({...c,houseDeposit:parseFloat(e.target.value)||0}))}/></div>
                </div>
                
                <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}}>
                  <div><label className="form-label">Rich's Pension (¬£)</label><input type="number" className="form-input" value={config.richPension} onChange={e=>setConfig(c=>({...c,richPension:parseFloat(e.target.value)||0}))}/></div>
                  <div><label className="form-label">Shawnie's Pension (¬£)</label><input type="number" className="form-input" value={config.shawniePension} onChange={e=>setConfig(c=>({...c,shawniePension:parseFloat(e.target.value)||0}))}/></div>
                </div>
              </div>

              {/* Madison Age Display */}
              <div style={{display:'grid',gap:12,paddingTop:16,borderTop:'1px solid var(--cream)'}}>
                <h4 style={{fontSize:'1rem',marginBottom:8,color:'var(--navy)'}}>üë∂ Madison's Age</h4>
                <div style={{background:'var(--madison-light)',padding:16,borderRadius:'var(--radius-md)',border:'2px solid var(--madison)'}}>
                  <div style={{fontSize:'1.5rem',fontWeight:700,color:'#d97706',marginBottom:4}}>
                    {(()=>{
                      const birth=new Date(config.madisonBirthDate);
                      const today=new Date();
                      const months=Math.floor((today-birth)/(1000*60*60*24*30.44));
                      const days=Math.floor((today-birth)/(1000*60*60*24))%30;
                      return `${months} months, ${days} days old`;
                    })()}
                  </div>
                  <div style={{fontSize:'0.85rem',color:'#7a4a1f'}}>
                    Born: {new Date(config.madisonBirthDate).toLocaleDateString('en-GB',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}
                  </div>
                </div>
              </div>

              {/* Countdown to Move */}
              <div style={{display:'grid',gap:12,paddingTop:16,borderTop:'1px solid var(--cream)'}}>
                <h4 style={{fontSize:'1rem',marginBottom:8,color:'var(--navy)'}}>üèòÔ∏è Sheffield Move Countdown</h4>
                <div style={{background:'linear-gradient(135deg,#f0fdf4,#dcfce7)',padding:16,borderRadius:'var(--radius-md)',border:'2px solid var(--sage)'}}>
                  <div style={{fontSize:'2rem',fontWeight:700,color:'#15803d',marginBottom:4}}>
                    {(()=>{
                      const move=new Date(config.moveDate);
                      const today=new Date();
                      const days=Math.ceil((move-today)/(1000*60*60*24));
                      return days>0?`${days} days`:'Moved!';
                    })()}
                  </div>
                  <div style={{fontSize:'0.85rem',color:'#166534'}}>
                    Until: {new Date(config.moveDate).toLocaleDateString('en-GB',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}
                  </div>
                </div>
              </div>

            </div>
          </div>

          {/* Budget Editor */}
          <div className="card">
            <h3 className="card-title">üí∞ Edit Budget</h3>
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:16}}>
              
              <div>
                <h4 style={{fontSize:'0.95rem',marginBottom:12,color:'var(--sage)'}}>üíö Income</h4>
                <div style={{display:'grid',gap:8}}>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Rich Wage</span>
                    <input type="number" className="form-input" value={data.budget.income.richWage} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,income:{...prev.budget.income,richWage:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Shawnie Wage</span>
                    <input type="number" className="form-input" value={data.budget.income.shawnieWage} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,income:{...prev.budget.income,shawnieWage:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Child Benefit</span>
                    <input type="number" className="form-input" value={data.budget.income.childBenefit} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,income:{...prev.budget.income,childBenefit:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                </div>
              </div>

              <div>
                <h4 style={{fontSize:'0.95rem',marginBottom:12,color:'#dc2626'}}>üí∏ Expenses</h4>
                <div style={{display:'grid',gap:8}}>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Rent/Mortgage</span>
                    <input type="number" className="form-input" value={data.budget.expenses.housing} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,expenses:{...prev.budget.expenses,housing:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Council Tax</span>
                    <input type="number" className="form-input" value={data.budget.expenses.councilTax} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,expenses:{...prev.budget.expenses,councilTax:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Utilities</span>
                    <input type="number" className="form-input" value={data.budget.expenses.utilities} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,expenses:{...prev.budget.expenses,utilities:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Groceries</span>
                    <input type="number" className="form-input" value={data.budget.expenses.groceries} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,expenses:{...prev.budget.expenses,groceries:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'2fr 1fr',gap:8,alignItems:'center'}}>
                    <span style={{fontSize:'0.85rem'}}>Transport</span>
                    <input type="number" className="form-input" value={data.budget.expenses.transport} onChange={e=>setData(prev=>({...prev,budget:{...prev.budget,expenses:{...prev.budget.expenses,transport:parseFloat(e.target.value)||0}}}))} style={{fontSize:'0.85rem'}}/>
                  </div>
                </div>
              </div>

            </div>
          </div>

          {/* Data Management */}
          <div className="card">
            <h3 className="card-title">üíæ Data Management</h3>
            <div style={{display:'grid',gap:12}}>
              <div style={{display:'flex',gap:10,flexWrap:'wrap'}}>
                <button className="btn btn-primary" onClick={exportData} title="Backup your family data">
                  üíæ Export Data
                </button>
                <label className="btn btn-primary" style={{cursor:'pointer'}} title="Restore from backup">
                  üìÇ Import Data
                  <input type="file" accept=".json" onChange={importData} style={{display:'none'}}/>
                </label>
                <button className="btn btn-secondary" onClick={()=>{
                  if(confirm('Clear all milestone photos? This cannot be undone.')){
                    setData(prev=>({...prev,milestones:prev.milestones.map(m=>({...m,photo:null}))}));
                    celebrate('Photos Cleared! üóëÔ∏è');
                  }
                }} title="Free up storage space">
                  üóëÔ∏è Clear Photos
                </button>
                <button className="btn btn-secondary" style={{background:'#dc2626',color:'white'}} onClick={()=>{
                  if(confirm('‚ö†Ô∏è Reset EVERYTHING? This will delete all your family data, tasks, notes, and photos. This cannot be undone!')){
                    if(confirm('Are you ABSOLUTELY sure? Type "RESET" in the next prompt')){
                      const confirmation=prompt('Type RESET to confirm:');
                      if(confirmation==='RESET'){
                        localStorage.clear();
                        window.location.reload();
                      }
                    }
                  }
                }} title="Start fresh - DANGER!">
                  üîÑ Reset All Data
                </button>
              </div>
              
              <div style={{background:'var(--cream)',padding:16,borderRadius:'var(--radius-md)',fontSize:'0.85rem',color:'var(--navy-light)'}}>
                <div><strong>üí° Tips:</strong></div>
                <ul style={{marginTop:8,paddingLeft:20}}>
                  <li>Export your data regularly as backup</li>
                  <li>Clear old photos to free storage space</li>
                  <li>All changes auto-save every 500ms</li>
                  <li>Use keyboard shortcuts: Ctrl+S to force save</li>
                </ul>
              </div>
            </div>
          </div>
        </>}
      </main>
      
      {/* Phase 5: Gratitude Modal */}
      {showGratitudeModal&&<div className="modal-overlay" onClick={()=>setShowGratitudeModal(false)}>
        <div className="modal-content" onClick={e=>e.stopPropagation()} style={{maxWidth:'500px'}}>
          <h3 style={{marginBottom:'16px'}}>‚ú® Daily Gratitude</h3>
          <p style={{fontSize:'0.9rem',color:'var(--navy-light)',marginBottom:'16px'}}>
            Take a moment to reflect on what you're grateful for today. This will be saved to your notes.
          </p>
          <textarea 
            className="modal-textarea"
            value={gratitudeText}
            onChange={e=>setGratitudeText(e.target.value)}
            placeholder="I'm grateful for..."
            rows="5"
            style={{width:'100%',marginBottom:'16px'}}
          />
          <div style={{display:'flex',gap:'8px',justifyContent:'flex-end'}}>
            <button className="btn btn-secondary" onClick={()=>{setShowGratitudeModal(false);setGratitudeText('')}}>Cancel</button>
            <button className="btn btn-primary" onClick={()=>{
              if(gratitudeText.trim()){
                const gratitudeNote={
                  id:Date.now(),
                  date:new Date().toISOString(),
                  text:`‚ú® Gratitude: ${gratitudeText}`,
                  type:'gratitude'
                };
                setData(prev=>({...prev,notes:[...prev.notes,gratitudeNote]}));
                celebrate('üíñ Gratitude saved! +10 XP');
                setData(prev=>({...prev,gamification:{...prev.gamification,xp:(prev.gamification.xp||0)+10}}));
                setShowGratitudeModal(false);
                setGratitudeText('');
              }
            }}>Save Gratitude (+10 XP)</button>
          </div>
        </div>
      </div>}
      
      <button className="fab" onClick={()=>setTab('overview')}>üè†</button>
    </div>
  );
};

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(<App/>);
  </script>
</body>
</html>
